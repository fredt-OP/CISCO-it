<chapter type="" id="en0911000000">
<title><content-text>OSPF</content-text></title>
<section type="ChapterIntroduction" id="en0911000000">
<title><content-text>Chapter Introduction</content-text></title>
<topic type="" id="en0911000100">
<title><content-text>Chapter Introduction</content-text></title>
<page type="OneColumn" id="en0911000101">
<content-media type="StaticGraphic" id="cm3978973762"><title><content-text></content-text></title><media ref="en0911000000/en0911000000/en0911000100/en0911000101/cm3978973762.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911000000/en0911000100/en0911000101/cm3978973762text.xml"/></content-media>
<content-text><p>Open Shortest Path First (OSPF ) is a link-state routing protocol that was developed as a replacement for the distance vector routing protocol RIP. RIP was an acceptable routing protocol in the early days of networking and the Internet, but its reliance on hop count as the only measure for choosing the best route quickly became unacceptable in larger networks that needed a more robust routing solution. OSPF is a classless routing protocol that uses the concept of <i>areas </i>for scalability. RFC 2328 defines the OSPF metric as an arbitrary value called <i>cost</i>. The Cisco IOS uses bandwidth as the OSPF cost metric. </p> <p>OSPF's major advantages over RIP are its fast convergence and its scalability to much larger network implementations. In this final chapter of the <i>Routing Protocols and Concepts</i> course, you will learn basic, single-area OSPF implementations and configurations. More complex OSPF configurations and concepts are reserved for CCNP-level courses.</p></content-text>
</page>
</topic>
</section>
<section type="" id="en0911010000">
<title><content-text>Introduction to OSPF</content-text></title>
<topic type="" id="en0911010100">
<title><content-text>Background of OSPF</content-text></title>
<page type="OneColumn" id="en0911010101">
<content-media type="InteractiveGraphicRollovers" id="cm2888565200"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010100/en0911010101/cm2888565200.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010100/en0911010101/cm2888565200text.xml"/></content-media>
<content-text><p>The initial development of OSPF began in 1987 by the Internet Engineering Task Force (IETF) OSPF Working Group. At that time the Internet was largely an academic and research network funded by the U.S. government. </p> <p><b>Roll over the dates in the OSPF Development Timeline figure to see related events. </b></p> <p>In 1989, the specification for OSPFv1 was published in RFC 1131. There were two implementations written: one to run on routers and the other to run on UNIX workstations. The latter implementation later became a widespread UNIX process known as GATED. OSPFv1 was an experimental routing protocol and never deployed.</p> <p>In 1991, OSPFv2 was introduced in RFC 1247 by John Moy. OSPFv2 offered significant technical improvements over OSPFv1. At the same time, ISO was working on a link-state routing protocol of their own, Intermediate System-to-Intermediate System (IS-IS). Not surprisingly, IETF chose OSPF as their recommended IGP (Interior Gateway Protocol). </p> <p>In 1998, the OSPFv2 specification was updated in RFC 2328 and is the current RFC for OSPF. </p> <p><b>Note: </b>In 1999 OSPFv3 for IPv6 was published in RFC 2740. RFC 2740 was written by John Moy, Rob Coltun, and Dennis Ferguson. OSPFv3 is discussed in CCNP.</p> <p><b>Links</b></p> <p>"OSPF Version 2," <content-link target="http://www.ietf.org/rfc/rfc2328.txt" type="external">http://www.ietf.org/rfc/rfc2328.txt</content-link></p></content-text>
</page>
</topic>
<topic type="" id="en0911010200">
<title><content-text>OSPF Message Encapsulation</content-text></title>
<page type="OneColumn" id="en0911010201">
<content-media type="InteractiveGraphicRollovers" id="cm3255376418"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010200/en0911010201/cm3255376418.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010200/en0911010201/cm3255376418text.xml"/></content-media>
<content-text><p>The data portion of an OSPF message is encapsulated in a packet. This data field can include one of five OSPF packet types. Each packet type is briefly discussed in the next topic.</p> <p><b>Roll over the fields in the Encapsulated OSPF Message figure to see the encapsulation process. </b></p> <p>The OSPF packet header is included with every OSPF packet, regardless of its type. The OSPF packet header and packet type-specific data are then encapsulated in an IP packet. In the IP packet header, the protocol field is set to 89 to indicate OSPF, and the destination address is set to one of two multicast addresses: 224.0.0.5 or 224.0.0.6. If the OSPF packet is encapsulated in an Ethernet frame, the destination MAC address is also a multicast address: 01-00-5E-00-00-05 or 01-00-5E-00-00-06.</p></content-text>
</page>
</topic>
<topic type="" id="en0911010300">
<title><content-text>OSPF Packet Types</content-text></title>
<page type="OneColumn" id="en0911010301">
<content-media type="StaticGraphic" id="cm2901875363"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010300/en0911010301/cm2901875363.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010300/en0911010301/cm2901875363text.xml"/></content-media>
<content-text><p>In the previous chapter, we introduced Link-State Packets (LSPs). The figure shows the five different types of OSPF LSPs. Each packet serves a specific purpose in the OSPF routing process:</p> <p>1. <b>Hello</b> - Hello packets are used to establish and maintain adjacency with other OSPF routers. The hello protocol is discussed in detail in the next topic. </p> <p>2. <b>DBD</b> - The <content-link target="cg9049355325" type="glossary">Database Description (DBD)</content-link> packet contains an abbreviated list of the sending router's link-state database and is used by receiving routers to check against the local link-state database. </p> <p>3. <b>LSR</b> - Receiving routers can then request more information about any entry in the DBD by sending a <content-link target="cg7438722925" type="glossary">Link-State Request (LSR)</content-link>. </p> <p>4. <b>LSU</b> - <content-link target="cg1133628043" type="glossary">Link-State Update (LSU)</content-link> packets are used to reply to LSRs as well as to announce new information. LSUs contain seven different types of Link-State Advertisements (LSAs). LSUs and LSAs are briefly discussed in a later topic.</p> <p>5. <b>LSAck</b> - When an LSU is received, the router sends a <content-link target="cg8742800150" type="glossary">Link-State Acknowledgement (LSAck)</content-link> to confirm receipt of the LSU.</p></content-text>
</page>
</topic>
<topic type="" id="en0911010400">
<title><content-text>Hello Protocol</content-text></title>
<page type="OneColumn" id="en0911010401">
<content-media type="AnimationPartialScreen" id="cm9806564439"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010400/en0911010401/cm9806564439.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010400/en0911010401/cm9806564439text.xml"/></content-media>
<content-text><p>The figure shows the OSPF packet header and Hello packet. The blue-shaded fields will be discussed in more detail later in the chapter. For now, let's focus on the uses of the Hello packet. </p> <p>OSPF packet Type 1 is the OSPF Hello packet. Hello packets are used to:</p> <p><ul><li> Discover OSPF neighbors and establish neighbor adjacencies.</li><li> Advertise parameters on which two routers must agree to become neighbors.</li><li> Elect the <content-link target="cg9839475267" type="glossary">Designated Router (DR)</content-link> and <content-link target="cg4534692650" type="glossary">Backup Designated Router (BDR)</content-link> on multiaccess networks like Ethernet and Frame Relay.</li></ul></p> <p>Important fields shown in the figure include:</p> <p><ul><li><b>Type: </b>OSPF Packet Type: Hello (1), DD (2), LS Request (3), LS Update (4), LS ACK (5)</li><li><b>Router ID:</b> ID of the originating router</li><li><b>Area ID: </b>area from which the packet originated </li><li><b>Network Mask: </b>Subnet mask associated with the sending interface</li><li><b>Hello Interval:</b> number of seconds between the sending router's hellos</li><li><b>Router Priority: </b>Used in DR/BDR election (discussed later)</li><li><b>Designated Router (DR):</b> Router ID of the DR, if any</li><li><b>Backup Designated Router (BDR): </b>Router ID of the BDR, if any</li><li><b>List of Neighbors:</b> lists the OSPF Router ID of the neighboring router(s)</li></ul></p></content-text>
</page>
<page type="OneColumn" id="en0911010402">
<content-media type="StaticGraphic" id="cm2206684110"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010400/en0911010402/cm2206684110.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010400/en0911010402/cm2206684110text.xml"/></content-media>
<content-text><p><b>Neighbor Establishment</b></p> <p>Before an OSPF router can flood its link-states to other routers, it must first determine if there are any other OSPF neighbors on any of its links. In the figure, the OSPF routers are sending Hello packets on all OSPF-enabled interfaces to determine if there are any neighbors on those links. The information in the OSPF Hello includes the OSPF Router ID of the router sending the Hello packet (Router ID is discussed later in the chapter). Receiving an OSPF Hello packet on an interface confirms for a router that there is another OSPF router on this link. OSPF then establishes adjacency with the neighbor. For example, in the figure, R1will establish adjacencies with R2 and R3.</p> <p><b>OSPF Hello and Dead Intervals</b></p> <p>Before two routers can form an OSPF neighbor adjacency, they must agree on three values: Hello interval, Dead interval, and network type. The OSPF Hello interval indicates how often an OSPF router transmits its Hello packets. By default, OSPF Hello packets are sent every 10 seconds on multiaccess and point-to-point segments and every 30 seconds on <content-link target="cg9847456962" type="glossary">non-broadcast multiaccess (NBMA)</content-link> segments (Frame Relay, X.25, ATM). </p> <p>In most cases, OSPF Hello packets are sent as multicast to an address reserved for <i><content-link target="cg4679715108" type="glossary">ALLSPFRouters</content-link></i> at 224.0.0.5. Using a multicast address allows a device to ignore the packet if its interface is not enabled to accept OSPF packets. This saves CPU processing time on non-OSPF devices.</p> <p>The Dead interval is the period, expressed in seconds, that the router will wait to receive a Hello packet before declaring the neighbor "down." Cisco uses a default of four times the Hello interval. For multiaccess and point-to-point segments, this period is 40 seconds. For NBMA networks, the Dead interval is 120 seconds. </p> <p>If the Dead interval expires before the routers receive a Hello packet, OSPF will remove that neighbor from its link-state database. The router floods the link-state information about the "down" neighbor out all OSPF enabled interfaces. </p> <p>Network types are discussed later in the chapter.</p> <p><b>Electing a DR and BDR</b></p> <p>To reduce the amount of OSPF traffic on multiaccess networks, OSPF elects a Designated Router (DR) and Backup Designated Router (BDR). The DR is responsible for updating all other OSPF routers (called <content-link target="cg7298380285" type="glossary">DROthers</content-link>) when a change occurs in the multiaccess network. The BDR monitors the DR and takes over as DR if the current DR fails. </p> <p>In the figure, R1, R2, and R3 are connected through point-to-point links. Therefore, no DR/BDR election occurs. The DR/BDR election and processes will be discussed in a later topic and the topology will be changed to a multiaccess network.</p> <p><b>Note:</b> The Hello packet is discussed in more detail in CCNP along with the other types of OSPF packets. </p></content-text>
</page>
</topic>
<topic type="" id="en0911010500">
<title><content-text>OSPF Link-state Updates</content-text></title>
<page type="OneColumn" id="en0911010501">
<content-media type="StaticGraphic" id="cm3817145446"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010500/en0911010501/cm3817145446.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010500/en0911010501/cm3817145446text.xml"/></content-media>
<content-text><p>Link-state updates (LSUs) are the packets used for OSPF routing updates. An LSU packet can contain 11 different types of Link-State Advertisements (LSAs), as shown in the figure. The difference between the terms Link-State Update (LSU) and <content-link target="cg7038442778" type="glossary">Link-State Advertisement (LSA)</content-link> can sometimes be confusing. At times, these terms are used interchangeably. An LSU contains one or more LSAs and either term can be used to refer to link-state information propagated by OSPF routers.</p> <p><b>Note: </b>The different types of LSAs are discussed in CCNP.</p></content-text>
</page>
</topic>
<topic type="" id="en0911010600">
<title><content-text>OSPF Algorithm</content-text></title>
<page type="OneColumn" id="en0911010601">
<content-media type="StaticGraphic" id="cm1474132476"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010600/en0911010601/cm1474132476.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010600/en0911010601/cm1474132476text.xml"/></content-media>
<content-text><p>Each OSPF router maintains a link-state database containing the LSAs received from all other routers. Once a router has received all of LSAs and built its local link-state database, OSPF uses Dijkstra's shortest path first (SPF) algorithm to create an SPF tree. The SPF tree is then used to populate the IP routing table with the best paths to each network.</p></content-text>
</page>
</topic>
<topic type="" id="en0911010700">
<title><content-text>Administrative Distance</content-text></title>
<page type="OneColumn" id="en0911010701">
<content-media type="StaticGraphic" id="cm3147192772"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010700/en0911010701/cm3147192772.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010700/en0911010701/cm3147192772text.xml"/></content-media>
<content-text><p>As you know from Chapter 3, "Introduction to Dynamic Routing," administrative distance (AD) is the trustworthiness (or preference) of the route source. OSPF has a default administrative distance of 110. As you can see from the figure, when compared to other interior gateway protocols (IGPs), OSPF is preferred over IS-IS and RIP. </p></content-text>
</page>
</topic>
<topic type="" id="en0911010800">
<title><content-text>Authentication</content-text></title>
<page type="OneColumn" id="en0911010801">
<content-media type="StaticGraphic" id="cm2326913933"><title><content-text></content-text></title><media ref="en0911000000/en0911010000/en0911010800/en0911010801/cm2326913933.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911010000/en0911010800/en0911010801/cm2326913933text.xml"/></content-media>
<content-text><p>As stated in previous chapters, configuring routing protocols to use authentication will be discussed in a later course. Like other routing protocols, OSPF can be configured for authentication. </p> <p>It is good practice to authenticate transmitted routing information. RIPv2, EIGRP, OSPF, IS-IS, and BGP can all be configured to encrypt and authenticate their routing information. This practice ensures that routers will only accept routing information from other routers that have been configured with the same password or authentication information. </p> <p><b>Note:</b> Authentication does not encrypt the router's routing table. </p></content-text>
</page>
</topic>
</section>
<section type="" id="en0911020000">
<title><content-text>Basic OSPF Configuration</content-text></title>
<topic type="" id="en0911020100">
<title><content-text>Lab Topology</content-text></title>
<page type="OneColumn" id="en0911020101">
<content-media type="InteractiveGraphicHotspots" id="cm6146016532"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020100/en0911020101/cm6146016532.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020100/en0911020101/cm6146016532text.xml"/></content-media>
<content-text><p>The figure shows the topology for this chapter. Notice that the addressing scheme is discontiguous. OSPF is a classless routing protocol. Therefore, we will configure the mask as part of our OSPF configuration. As you know, doing this overcomes the problem with discontiguous addressing. Also notice in this topology that there are three serial links of various bandwidths and that each router has multiple paths to each remote network.</p>  <p><b>Click Addressing to review the IP addresses.</b></p> <p> </p> <p><b>Click R1, R2, and R3 to review each router's starting configuration.</b></p></content-text>
</page>
</topic>
<topic type="" id="en0911020200">
<title><content-text>The router ospf Command</content-text></title>
<page type="OneColumn" id="en0911020201">
<content-media type="InteractiveGraphicHotspots" id="cm8087429524"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020200/en0911020201/cm8087429524.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020200/en0911020201/cm8087429524text.xml"/></content-media>
<content-text><p>OSPF is enabled with the <span class="cmd"><b>router ospf</b><i> process-id</i></span> global configuration command. The <span class="cmd"><i>process-id</i></span> is a number between 1 and 65535 and is chosen by the network administrator. The <span class="cmd"><i>process-id </i></span>is locally significant, which means that it does not have to match other OSPF routers in order to establish adjacencies with those neighbors. This differs from EIGRP. The EIGRP process ID or autonomous system number <i>does</i> need to match for two EIGRP neighbors to become adjacent.</p> <p>In our topology, we will enable OSPF on all three routers using the same process ID of 1. We are using the same process ID simply for consistency.</p> <span class="cmd"><p>R1(config)#<b>router ospf 1</b></p></span> <span class="cmd"><p>R1(config-router)#</p></span></content-text>
</page>
</topic>
<topic type="" id="en0911020300">
<title><content-text>The network Command</content-text></title>
<page type="OneColumn" id="en0911020301">
<content-media type="InteractiveGraphicHotspots" id="cm9291193915"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020300/en0911020301/cm9291193915.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020300/en0911020301/cm9291193915text.xml"/></content-media>
<content-text><p>The <span class="cmd"><b>network</b></span> command used with OSPF has the same function as when used with other IGP routing protocols: </p> <p><ul><li> Any interfaces on a router that match the network address in the <span class="cmd"><b>network</b></span> command will be enabled to send and receive OSPF packets.</li><li> This network (or subnet) will be included in OSPF routing updates.</li></ul></p> <p>The <span class="cmd"><b>network</b></span> command is used in router configuration mode.</p> <p><span class="cmd">Router(config-router)<b>#network </b><i>network-address wildcard-mask</i><b> area </b><i>area-id</i></span></p> <p>The OSPF <span class="cmd"><b>network</b></span> command uses a combination of <i>network-address</i> and <i>wildcard-mask </i>similar to that which can be used by EIGRP. Unlike EIGRP, however, OSPF requires the wildcard mask. The network address along with the wildcard mask is used to specify the interface or range of interfaces that will be enabled for OSPF using this <span class="cmd"><b>network</b></span> command. </p> <p>As with EIGRP, the wildcard mask can be configured as the inverse of a subnet mask. For example, R1's FastEthernet 0/0 interface is on the 172.16.1.16/28 network. The subnet mask for this interface is /28 or 255.255.255.240. The inverse of the subnet mask results in the wildcard mask.</p> <p><b>Note:</b> Like EIGRP, some IOS versions allow you to simply enter the subnet mask instead of the wildcard mask. The IOS then converts the subnet mask to the wildcard mask format.</p> <p><span class="cmd"> 255.255.255.255</span> </p> <p><span class="cmd">- 255.255.255.240 Subtract the subnet mask</span></p> <p><span class="cmd"> --------------------</span></p> <p><span class="cmd"> 0. 0. 0. 15 Wildcard mask</span></p> <p>The <span class="cmd"><b>area </b><i>area-id</i></span> refers to the <content-link target="cg9789079661" type="glossary">OSPF area</content-link>. An OSPF area is a group of routers that share link-state information. All OSPF routers in the same area must have the same link-state information in their link-state databases. This is accomplished by routers flooding their individual link-states to all other routers in the area. In this chapter, we will configure all of the OSPF routers within a single area. This is known as single-area OSPF. </p> <p>An OSPF network can also be configured as multiple areas. There are several advantages to configuring large OSPF networks as multiple areas, including smaller link-state databases and the ability to isolate unstable network problems within an area. Multi-area OSPF is covered in CCNP.</p> <p>When all of the routers are within the same OSPF area, the network commands must be configured with the same <span class="cmd"><i>area-id</i></span> on all routers. Although any <span class="cmd"><i>area-id </i></span>can be used, it is good practice to use an <span class="cmd"><i>area-id</i></span> of 0 with single-area OSPF. This convention makes it easier if the network is later configured as multiple OSPF areas where area 0 becomes the backbone area.</p> <p>The figure shows the <span class="cmd"><b>network</b></span> commands for all three routers, enabling OSPF on all interfaces. At this point all routers should be able to ping all networks.</p></content-text>
</page>
</topic>
<topic type="" id="en0911020400">
<title><content-text>OSPF Router ID</content-text></title>
<page type="OneColumn" id="en0911020401">
<content-media type="InteractiveGraphicHotspots" id="cm6009600019"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020400/en0911020401/cm6009600019.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020400/en0911020401/cm6009600019text.xml"/></content-media>
<content-text><p><b>Determining the Router ID</b></p> <p>The OSPF router ID is used to uniquely identify each router in the OSPF routing domain. A router ID is simply an IP address. Cisco routers derive the router ID based on three criteria and with the following precedence:</p> <p>1. Use the IP address configured with the OSPF <span class="cmd"><b>router-id</b></span> command.</p> <p>2. If the <span class="cmd"><b>router-id</b></span> is not configured, the router chooses highest IP address of any of its loopback interfaces.</p> <p>3. If no loopback interfaces are configured, the router chooses highest active IP address of any of its physical interfaces.</p> <p><b>Highest Active IP Address</b></p> <p>If an OSPF router is not configured with an OSPF <span class="cmd"><b>router-id</b></span> command and there are no loopback interfaces configured, the OSPF router ID will be the highest active IP address on any of its interfaces. The interface does not need to be enabled for OSPF, meaning that it does not need to be included in one of the OSPF <span class="cmd"><b>network</b></span> commands. However, the interface must be active - it must be in the <b>up</b> state.</p> <p><b>Click the Topology button in the figure. </b></p> <p>Using the criteria described above, can you determine the router IDs for R1, R2, and R3? The answer is on the next page.</p></content-text>
</page>
<page type="OneColumn" id="en0911020402">
<content-media type="InteractiveGraphicHotspots" id="cm3033580061"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020400/en0911020402/cm3033580061.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020400/en0911020402/cm3033580061text.xml"/></content-media>
<content-text><p><b>Verifying the Router ID</b></p> <p>Because we have not configured router IDs or loopback interfaces on our three routers, the router ID for each router is determined by the number three criterion in the list: the highest active IP address on any of the router's physical interfaces. As shown in the figure, the router ID for each router is:</p> <p><b>R1:</b> 192.168.10.5, which is higher than either 172.16.1.17 or 192.168.10.1</p> <p><b>R2:</b> 192.168.10.9, which is higher than either 10.10.10.1 or 192.168.10.2</p> <p><b>R3:</b> 192.168.10.10, which is higher than either 172.16.1.33 or 192.168.10.6</p> <p>One command you can use to verify the current router ID is <span class="cmd"><b>show ip protocols</b></span>. Some IOS versions do not display the router ID as shown in the figure. In those cases, use the <span class="cmd"><b>show ip ospf</b></span> or <span class="cmd"><b>show ip ospf interface</b></span> commands to verify the router ID.</p></content-text>
</page>
<page type="OneColumn" id="en0911020403">
<content-media type="InteractiveGraphicHotspots" id="cm3731522329"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020400/en0911020403/cm3731522329.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020400/en0911020403/cm3731522329text.xml"/></content-media>
<content-text><p><b>Loopback Address</b></p> <p>If the OSPF <span class="cmd"><b>router-id</b></span> command is not used and loopback interfaces are configured, OSPF will choose highest IP address of any of its loopback interfaces. A loopback address is a virtual interface and is automatically in the <b>up</b> state when configured. You already know the commands to configure a loopback interface:</p> <span class="cmd"><p>Router(config)#<b>interface </b><i>loopback number</i></p></span> <span class="cmd"><p>Router(config-if)#<b>ip address </b><i>ip-address subnet-mask</i></p></span> <p><b>Click the Topology button in the figure.</b></p> <p>In this topology, all three routers have been configured with loopback addresses to represent the OSPF router IDs. The advantage of using a loopback interface is that - unlike physical interfaces - it cannot fail. There are no actual cables or adjacent devices on which the loopback interface depends for being in the <b>up</b> state. Therefore, using a loopback address for the router ID provides stability to the OSPF process. Because the OSPF <span class="cmd"><b>router-id</b></span> command, which is discussed next, is a fairly recent addition to IOS, it is more common to find loopback addresses used for configuring OSPF router IDs.</p> <p><b>The OSPF </b><span class="cmd"><b>router-id</b></span><b> command</b></p> <p>The OSPF <span class="cmd"><b>router-id</b></span> command was introduced in IOS 12.0(T) and takes precedence over loopback and physical interface IP addresses for determining the router ID. The command syntax is:</p> <span class="cmd"><p>Router(config)#<b>router ospf </b><i>process-id</i></p></span> <span class="cmd"><p>Router(config-router)#<b>router-id </b><i>ip-address</i></p></span>  <p><b>Modifying the Router ID</b></p> <p>The router ID is selected when OSPF is configured with its first OSPF <span class="cmd"><b>network</b></span> command. If the OSPF <span class="cmd"><b>router-id</b></span> command or the loopback address is configured <i>after</i> the OSPF <span class="cmd"><b>network</b></span> command, the router ID will be derived from the interface with the highest active IP address.</p> <p>The router ID can be modified with the IP address from a subsequent OSPF <span class="cmd"><b>router-id</b></span> command by reloading the router or by using the following command:</p> <p><span class="cmd">Router#<b>clear ip ospf process</b></span></p> <p><b>Note:</b> Modifying a router ID with a new loopback or physical interface IP address may require reloading the router.</p> <p><b>Duplicate Router IDs</b></p> <p>When two routers have the same router ID in an OSPF domain, routing may not function properly. If the router ID is the same on two neighboring routers, the neighbor establishment may not occur. When duplicate OSPF router IDs occur, IOS will display a message similar to:</p> <p><span class="cmd">%OSPF-4-DUP_RTRID1: Detected router with duplicate router ID</span></p> <p>To correct this problem, configure all routers so that they have unique OSPF router IDs.</p> <p><b>Click New Router IDs in the figure.</b></p> <p>Because some IOS versions do not support the <span class="cmd"><b>router-id</b></span> command, we will use the loopback address method for assigning router IDs. An IP address from a loopback interface will usually only replace a current OSPF router ID by reloading the router. In the figure, the routers have been reloaded. The <span class="cmd"><b>show ip protocols</b></span> command is used to verify that each router is now using the loopback address for the router ID.</p></content-text>
</page>
</topic>
<topic type="" id="en0911020500">
<title><content-text>Verifying OSPF</content-text></title>
<page type="OneColumn" id="en0911020501">
<content-media type="InteractiveGraphicHotspots" id="cm3794948834"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020500/en0911020501/cm3794948834.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020500/en0911020501/cm3794948834text.xml"/></content-media>
<content-text><p>The <span class="cmd"><b>show ip ospf neighbor</b></span> command can be used to verify and troubleshoot OSPF neighbor relationships. For each neighbor, this command displays the following output:</p> <p><ul><li> <span class="cmd"><b>Neighbor ID</b></span> - The router ID of the neighboring router.</li><li> <span class="cmd"><b>Pri</b></span> - The OSPF priority of the interface. This is discussed in a later section.</li><li> <span class="cmd"><b>State</b></span> - The OSPF state of the interface. <span class="cmd"><b>FULL</b></span> state means that the router and its neighbor have identical OSPF link-state databases. OSPF states are discussed in CCNP.</li><li> <span class="cmd"><b>Dead Time</b></span> - The amount of time remaining that the router will wait to receive an OSPF Hello packet from the neighbor before declaring the neighbor down. This value is reset when the interface receives a Hello packet.</li><li> <span class="cmd"><b>Address</b></span> - The IP address of the neighbor's interface to which this router is directly connected.</li><li> <span class="cmd"><b>Interface</b></span> - The interface on which this router has formed adjacency with the neighbor.</li></ul></p> <p>When troubleshooting OSPF networks, the <span class="cmd"><b>show ip ospf</b></span> neighbor command can be used to verify that the router has formed an adjacency with its neighboring routers. If the router ID of the neighboring router is not displayed, or if it does not show as a state of <b>FULL</b>, the two routers have not formed an OSPF adjacency. If two routers do not establish adjacency, link-state information will not be exchanged. Incomplete link-state databases can cause inaccurate SPF trees and routing tables. Routes to destination networks may either not exist or may not be the most optimum path.</p> <p><b>Note:</b> On multiaccess networks such as Ethernet, two routers that are adjacent may have their states displayed as 2WAY. This will be discussed in a later section.</p> <p>Two routers may not form an OSPF adjacency if:</p> <p><ul><li> The subnet masks do not match, causing the routers to be on separate networks.</li><li> OSPF Hello or Dead Timers do not match.</li><li> OSPF Network Types do not match.</li><li> There is a missing or incorrect OSPF <span class="cmd"><b>network</b></span> command.</li></ul></p></content-text>
</page>
<page type="OneColumn" id="en0911020502">
<content-media type="InteractiveGraphicHotspots" id="cm8892863889"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020500/en0911020502/cm8892863889.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020500/en0911020502/cm8892863889text.xml"/></content-media>
<content-text><p>Other powerful OSPF troubleshooting commands include:</p> <span class="cmd"><p><b>show ip protocols</b></p></span> <span class="cmd"><p><b>show ip ospf</b></p></span> <span class="cmd"><p><b>show ip ospf interface</b></p></span> <p>As shown in the figure, the <span class="cmd"><b>show ip protocols</b></span> command is a quick way to verify vital OSPF configuration information, including the OSPF process ID, the router ID, networks the router is advertising, the neighbors the router is receiving updates from, and the default administrative distance, which is 110 for OSPF.</p> <p><b>Click </b><span class="cmd"> <b>show ip ospf</b></span><b> in the figure.</b></p> <p>The <span class="cmd"><b>show ip ospf</b></span> command can also be used to examine the OSPF process ID and router ID. Additionally, this command displays the OSPF area information as well as the last time the SPF algorithm was calculated. As you can see from the sample output, OSPF is a very stable routing protocol. The only OSPF-related event that R1 has participated in during the past 11 and a half hours is to send small Hello packets to its neighbors. </p> <p><b>Note: </b>Additional information displayed by the <span class="cmd"><b>show ip ospf</b></span> command is discussed in CCNP courses.</p> <p>The command output includes important SPF algorithm information which includes the <content-link target="cg1735291339" type="glossary">SPF schedule delay</content-link>: </p> <span class="cmd"><p>Initial SPF schedule delay 5000 msecs</p></span> <span class="cmd"><p>Minimum hold time between two consecutive SPFs 10000 msecs</p></span> <span class="cmd"><p>Maximum wait time between two consecutive SPFs 10000 msecs</p></span> <p>Any time a router receives new information about the topology (addition, deletion, or modification of a link), the router must rerun the SPF algorithm, create a new SPF tree, and update the routing table. The SPF algorithm is CPU-intensive and the time it takes for calculation depends on the size of the area. The size of an area is measured by the number of routers and the size of the link-state database. </p> <p>A network that cycles between an <b>up</b> state and a <b>down</b> state is referred to as a <content-link target="cg4689628855" type="glossary">flapping link</content-link>. A flapping link can cause OSPF routers in an area to constantly recalculate the SPF algorithm, preventing proper convergence. To minimize this problem, the router waits 5 seconds (5000 msecs) after receiving an LSU before running the SPF algorithm. This is known as the SPF schedule delay. In order to prevent a router from constantly running the SPF algorithm, there is an additional Hold Time of 10 seconds (10000 msecs). The router waits 10 seconds after running the SPF algorithm before rerunning the algorithm again. </p> <p><b>Click </b><span class="cmd"><b>show ip ospf interface </b></span><b>in the figure.</b></p> <p>The quickest way to verify Hello and Dead intervals is to use the <span class="cmd"><b>show ip ospf interface</b></span> command. As shown in the figure, adding the interface name and number to the command displays output for a specific interface. These intervals are included in the OSPF Hello packets sent between neighbors. OSPF may have different Hello and Dead intervals on various interfaces, but for OSPF routers to become neighbors, their OSPF Hello and Dead intervals must be identical. For example, in the figure, R1 is using a Hello interval of 10 and a Dead interval of 40 on the Serial 0/0/0 interface. R2 must also use the same intervals on its Serial 0/0/0 interface or the two routers will not form an adjacency. </p></content-text>
</page>
</topic>
<topic type="" id="en0911020600">
<title><content-text>Examining the Routing Table</content-text></title>
<page type="OneColumn" id="en0911020601">
<content-media type="InteractiveGraphicHotspots" id="cm5981616568"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020600/en0911020601/cm5981616568.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911020000/en0911020600/en0911020601/cm5981616568text.xml"/></content-media>
<content-text><p>As you know, the quickest way to verify OSPF convergence is to look at the routing table for each router in the topology. </p> <p><b>Click R1, R2, and R3 in the figure to see </b><span class="cmd"><b>show ip route</b></span><b> output.</b></p> <p>The <span class="cmd"><b>show ip route</b></span> command can be used to verify that OSPF is sending and receiving routes via OSPF. The <b>O</b> at the beginning of each route indicates that the route source is OSPF. The routing table and OSPF will be examined more closely in the following section. However, you should immediately notice two distinct differences in the OSPF routing table compared to routing tables you have seen in previous chapters. First, notice that each router has four directly connected networks because the loopback interface counts as the fourth network. These loopback interfaces are not advertised in OSPF. Therefore, each router lists seven known networks. Second, unlike RIPv2 and EIGRP, OSPF does not automatically summarize at major network boundaries. OSPF is inherently classless.</p></content-text>
</page>
<page type="OneColumn" id="en0911020602">
<content-media type="ActivityPKA" id="cm6077246877"><title><content-text></content-text></title><media ref="en0911000000/en0911020000/en0911020600/en0911020602/cm6077246877/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911020000/en0911020600/en0911020602/cm6077246877/icontext.xml"/></content-media>
<content-text><p>Use the Packet Tracer Activity to configure and verify basic OSPF routing.</p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="en0911030000">
<title><content-text>The OSPF Metric</content-text></title>
<topic type="" id="en0911030100">
<title><content-text>OSPF Metric</content-text></title>
<page type="OneColumn" id="en0911030101">
<content-media type="StaticGraphic" id="cm5361713613"><title><content-text></content-text></title><media ref="en0911000000/en0911030000/en0911030100/en0911030101/cm5361713613.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911030000/en0911030100/en0911030101/cm5361713613text.xml"/></content-media>
<content-text><p>The OSPF metric is called cost. From RFC 2328: <i>"A cost is associated with the output side of each router interface. This cost is configurable by the system administrator. The lower the cost, the more likely the interface is to be used to forward data traffic."</i> </p> <p>Notice that RFC 2328 does not specify which values should be used to determine the cost.</p> <p><b>The Cisco IOS uses the cumulative bandwidths of the outgoing interfaces from the router to the destination network as the cost value.</b> At each router, the cost for an interface is calculated as 10 to the 8th power divided by bandwidth in bps. This is known as the <i>reference bandwidth</i>. Dividing 10 to the 8th power by the interface bandwidth is done so that interfaces with the higher bandwidth values will have a lower calculated cost. Remember, in routing metrics, the lowest cost route is the preferred route (for example, with RIP, 3 hops is better than 10 hops). The figure shows the default OSPF costs for several types of interfaces. </p> <p><b>Reference Bandwidth</b></p> <p>The reference bandwidth defaults to 10 to the 8th power, 100,000,000 bps or 100 Mbps. This results in interfaces with a bandwidth of 100 Mbps and higher having the same OSPF cost of 1. The reference bandwidth can be modified to accommodate networks with links faster than 100,000,000 bps (100 Mbps) using the OSPF command <span class="cmd"><b>auto-cost reference-bandwidth</b></span>. When this command is necessary, it is recommended that it is used on all routers so the OSPF routing metric remains consistent.</p></content-text>
</page>
<page type="OneColumn" id="en0911030102">
<content-media type="StaticGraphic" id="cm9928226376"><title><content-text></content-text></title><media ref="en0911000000/en0911030000/en0911030100/en0911030102/cm9928226376.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911030000/en0911030100/en0911030102/cm9928226376text.xml"/></content-media>
<content-text><p><b>OSPF Accumulates Costs</b></p> <p>The cost of an OSPF route is the accumulated value from one router to the destination network. For example, in the figure, the routing table on R1 shows a cost of 65 to reach the 10.10.10.0/24 network on R2. Because 10.10.10.0/24 is attached to a FastEthernet interface, R2 assigns the value 1 as the cost for 10.10.10.0/24. R1 then adds the additional cost value of 64 to send data across the default T1 link between R1 and R2.</p></content-text>
</page>
<page type="OneColumn" id="en0911030103">
<content-media type="InteractiveGraphicHotspots" id="cm7063397266"><title><content-text></content-text></title><media ref="en0911000000/en0911030000/en0911030100/en0911030103/cm7063397266.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911030000/en0911030100/en0911030103/cm7063397266text.xml"/></content-media>
<content-text><p><b>Default Bandwidth on Serial Interfaces</b></p> <p>You may recall from Chapter 9, "EIGRP," that you can use the <span class="cmd"><b>show interface</b></span> command to view the bandwidth value used for an interface. On Cisco routers, the bandwidth value on many serial interfaces defaults to T1 (1.544 Mbps). However, some serial interfaces may default to 128 kbps. Therefore, never assume that OSPF is using any particular bandwidth value. Always check the default value with the <span class="cmd"><b>show interface</b></span> command.</p> <p>Remember, this bandwidth value does not actually affect the speed of the link; it is used by some routing protocols to compute the routing metric. Most likely, on serial interfaces the actual speed of the link is different than the default bandwidth. It is important that the bandwidth value reflect the actual speed of the link so that the routing table has accurate best path information. For example, you may only be paying for a fractional T1 connection from your service provider, one fourth of a full T1 connection (384 kbps). However, for routing protocol purposes, the IOS assumes a T1 bandwidth value even though the interface is actually only sending and receiving one fourth of a full T1 connection (384 kbps).</p> <p>The figure shows the output for the Serial 0/0/0 interface on R1. The topology also now reflects the actual bandwidth of the link between the routers. Notice that the default bandwidth value in the command output for R1 is 1544 kbps. However, the actual bandwidth of this link is 64 kbps. This means that the router has routing information that does not accurately reflect the network topology. </p> <p><b>Click </b><span class="cmd"><b>show ip route</b> </span> <b>in the figure.</b></p> <p>The figure displays the routing table for R1. R1 believes that both of its serial interfaces are connected to T1 links, although one of the links is a 64 kbps link and the other one is a 256 kbps link. This results in R1's routing table having two equal-cost paths to the 192.168.8.0/30 network, when Serial 0/0/1 is actually the better path. </p> <span class="cmd"><p>O 192.168.10.8 [110/<span class="blue">128</span>] via 192.168.10.6, 00:03:41, Serial0/0/1</p></span> <span class="cmd"><p> [110/<span class="blue">128</span>] via 192.168.10.2, 00:03:41, Serial0/0/0</p></span> <p><b>Click </b><span class="cmd"><b>show ip ospf interface</b></span><b> in the figure.</b></p> <p>The calculated OSPF cost of an interface can be verified with the <span class="cmd"><b>show ip ospf interface</b></span> command. In the figure, we can verify that R1 is indeed assigning a cost of 64 to the Serial 0/0/0 interface. Although you might think that this is the correct cost because this interface is attached to a 64 kbps link, remember that cost is derived from the cost formula. The cost of a 64 kbps link is 1562 (100,000,000/64,000). The value of 64 displayed corresponds to the cost of a T1 link. In the next topic, you will learn how to modify the cost of all the links in the topology. </p></content-text>
</page>
</topic>
<topic type="" id="en0911030200">
<title><content-text>Modifying the Cost of the Link</content-text></title>
<page type="OneColumn" id="en0911030201">
<content-media type="InteractiveGraphicHotspots" id="cm8589941861"><title><content-text></content-text></title><media ref="en0911000000/en0911030000/en0911030200/en0911030201/cm8589941861.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911030000/en0911030200/en0911030201/cm8589941861text.xml"/></content-media>
<content-text><p>When the serial interface is not actually operating at the default T1 speed, the interface requires manual modification. Both sides of the link should be configured to have the same value. Both the <span class="cmd"><b>bandwidth</b></span> interface command or the <span class="cmd"><b>ip ospf cost</b></span> interface command achieve this purpose - an accurate value for use by OSPF in determining the best route.</p> <p><b>The </b><span class="cmd"><b>bandwidth</b></span><b> Command</b></p> <p>The <span class="cmd"><b>bandwidth</b></span> command is used to modify the bandwidth value used by the IOS in calculating the OSPF cost metric. The interface command syntax is the same syntax that you learned in Chapter 9, "EIGRP":</p> <p><span class="cmd">Router(config-if)#<b>bandwidth </b><i>bandwidth-kbps</i></span></p> <p>The figure shows the <span class="cmd"><b>bandwidth</b></span> commands used to modify the costs of all the serial interfaces in the topology. For R1, the <span class="cmd"><b>show ip ospf interface</b></span> command shows that the cost of the Serial 0/0/0 link is now 1562, the result of the Cisco OSPF cost calculation 100,000,000/64,000. </p></content-text>
</page>
<page type="OneColumn" id="en0911030202">
<content-media type="InteractiveGraphicHotspots" id="cm3580546285"><title><content-text></content-text></title><media ref="en0911000000/en0911030000/en0911030200/en0911030202/cm3580546285.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911030000/en0911030200/en0911030202/cm3580546285text.xml"/></content-media>
<content-text><p><b>The </b><span class="cmd"><b>ip ospf cost</b></span><b> Command</b></p> <p>An alternative method to using the <span class="cmd"><b>bandwidth</b></span> command is to use the <span class="cmd"><b>ip ospf cost</b></span> command, which allows you to directly specify the cost of an interface. For example, on R1 we could configure Serial 0/0/0 with the following command:</p> <span class="cmd"><p>R1(config)#<b>interface serial 0/0/0</b></p></span> <span class="cmd"><p>R1(config-if)#<b>ip ospf cost 1562</b></p></span> <p>Obviously, this would not change the output of the <span class="cmd"><b>show ip ospf interface</b></span> command, which still shows the cost as 1562. This is the same cost calculated by the IOS when we configured the bandwidth as 64.</p></content-text>
</page>
<page type="OneColumn" id="en0911030203">
<content-media type="StaticGraphic" id="cm7313756366"><title><content-text></content-text></title><media ref="en0911000000/en0911030000/en0911030200/en0911030203/cm7313756366.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911030000/en0911030200/en0911030203/cm7313756366text.xml"/></content-media>
<content-text><p><b>The </b><span class="cmd"> <b>bandwidth</b></span><b> Command vs. the </b><span class="cmd"><b>ip ospf cost</b></span><b> Command</b></p> <p>The <span class="cmd"><b>ip ospf cost</b></span> command is useful in multi-vendor environments where non-Cisco routers use a metric other than bandwidth to calculate the OSPF costs. The main difference between the two commands is that the <span class="cmd"><b>bandwidth</b></span> command uses the result of the cost calculation to determine the cost of the link. The <span class="cmd"><b>ip ospf cost</b></span> command bypasses this calculation by directly setting the cost of the link to a specific value.</p> <p>The figure shows the two alternatives that can be used in modifying the costs of the serial links in the topology. The right side of the figure shows the <span class="cmd"><b>ip ospf cost</b></span> command equivalents of the <span class="cmd"><b>bandwidth </b></span>commands on the left.</p></content-text>
</page>
<page type="OneColumn" id="en0911030204">
<content-media type="ActivityPKA" id="cm9333594841"><title><content-text></content-text></title><media ref="en0911000000/en0911030000/en0911030200/en0911030204/cm9333594841/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911030000/en0911030200/en0911030204/cm9333594841/icontext.xml"/></content-media>
<content-text><p>Use the Packet Tracer Activity to modify the cost values for OSPF.</p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="en0911040000">
<title><content-text>OSPF and Multiaccess Networks</content-text></title>
<topic type="" id="en0911040100">
<title><content-text>Challenges in Multiaccess Networks</content-text></title>
<page type="OneColumn" id="en0911040101">
<content-media type="StaticGraphic" id="cm2892312364"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040100/en0911040101/cm2892312364.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040100/en0911040101/cm2892312364text.xml"/></content-media>
<content-text><p>A <content-link target="cg1420035058" type="glossary">multiaccess network</content-link> is a network with more than two devices on the same shared media. In the top portion of the figure, the Ethernet LAN attached to R1 is extended to show possible devices that might be attached to the 172.16.1.16/28 network. Ethernet LANs are an example of a broadcast multiaccess network. They are broadcast networks because all devices on the network see all broadcast frames. They are multiaccess networks because there may be numerous hosts, printers, routers, and other devices that are all members of the same network. </p> <p>In contrast, on a point-to-point network there are only two devices on the network, one at each end. The WAN link between R1 and R3 is an example of a point-to-point link. The bottom portion of the figure shows the point-to-point link between R1 and R3.</p></content-text>
</page>
<page type="OneColumn" id="en0911040102">
<content-media type="AnimationPartialScreen" id="cm1180392974"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040100/en0911040102/cm1180392974.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040100/en0911040102/cm1180392974text.xml"/></content-media>
<content-text><p>OSPF defines five network types:</p> <p><ul><li> Point-to-point </li><li> Broadcast Multiaccess </li><li> Nonbroadcast Multiaccess (NBMA) </li><li> Point-to-multipoint </li><li> Virtual links</li></ul></p> <p>NBMA and point-to-multi-point networks include Frame Relay, ATM, and X.25 networks. NBMA networks are discussed in another CCNA course. Point-to-multipoint networks are discussed in CCNP. Virtual links are a special type of link that can be used in multi-area OSPF. OSPF virtual links are discussed in CCNP.</p> <p><b>Click Play to view the animation.</b></p> <p>The animation shows that the topology uses both point-to-point and broadcast networks.</p></content-text>
</page>
<page type="OneColumn" id="en0911040103">
<content-media type="StaticGraphic" id="cm7281665597"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040100/en0911040103/cm7281665597.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040100/en0911040103/cm7281665597text.xml"/></content-media>
<content-text><p>Multiaccess networks can create two challenges for OSPF regarding the flooding of LSAs:</p> <p>1. Creation of multiple adjacencies, one adjacency for every pair of routers.</p> <p>2. Extensive flooding of LSAs (Link-State Advertisements).</p> <p><b>Multiple Adjacencies</b></p> <p>The creation of an adjacency between every pair of routers in a network would create an unnecessary number of adjacencies. This would lead to an excessive number of LSAs passing between routers on the same network. </p> <p>To understand the problem with multiple adjacencies, we need to study a formula. For any number of routers (designated as <b>n</b>) on a multiaccess network, there will be <b>n ( n - 1 ) / 2</b> adjacencies. The figure shows a simple topology of five routers, all of which are attached to the same multiaccess Ethernet network. Without some type of mechanism to reduce the number of adjacencies, collectively these routers would form 10 adjacencies: <b>5 ( 5 - 1 ) / 2 = 10.</b> This may not seem like much, but as routers are added to the network, the number of adjacencies increases dramatically. Although the 5 routers in the figure will only need 10 adjacencies, you can see that 10 routers would require 45 adjacencies. Twenty routers would require 190 adjacencies!</p></content-text>
</page>
<page type="OneColumn" id="en0911040104">
<content-media type="AnimationPartialScreen" id="cm9356542215"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040100/en0911040104/cm9356542215.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040100/en0911040104/cm9356542215text.xml"/></content-media>
<content-text><p><b>Flooding of LSAs</b></p> <p>Remember from Chapter 10, "Link-State Routing Protocols," that link-state routers flood their link-state packets when OSPF is initialized or when there is a change in the topology.</p> <p><b>Click Play to see the animation of a scenario of LSA flooding.</b></p> <p>In a multiaccess network this flooding can become excessive. In the animation, R2 sends out an LSA. This event triggers every other router to also send out an LSA. Not shown in the animation are the required acknowledgements sent for every LSA received. If every router in a multiaccess network had to flood and acknowledge all received LSAs to all other routers on that same multiaccess network, the network traffic would become quite chaotic.</p> <p>To illustrate this point, imagine that you are in a room with a large number of people. What if everyone had to introduce themselves individually to everyone else? Not only would each person have to tell everyone their name, but whenever one person learned another person's name, that person would then have to tell everyone else in the room, one person at a time. As you can see, this process leads to chaos!</p></content-text>
</page>
<page type="OneColumn" id="en0911040105">
<content-media type="AnimationPartialScreen" id="cm5069815851"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040100/en0911040105/cm5069815851.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040100/en0911040105/cm5069815851text.xml"/></content-media>
<content-text><p><b>Solution: Designated Router</b></p> <p>The solution to managing the number of adjacencies and the flooding of LSAs on a multiaccess network is the Designated Router (DR). Continuing our previous example, this solution is analogous to electing someone in the room to go around and learn everyone's names and then announce these names to everyone in the room at once.</p> <p>On multiaccess networks, OSPF elects a Designated Router (DR) to be the collection and distribution point for LSAs sent and received. A Backup Designated Router (BDR) is also elected in case the Designated Router fails. All other routers become DROthers (this indicates a router that is neither the DR or the BDR).</p> <p><b>Click Play to see the animation of the role of DR.</b></p> <p>Routers on a multiaccess network elect a DR and BDR. DROthers only form full adjacencies with the DR and BDR in the network. This means that instead of flooding LSAs to all routers in the network, DROthers only send their LSAs to the DR and BDR using the multicast address 224.0.0.6 (ALLDRouters - All DR routers). In the animation, R1 sends LSAs to the DR. The BDR listens as well. The DR is responsible for forwarding the LSAs from R1 to all other routers. The DR uses the multicast address 224.0.0.5 (AllSPFRouters - All OSPF routers). The end result is that there is only one router doing all of the flooding of all LSAs in the multiaccess network. </p></content-text>
</page>
</topic>
<topic type="" id="en0911040200">
<title><content-text>DR/BDR Election Process</content-text></title>
<page type="OneColumn" id="en0911040201">
<content-media type="InteractiveGraphicHotspots" id="cm1650231404"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040200/en0911040201/cm1650231404.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040200/en0911040201/cm1650231404text.xml"/></content-media>
<content-text><p><b>Topology Change</b></p> <p>DR/BDR elections do not occur in point-to-point networks. Therefore, in a standard three-router topology, R1, R2, and R3 do not need to elect a DR and BDR, because the links between these routers are not multiaccess networks. </p> <p><b>Click Multiaccess Topology in the figure.</b></p> <p>For the rest of the discussion on DR and BDR, we will use the multiaccess topology shown in the figure. The names of the routers are different, solely to emphasize that this topology is not the same three-router topology we have been using up to this point. We will return to our chapter topology after the discussion of the DR/BDR election process. In this new topology, we have three routers sharing a common Ethernet multiaccess network, 192.168.1.0/24. Each router is configured with an IP address on the Fast Ethernet interface and a loopback address for the router ID.</p></content-text>
</page>
<page type="OneColumn" id="en0911040202">
<content-media type="InteractiveGraphicHotspots" id="cm8301589015"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040200/en0911040202/cm8301589015.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040200/en0911040202/cm8301589015text.xml"/></content-media>
<content-text><p><b>DR/BDR Election</b></p> <p>How do the DR and BDR get elected? The following criteria are applied:</p> <p>1. DR: Router with the highest OSPF interface priority.</p> <p>2. BDR: Router with the second highest OSPF interface priority. </p> <p>3. If OSPF interface priorities are equal, the highest router ID is used to break the tie.</p> <p>In this example, the default OSPF interface priority is 1. As a result, based on the selection criteria listed above, the OSPF router ID is used to elect the DR and BDR. As you can see, RouterC becomes the DR and RouterB, with the second highest router ID, becomes the BDR. Because RouterA is not elected as either the DR or BDR, it becomes the DROther.</p> <p>DROthers only form <b>FULL</b> adjacencies with the DR and BDR, but will still form a neighbor adjacency with any DROthers that join the network. This means that all DROther routers in the multiaccess network still receive Hello packets from all other DROther routers. In this way, they are aware of all routers in the network. When two DROther routers form a neighbor adjacency, the neighbor state is displayed as <b>2WAY</b>. The different neighbor states are discussed in CCNP.</p> <p><b>Click </b><span class="cmd"><b>show ip ospf neighbor</b></span><b> in the figure.</b></p> <p>The command output in the figure displays the neighbor adjacency of each router on the multiaccess network. Notice for RouterA that it shows that the DR is RouterC with the router ID of 192.168.31.33 and that the BDR is RouterB with the router ID of 192.168.31.22.</p> <p><b>Click </b><span class="cmd"><b>show ip ospf interface</b></span><b> in the figure.</b></p> <p>Because RouterA shows both its neighbors as the DR and BDR, RouterA is a DROther. This can be verified using the <span class="cmd"><b>show ip ospf interface fastethernet 0/0</b></span> command on RouterA, as shown in the figure. This command will show the DR, BDR, or DROTHER state of this router, along with the router ID of the DR and BDR on this multiaccess network.</p></content-text>
</page>
<page type="OneColumn" id="en0911040203">
<content-media type="InteractiveGraphicHotspots" id="cm8996082338"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040200/en0911040203/cm8996082338.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040200/en0911040203/cm8996082338text.xml"/></content-media>
<content-text><p><b>Timing of DR/BDR Election</b></p> <p>The DR and BDR election process takes place as soon as the first router with an OSPF enabled interface is active on the multiaccess network. This can happen when the routers are powered-on or when the OSPF <span class="cmd"><b>network</b></span> command for that interface is configured. The election process only takes a few seconds. If all of the routers on the multiaccess network have not finished booting, it is possible that a router with a lower router ID will become the DR. This could be a lower-end router that took less time to boot. </p> <p>When the DR is elected, it remains the DR until one of the following conditions occurs:</p> <p><ul><li> The DR fails.</li><li> The OSPF process on the DR fails.</li><li> The multiaccess interface on the DR fails.</li></ul></p> <p>In the figure, a red <b>X</b> indicates one or more of these failures.</p> <p><b>Click DR Fails in the figure.</b></p> <p>If the DR fails, the BDR assumes the role of DR and an election is held to choose a new BDR. In the figure, RouterC fails and the former BDR, RouterB, becomes DR. The only other router available to be BDR is RouterA.</p> <p><b>Click New Router in the figure.</b></p> <p>RouterD joins the network. If a new router enters the network after the DR and BDR have been elected, it will not become the DR or the BDR even if it has a higher OSPF interface priority or router ID than the current DR or BDR. The new router can be elected the BDR if the current DR or BDR fails. If the current DR fails, the BDR will become the DR, and the new router can be elected the new BDR. After the new router becomes the BDR, if the DR fails, then the new router will become the DR. The current DR and BDR must both fail before the new router can be elected DR or BDR. </p> <p><b>Click Old DR Returns in the figure.</b></p> <p>A previous DR does not regain DR status if it returns to the network. In the figure, RouterC has finished a reboot and becomes a DROther even though its router ID, 192.168.31.33, is higher than the current DR and BDR.</p> <p><b>Click BDR Fails in the figure.</b></p> <p>If the BDR fails, an election is held among the DRothers to see which router will be the new BDR. In the figure, the BDR router fails. An election is held between RouterC and RouterD. RouterD wins the election with the higher router ID.</p> <p><b>Click New DR Fails in the figure.</b></p> <p>In the figure, RouterB fails. Because RouterD is the current BDR, it is promoted to DR. RouterC becomes the BDR.</p> <p>So, how do you make sure that the routers you want to be DR and BDR win the election? Without further configurations, the solution is to either: </p> <p><ul><li> Boot up the DR first, followed by the BDR, and then boot all other routers, or</li><li> Shut down the interface on all routers, followed by a <span class="cmd"><b>no shutdown</b></span> on the DR, then the BDR, and then all other routers.</li></ul></p> <p>However, as you may have already guessed, we can change the OSPF interface priority to better control our DR/BDR elections.</p></content-text>
</page>
</topic>
<topic type="" id="en0911040300">
<title><content-text>OSPF Interface Priority</content-text></title>
<page type="OneColumn" id="en0911040301">
<content-media type="InteractiveGraphicHotspots" id="cm9121787259"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040300/en0911040301/cm9121787259.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911040000/en0911040300/en0911040301/cm9121787259text.xml"/></content-media>
<content-text><p>Because the DR becomes the focal point for the collection and distribution of LSAs, it is important for this router to have sufficient CPU and memory capacity to handle the responsibility. Instead of relying on the router ID to decide which routers are elected the DR and BDR, it is better to control the election of these routers with the <span class="cmd"><b>ip ospf priority</b></span> interface command.</p> <p><span class="cmd">Router(config-if)#<b>ip ospf priority</b> {<b>0 </b>- <b>255</b>}</span></p> <p>In our previous discussion, the OSPF priority was equal. This is because the priority value defaults to 1 for all router interfaces. Therefore, router ID determined the DR and BDR. But if you change the default value from 1 to a higher value, the router with the highest priority will become the DR and the router with the next highest priority will become the BDR. A value of 0 makes the router ineligible to become a DR or BDR. </p> <p>Because priorities are an interface-specific value, they provide better control of the OSPF multiaccess networks. They also allow a router to be the DR in one network and a DROther in another.</p> <p><b>Click </b><span class="cmd"><b>show ip ospf interface</b></span><b> in the figure.</b></p> <p>To simplify our discussion, we removed RouterD from the topology. The OSPF interface priority can be viewed using <span class="cmd"><b>show ip ospf interface</b></span> command. In the figure, we can verify that the priority on RouterA is at the default value of 1. </p> <p><b>Click Modify Priority in the figure.</b></p> <p>The figure shows the OSPF interface priorities of RouterA and RouterB modified so that RouterA with the highest priority becomes the DR and RouterB becomes the BDR. The OSPF interface priority of RouterC remains at the default value of 1.</p> <p><b>Click Force Election in the figure.</b></p> <p>After doing a <span class="cmd"><b>shutdown</b></span> and a <span class="cmd"><b>no shutdown</b></span> on the FastEthernet 0/0 interfaces of all three routers, we see the result of the change of OSPF interface priorities. The <span class="cmd"><b>show ip ospf neighbor</b></span> command on RouterC now shows that RouterA (Router ID 192.168.31.11) is the DR with the highest OSPF interface priority of 200 and that RouterB (Router ID 192.168.31.22) is still the BDR with the next highest OSPF interface priority of 100. Notice from RouterA's output of <span class="cmd"><b>show ip ospf neighbor</b></span> that it does not show a DR, because RouterA is the actual DR on this network. </p></content-text>
</page>
<page type="OneColumn" id="en0911040302">
<content-media type="ActivityPKA" id="cm9468065065"><title><content-text></content-text></title><media ref="en0911000000/en0911040000/en0911040300/en0911040302/cm9468065065/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911040000/en0911040300/en0911040302/cm9468065065/icontext.xml"/></content-media>
<content-text><p>Use this Packet Tracer Activity to examine current DR and BDR roles, watch the roles change, and then force new roles by changing priority.</p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="en0911050000">
<title><content-text>More OSPF Configuration</content-text></title>
<topic type="" id="en0911050100">
<title><content-text>Redistributing an OSPF Default Route</content-text></title>
<page type="OneColumn" id="en0911050101">
<content-media type="InteractiveGraphicHotspots" id="cm6772299099"><title><content-text></content-text></title><media ref="en0911000000/en0911050000/en0911050100/en0911050101/cm6772299099.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911050000/en0911050100/en0911050101/cm6772299099text.xml"/></content-media>
<content-text><p><b>Topology</b></p> <p>Let's return to the earlier topology, which now includes a new link to ISP. As with RIP and EIGRP, the router connected to the Internet is used to propagate a default route to other routers in the OSPF routing domain. This router is sometimes called the edge, entrance or gateway router. However, in OSPF terminology, the router located between an OSPF routing domain and a non-OSPF network is called the <content-link target="cg8572378873" type="glossary">Autonomous System Boundary Router (ASBR)</content-link>. In this topology, the Loopback1 (Lo1) represents a link to a non-OSPF network. We will not configure the 172.30.1.1/30 network as part of the OSPF routing process.</p> <p><b>Click R1 Static Default Configuration in the figure.</b></p> <p>The figure shows the ASBR (R1) configured with the Loopback1 IP address and static default route forwarding traffic toward the ISP router:</p> <p><span class="cmd">R1(config)#<b>ip route 0.0.0.0 0.0.0.0 loopback 1</b></span></p> <p><b>Note:</b> The static default route is using the loopback as an exit interface because the ISP router in this topology does not physically exist. By using a loopback interface, we can simulate the connection to another router.</p> <p>Like RIP, OSPF requires the use of the <span class="cmd"><b>default-information originate</b></span> command to advertise the 0.0.0.0/0 static default route to the other routers in the area. If the <span class="cmd"><b>default-information originate</b></span> command is not used, the default "quad-zero" route will not be propagated to other routers in the OSPF area. </p> <p>The command syntax is:</p> <p><span class="cmd">R1(config-router)#<b>default-information originate</b> </span></p> <p><b>Click R1, R2, and R3 in the figure.</b></p> <p>R1, R2, and R3 now have a "gateway of last resort" set in the routing table. Notice the default route in R2 and R3 with the routing source OSPF, but with the additional code, <span class="cmd"><b>E2</b></span>. For R2, the route is:</p> <p><span class="cmd">O*<span class="blue">E2</span> 0.0.0.0/0 [110/1] via 192.168.10.10, 00:05:34, Serial0/0/1</span></p> <p><b>E2</b> denotes that this route is an OSPF External Type 2 route. </p> <p>OSPF external routes fall in one of two categories: External Type 1 (E1) or External Type 2 (E2). The difference between the two is in the way the OSPF cost of the route is calculated at each router. OSPF accumulates cost for an E1 route as the route is being propagated throughout the OSPF area. This process is identical to cost calculations for normal OSPF internal routes. However, the cost of an E2 route is always the external cost, irrespective of the interior cost to reach that route. In this topology, because the default route has an external cost of 1 on the R1 router, R2 and R3 also show a cost of 1 for the default <b>E2</b> route. E2 routes at a cost of 1 are the default OSPF configuration. Changing these defaults, as well as more external route information, is discussed in CCNP.</p></content-text>
</page>
</topic>
<topic type="" id="en0911050200">
<title><content-text>Fine-tuning OSPF</content-text></title>
<page type="OneColumn" id="en0911050201">
<content-media type="InteractiveGraphicHotspots" id="cm1011211104"><title><content-text></content-text></title><media ref="en0911000000/en0911050000/en0911050200/en0911050201/cm1011211104.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911050000/en0911050200/en0911050201/cm1011211104text.xml"/></content-media>
<content-text><p><b>Reference Bandwidth</b></p> <p>As you remember, Cisco OSPF cost uses accumulated bandwidth. The bandwidth value of each interface is calculated using 100,000,000/bandwidth. 100,000,000 or 10 to the 8th is known as the reference bandwidth.</p> <p>Therefore, 100,000,000 is the default bandwidth referenced when the actual bandwidth is converted into a cost metric. As you know from previous studies, we now have link speeds that are much faster than Fast Ethernet speeds, including Gigabit Ethernet and 10GigE. Using a reference bandwidth of 100,000,000 results in interfaces with bandwidth values of 100 Mbps and higher having the same OSPF cost of 1. </p> <p>In order to obtain more accurate cost calculations, it may be necessary to adjust the reference bandwidth value. The reference bandwidth can be modified to accommodate these faster links by using the OSPF command <span class="cmd"><b>auto-cost reference-bandwidth</b></span>. When this command is necessary, use it on all routers so that the OSPF routing metric remains consistent.</p> <span class="cmd"><p>R1(config-router)#<b>auto-cost reference-bandwidth ?</b></p></span> <span class="cmd"><p> 1-4294967 The reference bandwidth in terms of Mbits per second</p></span> <p>Notice that the value is expressed in Mbps. Therefore, the default value is equivalent to 100. To increase it to 10GigE speeds, you would need to change the reference bandwidth to 10000.</p> <p><span class="cmd">R1(config-router)#<b>auto-cost reference-bandwidth 10000</b></span></p> <p>Again, make sure you configure this command on all routers in the OSPF routing domain. The IOS may also remind you, as shown in the figure.</p> <p><b>Click R1 Before and R1 After in the figure.</b></p> <p>The routing table for R1 shows the change in the OSPF cost metric. Notice that the values are much larger cost values for OSPF routes. For example, in <b>R1 Before</b>, the cost to 10.10.10.0/24 is <b>1172</b>. After configuring a new reference bandwidth, the cost for the same route is now <b>117287</b>.</p></content-text>
</page>
<page type="OneColumn" id="en0911050202">
<content-media type="InteractiveGraphicHotspots" id="cm3932849466"><title><content-text></content-text></title><media ref="en0911000000/en0911050000/en0911050200/en0911050202/cm3932849466.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911050000/en0911050200/en0911050202/cm3932849466text.xml"/></content-media>
<content-text><p><b>Modifying OSPF Intervals</b></p> <p><b>Click R1 Neighbors 1 in the figure.</b></p> <p>The <span class="cmd"><b>show ip ospf neighbor</b></span> command on R1 verifies that R1 is adjacent to R2 and R3. Notice in the output that the Dead Time is counting down from 40 seconds. By default, this value is refreshed every 10 seconds when R1 receives a Hello from the neighbor.</p> <p>It may be desirable to change the OSPF timers so that routers will detect network failures in less time. Doing this will increase traffic, but sometimes there is a need for quick convergence that outweighs the extra traffic.</p> <p>OSPF Hello and Dead intervals can be modified manually using the following interface commands:</p> <span class="cmd"><p>Router(config-if)#<b>ip ospf hello-interval </b><i>seconds</i></p></span> <span class="cmd"><p>Router(config-if)#<b>ip ospf dead-interval </b><i>seconds</i></p></span> <p><b>Click Modify R1 Timers in the figure.</b></p> <p>The figure shows the Hello and Dead intervals modified to 5 seconds and 20 seconds, respectively, on the Serial 0/0/0 interface for R1. Immediately after changing the Hello interval, Cisco IOS automatically modifies the Dead interval to four times the Hello interval. However, it is always good practice to explicitly modify the timer instead of relying on an automatic IOS feature so that modifications are documented in the configuration. </p> <p>After 20 seconds, the Dead Timer on R1 expires. R1 and R2 lose adjacency. We only modified the values on one side of the serial link between R1 and R2.</p> <p><span class="cmd">%OSPF-5-ADJCHG: Process 1, Nbr 10.2.2.2 on Serial0/0/0 from FULL to DOWN, Neighbor Down: Dead timer expired</span></p> <p><b>Click R1 Neighbors 2 in the figure.</b></p> <p>Remember, OSPF Hello and Dead intervals must be equivalent between neighbors. You can verify the loss of adjacency with the <span class="cmd"><b>show ip ospf neighbor</b></span> command on R1. Notice that the 10.2.2.2 neighbor is no longer present. However, 10.3.3.3 or R3 is still a neighbor. The timers set on Serial 0/0/0 do not affect the neighbor adjacency with R3.</p> <p><b>Click R2 Timers in the figure.</b></p> <p>The mismatching Hello and Dead intervals can be verified on R2 using <span class="cmd"><b>show ip ospf interface serial 0/0/0</b></span> command. The interval values on R2, Router ID 10.2.2.2, are still set with a Hello interval of 10 seconds and Dead interval of 40 seconds. </p> <p><b>Click Modify R2 Timers in the figure.</b></p> <p>To restore adjacency between R1 and R2, modify the Hello and Dead intervals on the Serial 0/0/0 interface on R2 to match the intervals on the Serial 0/0/0 interface on R1. The IOS displays a message that adjacency has been established with a state of <span class="cmd"><b>FULL</b></span>.</p> <p><span class="cmd">14:22:27: %OSPF-5-ADJCHG: Process 1, Nbr 10.1.1.1 on Serial0/0 from LOADING to FULL, Loading Done</span></p> <p><b>Click R1 Neighbors 3 in the figure.</b></p> <p>Verify that neighbor adjacency is restored with the show ip ospf neighbor command on R1. Notice that the Dead Time for Serial 0/0/0 is now much lower because it is counting down from 20 seconds instead of the default 40 seconds. Serial 0/0/1 is still operating with default timers.</p> <p><b>Note:</b> OSPF requires that the Hello and Dead intervals match between two routers for them to become adjacent. This differs from EIGRP where the Hello and Holddown timers do not need to match for two routers to form an EIGRP adjacency. </p> <p> </p></content-text>
</page>
<page type="OneColumn" id="en0911050203">
<content-media type="ActivityPKA" id="cm2090191812"><title><content-text></content-text></title><media ref="en0911000000/en0911050000/en0911050200/en0911050203/cm2090191812/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911050000/en0911050200/en0911050203/cm2090191812/icontext.xml"/></content-media>
<content-text><p>Use the Packet Tracer Activity to configure a default route and propagate it within the OSPF routing process. Also, practice changing the reference bandwidth as well as the Hello and Dead intervals.</p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="en0911060000">
<title><content-text>OSPF Configuration Labs</content-text></title>
<topic type="" id="en0911060100">
<title><content-text>Basic OSPF Configuration Lab</content-text></title>
<page type="OneColumn" id="en0911060101">
<content-media type="ActivityLab" id="cm1737336076"><title><content-text></content-text></title><media ref="en0911000000/en0911060000/en0911060100/en0911060101/cm1737336076/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911060000/en0911060100/en0911060101/cm1737336076/icontext.xml"/></content-media>
<content-text><p>In this lab activity, there are two separate scenarios. In the first scenario, you will learn how to configure the routing protocol OSPF using the network shown in the Topology Diagram in Scenario A. The segments of the network have been subnetted using VLSM. OSPF is a classless routing protocol that can be used to provide subnet mask information in the routing updates. This will allow VLSM subnet information to be propagated throughout the network. </p> <p>In the second scenario, you will learn to configure OSPF on a multi-access network. You will also learn to use the OSPF election process to determine the designated router (DR), backup designated router (BDR), and DRother states.</p></content-text>
</page>
<page type="OneColumn" id="en0911060102">
<content-media type="ActivityPKA" id="cm1867715526"><title><content-text></content-text></title><media ref="en0911000000/en0911060000/en0911060100/en0911060102/cm1867715526/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911060000/en0911060100/en0911060102/cm1867715526/icontext.xml"/></content-media>
<content-text><p>Use this Packet Tracer Activity to repeat a simulation of Lab 11.6.1. Remember, however, that Packet Tracer is not a substitute for a hands-on lab experience with real equipment. </p> <p>A summary of the instructions is provided within the activity. Use the Lab PDF for more details.</p> <p><b>Clicking the Packet Tracer icon will launch Scenario A. All scenarios for this simulation of the hands-on lab can be launched from the links below.</b></p> <p><content-link target="E2_PTAct_11_6_1a.pka" type="internalfile">Scenario A</content-link></p> <p><content-link target="E2_PTAct_11_6_1b.pka" type="internalfile">Scenario B</content-link></p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
<topic type="" id="en0911060200">
<title><content-text>Challenge OSPF Configuration Lab</content-text></title>
<page type="OneColumn" id="en0911060201">
<content-media type="ActivityLab" id="cm3141260913"><title><content-text></content-text></title><media ref="en0911000000/en0911060000/en0911060200/en0911060201/cm3141260913/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911060000/en0911060200/en0911060201/cm3141260913/icontext.xml"/></content-media>
<content-text><p>In this lab activity, you will be given a network address that must be subnetted using VLSM to complete the addressing of the network shown in the Topology Diagram. A combination OSPF routing and static routing will be required so that hosts on networks that are not directly connected will be able to communicate with each other. OSPF area ID of 0 and process ID of 1 will be used in all OSPF configurations.</p></content-text>
</page>
<page type="OneColumn" id="en0911060202">
<content-media type="ActivityPKA" id="cm9785155336"><title><content-text></content-text></title><media ref="en0911000000/en0911060000/en0911060200/en0911060202/cm9785155336/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911060000/en0911060200/en0911060202/cm9785155336/icontext.xml"/></content-media>
<content-text><p>Use this Packet Tracer Activity to repeat a simulation of Lab 11.6.2. Remember, however, that Packet Tracer is not a substitute for a hands-on lab experience with real equipment. </p> <p>A summary of the instructions is provided within the activity. Use the Lab PDF for more details.</p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
<topic type="" id="en0911060300">
<title><content-text>Troubleshooting OSPF Configuration Lab</content-text></title>
<page type="OneColumn" id="en0911060301">
<content-media type="ActivityLab" id="cm7917924119"><title><content-text></content-text></title><media ref="en0911000000/en0911060000/en0911060300/en0911060301/cm7917924119/" mime="application/pdf" scale="icontext.xml" type="directory" width="0" height="0" external="en0911000000/en0911060000/en0911060300/en0911060301/cm7917924119/icontext.xml"/></content-media>
<content-text><p>In this lab, you will begin by loading configuration scripts on each of the routers. These scripts contain errors that will prevent end-to-end communication across the network. </p> <p>You will need to troubleshoot each router to determine the configuration errors, and then use the appropriate commands to correct the configurations. </p> <p>When you have corrected all of the configuration errors, all of the hosts on the network should be able to communicate with each other. </p></content-text>
</page>
<page type="OneColumn" id="en0911060302">
<content-media type="ActivityPKA" id="cm5792827552"><title><content-text></content-text></title><media ref="en0911000000/en0911060000/en0911060300/en0911060302/cm5792827552/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911060000/en0911060300/en0911060302/cm5792827552/icontext.xml"/></content-media>
<content-text><p>Use this Packet Tracer Activity to repeat a simulation of Lab 11.6.3. Remember, however, that Packet Tracer is not a substitute for a hands-on lab experience with real equipment. </p> <p>A summary of the instructions is provided within the activity. Use the Lab PDF for more details.</p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterSummary" id="en0911070000">
<title><content-text>Chapter Summary</content-text></title>
<topic type="" id="en0911070100">
<title><content-text>Summary and Review</content-text></title>
<page type="OneColumn" id="en0911070101">
<content-media type="StaticGraphic" id="cm6481762101"><title><content-text></content-text></title><media ref="en0911000000/en0911070000/en0911070100/en0911070101/cm6481762101.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911070000/en0911070100/en0911070101/cm6481762101text.xml"/></content-media>
<content-text><p><b>Summary</b></p> <p>OSPF (Open Shortest Path First) is a classless, link-state routing protocol. The current version of OSPF for IPv4 is OSPFv2 introduced in RFC 1247 and updated in RFC 2328 by John Moy. In 1999, OSPFv3 for IPv6 was published in RFC 2740.</p> <p>OSPF has a default administrative distance of 110, and is denoted in the routing table with a route source code of <b>O</b>. OSPF is enabled with the <span class="cmd"><b>router ospf </b><i>process-id</i></span> global configuration command. The <span class="cmd"><i>process-id</i></span> is locally significant, which means that it does not have to match other OSPF routers in order to establish adjacencies with those neighbors.</p> <p>The network command used with OSPF has the same function as when used with other IGP routing protocols, but with slightly different syntax. </p> <p><span class="cmd">Router(config-router)#<b>network </b><i>network-address wildcard-mask</i><b> area </b><i>area-id</i></span></p> <p>The <span class="cmd"><i>wildcard-mask</i></span> is the inverse of the subnet mask, and the <span class="cmd"><i>area-id</i></span> should be set to 0.</p> <p>OSPF does not use a Transport layer protocol, as OSPF packets are sent directly over IP. The OSPF Hello packet is used by OSPF to establish neighbor adjacencies. By default, OSPF Hello packets are sent every 10 seconds on multiaccess and point-to-point segments and every 30 seconds on non-broadcast multiaccess (NBMA) segments (Frame Relay, X.25, ATM). The Dead interval is the period of time an OSPF router will wait before terminating adjacency with a neighbor. The Dead interval is four times the Hello interval, by default. For multiaccess and point-to-point segments, this period is 40 seconds. For NBMA networks, the Dead interval is 120 seconds.</p> <p>For routers to become adjacent, their Hello interval, Dead interval, network types and subnet masks must match. The <span class="cmd"><b>show ip ospf neighbors</b></span> command can be used to verify OSPF adjacencies.</p> <p>The OSPF router ID is used to uniquely identify each router in the OSPF routing domain. Cisco routers derive the router ID based on three criteria and with the following precedence:</p> <p>1. Use the IP address configured with the OSPF <span class="cmd"><b>router-id</b></span> command.</p> <p>2. If the <span class="cmd"><b>router-id</b></span> is not configured, the router chooses highest IP address of any of its loopback interfaces.</p> <p>3. If no loopback interfaces are configured, the router chooses highest active IP address of any of its physical interfaces.</p> <p>RFC 2328 does not specify which values should be used to determine the cost. Cisco IOS uses the cumulative bandwidths of the outgoing interfaces from the router to the destination network as the cost value.</p> <p>Multiaccess networks can create two challenges for OSPF regarding the flooding of LSAs, including the creation of multiple adjacencies - one adjacency for every pair of routers, and extensive flooding of LSAs (Link-State Advertisements). OSPF elects a DR (Designated Router) to act as collection and distribution point for LSAs sent and received in the multiaccess network. A BDR (Backup Designated Router) is elected to take over the role of the DR should the DR fail. All other routers are known as DROthers. All routers send their LSAs to the DR, which then floods the LSA to all other routers in the multiaccess network. </p> <p>The router with the highest router ID is the DR, and the router with the second highest router ID is the BDR. This can be superseded by the <span class="cmd"><b>ip ospf priority</b></span> command on that interface. By default, the <span class="cmd"><b>ip ospf priority</b></span> is "1" on all multiaccess interfaces. If a router is configured with a new priority value, the router with the highest priority value is the DR, and next-highest the BDR. A priority value of "0" means the router is ineligible to become the DR or BDR.</p> <p>A default route is propagated in OSPF similar to that of RIP. The OSPF router mode command, <span class="cmd"><b>default-information originate</b></span> is used to propagate a static default route.</p> <p>The <span class="cmd"><b>show ip protocols</b></span> command is used to verify important OSPF configuration information, including the OSPF process ID, the router ID and the networks the router is advertising.</p></content-text>
</page>
<page type="FullScreen" id="en0911070102">
<content-media type="ChapterSummary" id="cm4988293699"><title><content-text></content-text></title><media ref="en0911000000/en0911070000/en0911070100/en0911070102/cm4988293699.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911070000/en0911070100/en0911070102/cm4988293699text.xml"/></content-media>
<content-text></content-text>
</page>
<page type="OneColumn" id="en0911070103">
<content-media type="ActivityPKA" id="cm4174693481"><title><content-text></content-text></title><media ref="en0911000000/en0911070000/en0911070100/en0911070103/cm4174693481/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0911000000/en0911070000/en0911070100/en0911070103/cm4174693481/icontext.xml"/></content-media>
<content-text><p>The Packet Tracer Skills Integration Challenge Activity integrates all the knowledge and skills you acquired in previous chapters of this course and prior courses. Skills related to this chapter's discussion of OSPF are also included. </p> <p>In this activity, you build a network from the ground up. Starting with an addressing space and network requirements, you must implement a network design that satisfies the specifications. Next, you implement an effective OSPF routing configuration with integrated default routing. Detailed instructions are provided within the activity. </p> <p><content-link target="E2_PTAct_11_7_1_Directions.pdf" type="internalfile">Packet Tracer Skills Integration Instructions (PDF)</content-link></p><p><b>Click the packet tracer icon for more details.</b></p></content-text>
</page>
<page type="OneColumn" id="en0911070104">
<content-media type="StaticGraphic" id="cm9917528955"><title><content-text></content-text></title><media ref="en0911000000/en0911070000/en0911070100/en0911070104/cm9917528955.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0911000000/en0911070000/en0911070100/en0911070104/cm9917528955text.xml"/></content-media>
<content-text><p><b>To Learn More</b></p> <p> </p> <p><b>RFC 2328 OSPF version 2</b></p> <p>RFCs (Request for Comments) are a series of documents submitted to the IETF (Internet Engineering Task Force) to propose an Internet standard or convey new concepts, information or even occasionally even humor. RFC 2328 is the current RFC for OSPFv2. </p> <p>RFCs can be accessed from several web sites including <content-link target="http://www.ietf.org" type="external">www.ietf.org</content-link>. Read all or parts of RFC OSPF to learn more about this classless, link-state routing protocol. </p> <p><b>Multi-area OSPF</b></p> <p>Some of the real advantages of OSPF especially in large networks can be seen with multi-area OSPF. Multi-area OSPF is discussed in CCNP, but you may be interested in looking at some of these new concepts now. </p> <p>Here are some suggested resources:</p> <p><ul><li> <i>Routing TCP/IP, Volume I</i>, by Jeff Doyle and Jennifer Carroll</li><li> <i>OSPF, Anatomy of an Internet Routing Protocol</i>, by John Moy</li></ul></p></content-text>
</page>
</topic>
</section>
<section type="ChapterQuiz" id="en0911080000">
<title><content-text>Chapter Quiz</content-text></title>
<topic type="" id="en0911080100">
<title><content-text>Chapter Quiz</content-text></title>
<page type="FullScreen" id="en0911080101">
<content-media type="ChapterQuiz" id="cm6500755456"><title><content-text></content-text></title><media ref="en0911000000/en0911080000/en0911080100/en0911080101/cm6500755456/" mime="" scale="true" type="directory" width="100%" height="100%" external="en0911000000/en0911080000/en0911080100/en0911080101/cm6500755456/icontext.xml"/></content-media>
<content-text></content-text>
</page>
</topic>
</section>
</chapter>
