<chapter type="" id="en0908000000">
<title><content-text>The Routing Table: A Closer Look</content-text></title>
<section type="ChapterIntroduction" id="en0908000000">
<title><content-text>Chapter Introduction</content-text></title>
<topic type="" id="en0908000100">
<title><content-text>Chapter Introduction</content-text></title>
<page type="OneColumn" id="en0908000101">
<content-media type="StaticGraphic" id="cm9355873355"><title><content-text></content-text></title><media ref="en0908000000/en0908000000/en0908000100/en0908000101/cm9355873355.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908000000/en0908000100/en0908000101/cm9355873355text.xml"/></content-media>
<content-text><p>In previous chapters, we examined the routing table using the <span class="cmd"><b>show ip route</b></span> command. We saw how directly connected, static, and dynamic routes are added and deleted from the routing table.</p> <p>As a network administrator, it is important to know the routing table in depth when troubleshooting network issues. Understanding the structure and lookup process of the routing table will help you diagnose <i>any</i> routing table issue - regardless of your level of familiarity with a particular routing protocol. For example, you may encounter a situation in which the routing table has all of the routes you would expect to see, but packet forwarding is not performing as expected. Knowing how to step through the lookup process of a destination IP address for a packet will give you the ability to determine if the packet is being forwarded as expected, if and why the packet is being sent elsewhere, or if the packet has been discarded.</p> <p>In this chapter, we will take a closer look at the routing table. The first part of the chapter focuses on the structure of Cisco's IP routing table. We will examine the format of the routing table and learn about level 1 and level 2 routes. The second part of the chapter analyzes the lookup process of the routing table. We will discuss classful routing behavior, as well as classless routing behavior, which uses the <span class="cmd">no ip classless</span> and <span class="cmd">ip classless</span> commands.</p> <p>Many of the details regarding the structure and lookup process of the Cisco IP routing table have been omitted from this chapter. If you are interested in reading more about this subject and the inner workings of the Cisco IOS as it pertains to routing, see <i>Cisco IP Routing, </i>by Alex Zinin (ISBN 0-201-60473-6). </p> <p><b>Note:</b> This book is <i>not</i> a beginner's book on routing protocols - it is a thorough examination of the protocols, processes, and algorithms used by the Cisco IOS.</p></content-text>
</page>
</topic>
</section>
<section type="" id="en0908010000">
<title><content-text>The Routing Table Structure</content-text></title>
<topic type="" id="en0908010100">
<title><content-text>Lab Topology</content-text></title>
<page type="OneColumn" id="en0908010101">
<content-media type="StaticGraphic" id="cm8851252050"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010100/en0908010101/cm8851252050.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010100/en0908010101/cm8851252050text.xml"/></content-media>
<content-text><p>In this chapter, we will be using a simple three router network, as shown in the figure. R1 and R2 share a common 172.16.0.0/16 network with 172.16.0.0/24 subnets. R2 and R3 are connected by the 192.168.1.0/24 network. Notice that R3 also has a 172.16.4.0/24 subnet that is disconnected, or discontiguous, from the 172.16.0.0 network that R1 and R2 share. The effects of this discontiguous subnet will be examined later in this chapter when we look at the route lookup process.</p> <p><b>Click R1 and R3 in the figure.</b></p> <p>The interface configurations for R1 and R3 are also shown in the figure. In a later section, we will configure the interfaces for R2.</p></content-text>
</page>
</topic>
<topic type="" id="en0908010200">
<title><content-text>Routing Table Entries</content-text></title>
<page type="OneColumn" id="en0908010201">
<content-media type="StaticGraphic" id="cm3805096568"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010200/en0908010201/cm3805096568.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010200/en0908010201/cm3805096568text.xml"/></content-media>
<content-text><p>The sample routing table in the figure consists of route entries from the following sources:</p> <ul><li> Directly connected networks</li> <li> Static routes</li> <li> Dynamic routing protocols</li></ul> <p>The source of the route does not affect the structure of the routing table. The figure shows a sample routing table with directly connected, static, and dynamic routes. Notice that the 172.16.0.0/24 subnets have a combination of all three types of routing sources.</p> <p><b>Note:</b> The routing table hierarchy in Cisco IOS was originally implemented with the classful routing scheme. Although the routing table incorporates both classful and classless addressing, the overall structure is still built around this classful scheme.</p></content-text>
</page>
</topic>
<topic type="" id="en0908010300">
<title><content-text>Level 1 Routes</content-text></title>
<page type="OneColumn" id="en0908010301">
<content-media type="StaticGraphic" id="cm6203542146"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010300/en0908010301/cm6203542146.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010300/en0908010301/cm6203542146text.xml"/></content-media>
<content-text><p>Routers R1 and R3 already have their interfaces configured with the appropriate IP addresses and subnet masks. We will now configure the interfaces for R2 and use <span class="cmd"><b>debug ip routing</b></span> to view the routing table process that is used to add these entries.</p> <p>The figure shows what happens as the Serial 0/0/1 interface for R2 is configured with the 192.168.1.1/24 address. As soon as <span class="cmd"><b>no shutdown</b></span> is entered, the output from <span class="cmd"><b>debug ip routing</b></span> shows that this route has been added to the routing table. </p></content-text>
</page>
<page type="OneColumn" id="en0908010302">
<content-media type="StaticGraphic" id="cm9102756252"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010300/en0908010302/cm9102756252.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010300/en0908010302/cm9102756252text.xml"/></content-media>
<content-text><p>In the figure, <span class="cmd"><b>show ip route</b></span> displays the directly connected network in the routing table that we just added to R2.</p> <p>The Cisco IP routing table is not a flat database. The routing table is actually a hierarchical structure that is used to speed up the lookup process when locating routes and forwarding packets. Within this structure, the hierarchy includes several levels. For simplicity, we will discuss all routes as one of two levels: level 1 or level 2.</p></content-text>
</page>
<page type="OneColumn" id="en0908010303">
<content-media type="StaticGraphic" id="cm9475810933"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010300/en0908010303/cm9475810933.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010300/en0908010303/cm9475810933text.xml"/></content-media>
<content-text><p>Let's learn about level 1 and level 2 routes by reviewing the routing table entry in more detail. </p> <span class="cmd"><p>C 192.168.1.0/24 is directly connected, Serial0/0/1</p></span> <p><b>A level 1 route is a route with a subnet mask equal to or less than the classful mask of the network address.</b> 192.168.1.0/24 is a level 1 network route, because the subnet mask is equal to the network's classful mask. /24 is the classful mask for class C networks, such as the 192.168.1.0 network.</p> <p>A level 1 route can function as a:</p> <ul><li> <b>Default route</b> - A default route is a static route with the address 0.0.0.0/0.</li> <li> <b><content-link target="cg5428356456" type="glossary">Supernet route</content-link></b> - A supernet route is a network address with a mask less than the classful mask. </li> <li> <b>Network route</b> - A network route is a route that has a subnet mask equal to that of the classful mask. A network route can also be a parent route. Parent routes will be discussed in the next section.</li></ul> <p>The source of the level 1 route can be a directly connected network, static route, or a dynamic routing protocol.</p></content-text>
</page>
<page type="OneColumn" id="en0908010304">
<content-media type="StaticGraphic" id="cm5327504186"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010300/en0908010304/cm5327504186.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010300/en0908010304/cm5327504186text.xml"/></content-media>
<content-text><p><b><content-link target="cg1597835227" type="glossary">Ultimate Route</content-link></b></p> <p>The level 1 route 192.168.1.0/24 can be further defined as an <i>ultimate route</i>. An ultimate route is a route that includes:</p> <ul><li> either a next-hop IP address (another path)</li> <li> and/or an exit interface </li></ul> <p>The directly connected network 192.168.1.0/24 is a level 1 network route because it has a subnet mask that is the same as its classful mask. This same route is also an ultimate route because it contains the exit interface Serial 0/0/1. </p> <span class="cmd"><p>C 192.168.1.0/24 is directly connected, <span class="blue">Serial0/0/1</span></p></span> <p>We will see in the next topic that level 2 routes are also ultimate routes.</p></content-text>
</page>
</topic>
<topic type="" id="en0908010400">
<title><content-text>Parent and Child Routes: Classful Networks</content-text></title>
<page type="OneColumn" id="en0908010401">
<content-media type="StaticGraphic" id="cm5547703407"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010400/en0908010401/cm5547703407.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010400/en0908010401/cm5547703407text.xml"/></content-media>
<content-text><p>In the previous topic, we saw a level 1 network route that was also an ultimate route. Now let's take a look at another type of level 1 network route, a parent route. The figure shows the configuration of the 172.16.3.1/24 interface on R2 and the output from the <span class="cmd"><b>show ip route</b></span> command. Notice that there are actually two additional entries in the routing table. One entry is the parent route and the other entry is the child route. Why are there two entries instead of one?</p> <p><b>Click Parent and Child in the figure.</b></p> <p>When the 172.16.3.0 subnet was added to the routing table, another route, 172.16.0.0, was also added. The first entry, 172.16.0.0/24, does not contain any next-hop IP address or exit interface information. This route is known as a <i>level 1 parent route</i>.</p></content-text>
</page>
<page type="OneColumn" id="en0908010402">
<content-media type="StaticGraphic" id="cm2467102352"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010400/en0908010402/cm2467102352.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010400/en0908010402/cm2467102352text.xml"/></content-media>
<content-text><p><b>A level 1 parent route is a network route that does not contain a next-hop IP address or exit interface for any network.</b> A parent route is actually a heading that indicates the presence of level 2 routes, also known as <i>child routes</i>. A level 1 parent route is automatically created any time a subnet is added to the routing table. In other words, a parent route is created whenever a route with a mask greater than the classful mask is entered into the routing table. The subnet is the level 2 child route of the parent route. In this case, the level 1 parent route that was automatically created is: </p> <span class="cmd"><p>172.16.0.0/24 is subnetted, 1 subnets</p></span> <p><b>A level 2 route is a route that is a subnet of a classful network address. </b>Like a level 1 route, the source of a level 2 route can be a directly connected network, a static route, or a dynamic routing protocol. In this case, the level 2 route is the actual subnet route that was added to the network when we configured the FastEthernet 0/0 interface:</p> <span class="cmd"><p>C 172.16.3.0 is directly connected, FastEthernet0/0</p></span> <p><b>Note</b>: Remember that the routing table hierarchy in Cisco IOS has a classful routing scheme. A level 1 parent route is the classful network address of the subnet route. This is the case even if a classless routing protocol is the source of the subnet route.</p></content-text>
</page>
<page type="OneColumn" id="en0908010403">
<content-media type="AnimationPartialScreen" id="cm2204970606"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010400/en0908010403/cm2204970606.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010400/en0908010403/cm2204970606text.xml"/></content-media>
<content-text><p><b>Click Play to view the animation.</b></p> <p>Let's analyze the routing table entries for both the level 1 parent route and the level 2 child route (subnet).</p> <p><b>Level 1 Parent Route</b></p> <p>This parent route contains the following information:</p> <ul><li> <span class="cmd">172.16.0.0</span> - The classful network address for our subnet. Remember, the Cisco IP routing table is structured in a classful manner.</li> <li> <span class="cmd">/24</span> - The subnet mask for all of the child routes. If the child routes have variable length subnet masks (VLSM), the subnet mask will be excluded from the parent route and included with the individual child routes. This will be shown in a later section.</li> <li> <span class="cmd">is subnetted, 1 subnet</span> - This part of the route specifies that this is a parent route and in this case has one child route, that is, 1 subnet.</li></ul> <p><b>Level 2 Child Route</b></p> <p>The second entry, 172.16.3.0, is the actual route for our directly connected network. This is a level 2 route, also known as a child route, and contains the following information:</p> <ul><li> <span class="cmd">C</span> - The route code for directly connected network.</li> <li> <span class="cmd">172.16.3.0</span> - The specific route entry.</li> <li> <span class="cmd">is directly connected</span> - Along with the route code of C, this specifies that this is a directly connected network with an administrative distance of 0.</li> <li> <span class="cmd">FastEthernet0/0</span> - The exit interface for forwarding packets that match this specific route entry. </li></ul> <p>The level 2 child route is the specific route entry for the 172,16.3.0/24 subnet. Notice that the subnet mask is not included with the subnet, the level 2 child route. The subnet mask for this child route (subnet) is the /24 mask included in its parent route, 172.16.0.0. </p> <p>Level 2 child routes contain the route source and the network address of the route. <b>Level 2 child routes are also considered ultimate routes because they will contain the next-hop IP address and/or exit interface.</b> </p></content-text>
</page>
<page type="OneColumn" id="en0908010404">
<content-media type="StaticGraphic" id="cm2661103299"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010400/en0908010404/cm2661103299.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010400/en0908010404/cm2661103299text.xml"/></content-media>
<content-text><p>The figure shows the configuration of the Serial 0/0/0 interface on R2. </p> <p><b>Click 2 and 3 in the figure.</b></p> <p>The routing table shows two child routes for the same 172.16.0.0/24 parent route. Both 172.16.2.0 and 172.16.3.0 are members of the same parent route, because they are both members of the 172.16.0.0/16 classful network. </p></content-text>
</page>
<page type="OneColumn" id="en0908010405">
<content-media type="StaticGraphic" id="cm6818426136"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010400/en0908010405/cm6818426136.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010400/en0908010405/cm6818426136text.xml"/></content-media>
<content-text><p>Because both child routes have the same subnet mask, the parent route still maintains the /24 mask, but now shows 2 subnets. The role of the parent route will be examined when we discuss the route lookup process.</p> <p><b>Note:</b> If there is only a single level 2 child route and that route is removed, the level 1 parent route will be automatically deleted. A level 1 parent route exists only when there is at least one level 2 child route.</p></content-text>
</page>
</topic>
<topic type="" id="en0908010500">
<title><content-text>Parent and Child Routes: Classless Networks</content-text></title>
<page type="OneColumn" id="en0908010501">
<content-media type="StaticGraphic" id="cm9883169619"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010500/en0908010501/cm9883169619.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010500/en0908010501/cm9883169619text.xml"/></content-media>
<content-text><p>For this discussion, we will use the topology shown in the figure. Using RouterX with the VLSM configuration shown, we can examine the effect of VLSM on the routing table. RouterX has three directly connected networks. All three subnets belong to the classful network 172.16.0.0/16 and are therefore level 2 child routes. </p> <p><b>Click 2, 3, and 4 in the figure.</b></p> <p>Notice that our child routes do not share the same subnet mask, as was in the case in the classful example. In this case, we are implementing a network addressing scheme with VLSM. </p> <p><b>Click 1 in the figure.</b></p> <p>Whenever there are two or more child routes with different subnet masks belonging to the same classful network, the routing table presents a slightly different view, which states that this parent network is <span class="cmd"><b>variably subnetted</b></span>.</p> <p>Although the parent/child relationship uses a classful structure to display networks and their subnets, this format can be used with both classful and classless addressing. <b>Regardless of the addressing scheme used by the network (classless or classful), the routing table will use a classful scheme.</b></p></content-text>
</page>
<page type="OneColumn" id="en0908010502">
<content-media type="AnimationPartialScreen" id="cm9161466938"><title><content-text></content-text></title><media ref="en0908000000/en0908010000/en0908010500/en0908010502/cm9161466938.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908010000/en0908010500/en0908010502/cm9161466938text.xml"/></content-media>
<content-text><p><b>Click Play to view the animation.</b></p> <p>There are several distinct differences with this parent route and its child routes compared to the classful example discussed earlier. First, the parent route of 172.16.0.0 now contains the classful mask /16. In the classful example earlier, the classful mask was not displayed. </p> <p>Also notice that the parent route states that the child routes are <span class="cmd">"variably subnetted"</span>. Like the classful example, the parent route displays the number of subnets, but now it also includes the number of different masks of the child routes.</p> <p>The final difference between classful and classless networks exists in the child routes. Each child route now contains the subnet mask for that specific route. In the non-VLSM example, both child routes shared the same subnet mask and the parent displayed their common subnet mask. With VLSM, the various subnet masks are displayed with the specific child routes.</p> <p>The parent route contains the following information:</p> <ul><li> <span class="cmd"><b>172.16.0.0</b></span> - The parent route, the classful network address associated with all child routes.</li> <li> <span class="cmd"><b>/16</b></span> - The classful subnet mask of the parent route.</li> <li> <span class="cmd"><b>variably subnetted</b></span> - States that the child routes are variably subnetted and that there are multiple masks for this classful network.</li> <li> <span class="cmd"><b>3 subnets, 2 masks</b></span> - Indicates the number of subnets and the number of different subnet masks for the child routes under this parent route.</li></ul> <p>Using one of the child routes as an example, we can see the following information:</p> <ul><li> <span class="cmd"><b>C</b></span> - The route code for a directly connected network.</li> <li> <span class="cmd"><b>172.16.1.4</b></span> - The specific route entry.</li> <li> <span class="cmd">/30</span> - The subnet mask for this specific route.</li> <li> <span class="cmd"><b>is directly connected</b></span> - Along with the route code of C, specifies that this is a directly connected network with an administrative distance of 0.</li> <li> <span class="cmd"><b>Serial0/0/0</b></span> - The exit interface for forwarding packets that match this specific route entry. </li></ul> <p>So, why does Cisco use the classful routing table format? We will understand the answer to this in the following sections when the route lookup process is discussed.</p></content-text>
</page>
</topic>
</section>
<section type="" id="en0908020000">
<title><content-text>Routing Table Lookup Process</content-text></title>
<topic type="" id="en0908020100">
<title><content-text>Steps in the Route Lookup Process</content-text></title>
<page type="OneColumn" id="en0908020101">
<content-media type="InteractiveGraphicHotspots" id="cm7151761710"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020100/en0908020101/cm7151761710.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020100/en0908020101/cm7151761710text.xml"/></content-media>
<content-text><p>In this topology, RIPv1, a classful routing protocol, is now configured. Notice that we have specifically chosen a classful routing protocol with our discontiguous 172.16.0.0 subnets. The reason for this will become evident in a later section. </p> <p><b>Click the buttons in the figure to review the RIP configuration and resulting routing tables.</b></p> <p>As you would expect with this addressing scheme and a classful routing protocol, there are reachability problems. Neither R1 nor R2 has a route to 172.16.4.0. Also, R3 does not have routes to subnets 172.16.1.0/24, 172.16.2.0/24, or 172.16.3.0/24. </p> <p>Let's examine in more depth how the routers determine the best routes to use when sending packets and why classful routing protocols do not work with discontiguous designs. We will consider:</p> <p>1. What happens when a router receives an IP packet, examines the IP destination address, and looks that address up in the routing table? </p> <p>2. How does the router decide which route in the routing table is the best match?</p> <p>3. What effect does the subnet mask have on the routing table lookup process?</p> <p>4. How does the router decide whether or not to use a supernet or default route if a better match is not found?</p> <p>Let's begin to answer these questions by examining the steps in the route lookup process.</p></content-text>
</page>
<page type="OneColumn" id="en0908020102">
<content-media type="InteractiveGraphicHotspots" id="cm3776197122"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020100/en0908020102/cm3776197122.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020100/en0908020102/cm3776197122text.xml"/></content-media>
<content-text><p><b>The Route Lookup Process</b></p> <p>Follow these steps in the figure to see the route lookup process. Don't worry about fully understanding the steps right now. You will better understand this process when we examine a few examples in the following sections.</p> <p><b>Click Step 1. </b></p> <p>The router examines level 1 routes, including network routes and supernet routes, for the best match with the destination address of the IP packet.</p> <p><b>Click Step 1a. </b></p> <p>If the best match is a level 1 ultimate route - a classful network, supernet, or default route - this route is used to<i> forward the packet.</i></p> <p><b>Click Step 1b.</b></p> <p>If the best match is a level 1 parent route, proceed to Step 2.</p> <p><b>Click Step 2.</b></p>  <p>The router examines child routes (the subnet routes) of the parent route for a best match.</p> <p><b>Click Step 2a.</b></p> <p>If there is a match with a level 2 child route, that subnet will be used to <i>forward the packet</i>.</p> <p><b>Click Step 2b.</b></p> <p>If there is not a match with any of the level 2 child routes, proceed to Step 3.Click Step 3.Is the router implementing classful or classless routing behavior?</p> <p><b>Click Step 3a.</b></p> <p><b>Classful routing behavior:</b> If <i>classful</i> routing behavior is in effect, terminate the lookup process and <i>drop the packet</i>.</p> <p><b>Click Step 3b.</b></p> <p><b>Classless routing behavior:</b> If <i>classless</i> routing behavior is in effect, continue searching level 1 supernet routes in the routing table for a match, including the default route, if there is one.</p> <p><b>Click Step 4.</b></p> <p>If there is now a lesser match with a level 1 supernet or default routes, the router uses that route to <i>forward the packet.</i></p> <p><b>Click Step 5. </b></p> <p>If there is not a match with any route in the routing table, the router <i>drops the packet.</i></p> <p>Classful and classless routing behavior will be discussed in more detail in a later section.</p> <p><b>Note:</b> A route referencing only a next-hop IP address and not an exit interface must be resolved to a route with an exit interface. A recursive lookup is performed on the next-hop IP address until the route is resolved to an exit interface.</p></content-text>
</page>
</topic>
<topic type="" id="en0908020200">
<title><content-text>Longest Match: Level 1 Network Routes</content-text></title>
<page type="OneColumn" id="en0908020201">
<content-media type="StaticGraphic" id="cm8056663434"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020200/en0908020201/cm8056663434.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020200/en0908020201/cm8056663434text.xml"/></content-media>
<content-text><p><b>Longest Match</b></p> <p>The term best match was used in the previous route lookup discussion. What is meant by the best match? Best match is also referred to as longest match. </p> <p>First of all, what is a match? For there to be a match between the destination IP address of a packet and a route in the routing table, a minimum number of left-most bits must match between the IP address of the packet and the route in the routing table. The subnet mask of the route in the routing table is used to determine the minimum number of left-most bits that must match. (Remember, an IP packet only contains the IP address and not the subnet mask.) </p> <p>The best match or longest match is the route in the routing table that has the most number of left-most matching bits with the destination IP address of the packet. <b>The route with the most number of equivalent left-most bits, or the longest match, is always the preferred route.</b></p> <p>For example, in the figure we have a packet destined for 172.16.0.10. Many possible routes <i>could </i>match this packet. Three possible routes are shown that <i>do </i>match this packet: 172.16.0.0/12, 172.16.0.0/18, and 172.16.0.0/26. Of the three routes, 172.16.0.0/26 has the longest match. Remember, for any of these routes to be considered a match there must be at least the number of matching bits indicated by the subnet mask of the route.</p></content-text>
</page>
<page type="OneColumn" id="en0908020202">
<content-media type="InteractiveGraphicHotspots" id="cm3981462601"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020200/en0908020202/cm3981462601.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020200/en0908020202/cm3981462601text.xml"/></content-media>
<content-text><p><b>Example: Level 1 Ultimate Route</b></p> <p>The subnet mask that is used to determine the longest match is not always obvious. Let's examine this concept in more detail, using several examples.</p> <p><b>Click Play to view the animation.</b></p> <p>In this example, PC1 sends a ping to 192.168.1.2, the interface on R3. R1 receives the packet.</p> <p><b>Click Route Info and then R1 Routing Table in the figure.</b></p> <p>Remember the first part of Step 1 in the route lookup process? The figure demonstrates this step.</p> <p><b>Click Step 1 in the figure.</b></p> <p>The router first examines level 1 routes for the best match. In our example, there is a match between the destination IP address 192.168.1.2 and the level 1 ultimate route of 192.168.1.0/24.</p> <p><b>Click Step 1a in the figure.</b></p> <span class="cmd"><p>R 192.168.1.0/24 [120/1] via 172.16.2.2, 00:00:25, <span class="blue">Serial0/0/0</span></p></span> <p>R1 uses this route and forwards the packet out interface Serial 0/0/0.</p></content-text>
</page>
<page type="OneColumn" id="en0908020203">
<content-media type="StaticGraphic" id="cm6250831567"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020200/en0908020203/cm6250831567.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020200/en0908020203/cm6250831567text.xml"/></content-media>
<content-text><p>Why is there a match with the 192.168.1.0/24 level 1 route and not with one of the 172.16.0.0 subnets? This may seem obvious. We say, "Of course the router will use 192.168.1.0/24." But the lookup process is comparing 32 bit addresses with 32 bit route entries, looking for the longest match. </p> <p>The algorithm used by the IOS to search the routing table is beyond the scope of this chapter. What is important is to understand why a route entry matches or doesn't match the packet's destination IP address.</p> <p>Why is there not a match with any of the 172.16.0.0/24 subnets in the routing table?</p> <p>The 172.16.0.0/24 is a parent route of three subnets or child routes. Before a child route is examined for a match, there must be at least a match between the destination IP address of the packet and the <b>classful address</b> of the parent route, or 172.16.0.0/16.</p> <p>Do at least 16 of the left-most bits of the parent route match the first 16 bits of the packet's destination IP address of 192.168.1.2? The answer, <b>no</b>, is obvious to us. But in the figure, you will see that the router actually checks the first bit and finds a match. The router then moves to the second bit. Because there is not a match, the lookup process will search other route entries.</p></content-text>
</page>
<page type="OneColumn" id="en0908020204">
<content-media type="StaticGraphic" id="cm4871524980"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020200/en0908020204/cm4871524980.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020200/en0908020204/cm4871524980text.xml"/></content-media>
<content-text><p>Now let's see how the router finds a match between the packet's destination IP address of 192.168.1.2 and the next route in the routing table, 192.168.1.0/24, an ultimate route.</p> <span class="cmd"><p>R 192.168.1.0/24 [120/1] via 172.16.2.2, 00:00:25, Serial0/0/0</p></span> <p>The route, 192.168.1.0, is a level 1 ultimate route and, therefore, it also contains the subnet mask, /24. In the figure, notice that at least the first 24 left-most bits match.</p> <p>Not only does the minimum of 24 bits match, but a total of 30 bits match, as shown in the figure. Is this important? As we will see later, there can be situations in which there are multiple matching routes in the routing table for the same destination IP address. Which one is the preferred route? The one with the most number of matching bits, the longest match.</p> <p>In this example, there is a match between the destination IP address 192.168.1.0 and the level 1 ultimate route 192.168.1.0/24. Because there is not a longer, more specific match, the packet is forwarded out the exit interface Serial 0/0/0.</p> <p><b>Note:</b> Remember that the route lookup process will need to do a recursive lookup on any route that references only a next-hop IP address and not an exit interface. For a review of recursive lookups, refer to Chapter 2, "Static Routing."</p></content-text>
</page>
</topic>
<topic type="" id="en0908020300">
<title><content-text>Longest Match: Level 1 Parent and Level 2 Child Routes</content-text></title>
<page type="OneColumn" id="en0908020301">
<content-media type="StaticGraphic" id="cm1299179193"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020300/en0908020301/cm1299179193.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020300/en0908020301/cm1299179193text.xml"/></content-media>
<content-text><p>Let's examine what happens when there is a match with a level 1 parent route. </p> <p><b>Click Route Info in the figure.</b></p> <p>As shown in the figure, a parent route does not include a next-hop address or an exit interface but is only a "header" for its level 2 child routes, the subnets. </p> <p>The subnet mask for the child routes - /24 in the figure - is displayed in the parent route, 172.16.0.0, for subnets that use the same subnet mask. </p> <p>Before any level 2 child routes are examined for a match, there must first be a match between the classful address of the level 1 parent route and the destination IP address of the packet. </p></content-text>
</page>
<page type="OneColumn" id="en0908020302">
<content-media type="InteractiveGraphicHotspots" id="cm1444017874"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020300/en0908020302/cm1444017874.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020300/en0908020302/cm1444017874text.xml"/></content-media>
<content-text><p><b>Example: Level 1 Parent Route and Level 2 Child Routes </b></p> <p>In the example in the figure, PC1 sends a ping to PC2 at 172.16.3.10. R1 receives the packet and begins to search the routing table for a route. </p> <p><b>Click Step 1b in the figure.</b></p> <p>The first match that occurs is with the level 1 parent route, 172.16.0.0. Remember, with non-VLSM subnets the classful mask of the parent is not displayed. Before any child routes (subnets) are examined for a match, there must first be a match with the classful address of the parent route. </p> <p>Because the first route entry is a level 1 parent route that matches the destination address (Step 1b of the route lookup process), the route lookup process moves to Step 2.</p> <p><b>Click Step 2 in the figure.</b></p> <p>Because there is a match with the parent route, the level 2 child routes will be examined for a match. However, this time the actual subnet mask of /24 is used for the minimum number of left-most bits that must match. </p> <p><b>Click Step 2a in the figure.</b></p> <p>The route lookup process searches the child routes for a match. In this case, there must be a minimum of 24 bits that match. </p></content-text>
</page>
<page type="OneColumn" id="en0908020303">
<content-media type="InteractiveGraphicHotspots" id="cm5255844411"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020300/en0908020303/cm5255844411.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020300/en0908020303/cm5255844411text.xml"/></content-media>
<content-text><p>Let's see how the router finds a match with one of the level 2 child routes.</p> <p>First, the router examines the parent route for a match. In this example, the first 16 bits of the IP address must match that of the parent route. The left-most 16 bits must match because that is the classful mask of the parent route, /16. </p> <p>If there is a match with the parent route, then the router checks the 172.16.1.0 route. Child routes are only examined when there is a match with the classful mask of the parent.</p> <p><b>Click 2 in the figure.</b></p> <p>Checking the first subnet, 172.16.1.0, the 23rd bit does not match; therefore, this route is rejected because the first 24 bits do not match. </p> <p><b>Click 3 in the figure.</b></p> <p>Next, the router checks the 172.16.2.0/24 route. Because the 24th bit does not match, this route is also rejected. All 24 bits must match.</p> <p><b>Click 4 in the figure.</b></p> <p>The router checks the last child route for 172.16.3.0/24 and finds a match. The first 24 bits do match. The routing table process will use this route, 172.16.3.0/24, to forward the packet with the destination IP address of 172.16.3.10 out the exit interface of Serial 0/0/0.</p> <span class="cmd"><p>R 172.16.3.0 [120/1] via 172.16.2.2, 00:00:25, Serial0/0/0</p></span> <p>What happens if the router does not have a route? Then it discards the packet.</p></content-text>
</page>
<page type="OneColumn" id="en0908020304">
<content-media type="StaticGraphic" id="cm9962366577"><title><content-text></content-text></title><media ref="en0908000000/en0908020000/en0908020300/en0908020304/cm9962366577.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908020000/en0908020300/en0908020304/cm9962366577text.xml"/></content-media>
<content-text><p><b>Example: Route Lookup Process with VLSM</b></p> <p>What about our RouterX topology, which is using a VLSM addressing scheme? How does this change the lookup process?</p> <p><b>Click 1 in the figure.</b></p> <p>Using VSLM does not change the lookup process. With VLSM, the /16 classful mask is displayed with the level 1 parent route (172.16.0.0/16 in the figure). </p> <p><b>Click 2, 3, and 4 in the figure.</b></p> <p>As with non-VLSM networks, if there is a match between the packet's destination IP address and the classful mask of the level 1 parent route, the level 2 child routes will be searched.</p> <p>The only difference with VLSM is that child routes display their own specific subnet masks. These subnet masks are used to determine the number of left-most bits that must match the packet's destination IP address. For example, for there to be a match with the 172.16.1.4 child route, a minimum of 30 left-most bits must match because the subnet mask is /30. </p></content-text>
</page>
</topic>
</section>
<section type="" id="en0908030000">
<title><content-text>Routing Behavior</content-text></title>
<topic type="" id="en0908030100">
<title><content-text>Classful and Classless Routing Behavior</content-text></title>
<page type="OneColumn" id="en0908030101">
<content-media type="AnimationPartialScreen" id="cm4853554907"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030100/en0908030101/cm4853554907.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030100/en0908030101/cm4853554907text.xml"/></content-media>
<content-text><p>The next step in the route lookup process (Step 3) looks at <i>routing behavior</i>. Routing behavior influences the process of searching for the preferred route using the <span class="cmd"><b>no ip classless</b></span> or <span class="cmd"><b>ip classless</b></span> commands. </p> <p><b>Classless and classful routing <i>behaviors</i> are not the same as classless and classful routing <i>protocols</i>.</b> Classful and classless routing <i>protocols </i>affect how the routing table is populated. Classful and classless routing <i>behaviors</i> determine how the routing table is searched after it is populated. In the figure, the routing sources (including classful and classless routing protocols) are the inputs used to populate the routing table. The routing behavior, specified by the <span class="cmd"><b>ip classless</b></span> or <span class="cmd"><b>no ip classless</b></span> commands, determines how the route lookup process will proceed at Step 3.</p> <p>As you can see, routing protocols and routing behaviors are completely independent of each other. The routing table could be populated with routes from a <i>classless routing protocol</i> like RIPv2 yet implement <i>classful routing behavior </i>because the <span class="cmd"><b>no ip classless</b></span> command is configured.</p></content-text>
</page>
<page type="OneColumn" id="en0908030102">
<content-media type="InteractiveGraphicHotspots" id="cm8074649530"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030100/en0908030102/cm8074649530.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030100/en0908030102/cm8074649530text.xml"/></content-media>
<content-text><p><b>Topology Changes</b></p> <p>In Chapter 7, "RIPv2," we learned that classful routing protocols like RIPv1 do not support discontiguous networks. Even though our current topology has discontiguous networks, we can configure static routes to reach those networks. </p> <p><b>Click R2 Configuration in the figure.</b></p> <p>First, we add a static "quad-zero" route on R2 for sending default traffic to R3. We then add the <span class="cmd"><b>default-information originate</b></span> command to the RIP routing process so that R2 will send R1 the default route. This will allow R1 and R2 the capability of reaching all other networks, including 172.16.4.0/24 on R3. Finally, we enter the command <span class="cmd"><b>no network 192.168.1.0</b></span> because we no longer want to exchange RIP updates with R3. </p> <p><b>Click R3 Configuration in the figure.</b></p> <p>To finish our configuration, we remove RIP routing on R3 and add a static route on R3 for sending traffic for the major network 172.16.0.0/16, which does not have a longer match in the routing table, to R2. </p> <p>We are not going to test the connectivity at this time. Connectivity will be tested in the following sections.</p></content-text>
</page>
</topic>
<topic type="" id="en0908030200">
<title><content-text>Classful Routing Behavior: no ip classless</content-text></title>
<page type="OneColumn" id="en0908030201">
<content-media type="InteractiveGraphicHotspots" id="cm1545129011"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030200/en0908030201/cm1545129011.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030200/en0908030201/cm1545129011text.xml"/></content-media>
<content-text><p>We now focus on Step 3 in the route lookup process. Namely, what happens after Step 2b when there is not a match with any of the level 2 child routes of the parent. Later, you will see a specific example.</p> <p>As you recall from the previous section, in Steps 1 and 2, the router examines level 1 and child routes looking for the best match with the IP packet's destination address. Let's assume there is no match and resume our review of the route lookup process with Step 3.</p> <p><b>Click through Steps 3 and 3a in the figure to review how classful routing behavior impacts the route lookup process. </b></p> <p><b>Click Step 3 in the figure. </b></p> <p>Is the router implementing classful or classless routing behavior?</p> <p><b>Click Step 3a in the figure.</b></p> <p>If <i>classful</i> routing behavior is in effect, terminate the lookup process and <i>drop the packet</i>. </p> <p><b>Note: </b>Under classful routing behavior, the process never goes to Step 4.</p></content-text>
</page>
<page type="OneColumn" id="en0908030202">
<content-media type="StaticGraphic" id="cm9320057142"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030200/en0908030202/cm9320057142.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030200/en0908030202/cm9320057142text.xml"/></content-media>
<content-text><p>Prior to IOS 11.3, <span class="cmd"><b>no ip classless</b></span> was the default behavior for Cisco routers. The command <span class="cmd"><b>no ip classless</b></span> means that the route lookup process uses classful routing table lookups by default. This will be explained in the following sections. </p> <p>The commands <span class="cmd"><b>no ip classless</b></span> and <span class="cmd"><b>ip classless</b></span> are global configuration commands and can be viewed by typing <span class="cmd"><b>show running-config</b></span>. In IOS versions 11.3 and later, the command <span class="cmd"><b>ip classless</b></span> is the default, implementing a classless route lookup process. </p> <p>What is the effect of classful routing behavior when all the routers are configured with the <span class="cmd"><b>no ip classless</b></span> command? </p> <span class="cmd"><p>R1(config)#<b>no ip classless</b></p></span> <span class="cmd"><p>R2(config)#<b>no ip classless</b></p></span> <span class="cmd"><p>R3(config)#<b>no ip classless</b></p></span> <p>Let's examine what happens when the router is performing classful routing behavior - that is, when the <span class="cmd"><b>no ip classless</b></span> command is configured.</p></content-text>
</page>
</topic>
<topic type="" id="en0908030300">
<title><content-text>Classful Routing Behavior - Search Process</content-text></title>
<page type="OneColumn" id="en0908030301">
<content-media type="InteractiveGraphicHotspots" id="cm4992195644"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030300/en0908030301/cm4992195644.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030300/en0908030301/cm4992195644text.xml"/></content-media>
<content-text><p>In our routing table lookup process, Step 3a states that when classful routing behavior is in effect (<span class="cmd"><b>no ip classless</b></span>) the process will not continue searching level 1 routes in the routing table. If a packet doesn't match a child route for the parent network route, then the router drops the packet. Let's see an example.</p> <p><b>Example: R2 operating with Classful Routing Behavior</b></p> <p>In this example, R2 receives a packet destined for PC3 at 172.16.4.10. </p> <p><b>Click R2 Routing Table and Parent in the figure.</b></p> <p>The routing process searches the routing table and finds a 16-bit match with the parent route 172.16.0.0, as shown in the figure. According to Step 1b of the routing process, if a match is made in the parent route, the child routes are checked.</p> <p>Now let's look at the actual bit-matching process that is taking place as the child routes are checked. </p> <p><b>Click 1, 2, and 3 in the figure.</b></p> <p>Notice that none of the 24 left-most bits of the child routes matches the destination IP address of 172.16.4.10. At most, only 21 bits match. There is no match with the level 2 child routes.</p> <p> </p></content-text>
</page>
<page type="OneColumn" id="en0908030302">
<content-media type="InteractiveGraphicHotspots" id="cm2981029881"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030300/en0908030302/cm2981029881.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030300/en0908030302/cm2981029881text.xml"/></content-media>
<content-text><p>So what happens next? Router R2 drops the packet.</p> <p><b>Click No Matches in the figure.</b></p> <p><i>Because router R2 is using classful routing behavior, </i><span class="cmd"><b>no ip classless</b></span>, <i>the router will not search beyond the child routes for a lesser match</i>. </p> <p><b>Click Drop Packet in the figure.</b></p> <p>The routing table process will not use the default route, 0.0.0.0/0, or any other route. </p> <p>A common error is to assume that a default route will <i>always</i> be used if the router does not have a better route. In our example, R2's default route is not examined nor used, although it is a match. This is often a very surprising result when a network administrator does not understand the difference between classful and classless routing behavior. </p> <p><b>Note</b>: We will also see another example in Chapter 9 EIGRP where understanding the routing table lookup process will assist you in troubleshooting why a default route does not get used - even with classless routing behavior.</p> <p>Why does classful routing behavior perform like this? The <i>general</i> idea of classful routing behavior comes from the time when all networks were of a classful nature. At the beginning of the Internet's growth, an organization received a class A, class B, or class C major network address. Once an organization had a classful IP major network address, that organization would also administer all of the subnets for that classful address. All routers belonging to the organization would know about all of the subnets for the major network. If a subnet was not in the routing table, then the subnet did not exist. As you learned in Chapter 6, "VLSM and CIDR," IP addresses are no longer allocated based on class.</p></content-text>
</page>
</topic>
<topic type="" id="en0908030400">
<title><content-text>Classless Routing Behavior: ip classless</content-text></title>
<page type="OneColumn" id="en0908030401">
<content-media type="StaticGraphic" id="cm1704898308"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030400/en0908030401/cm1704898308.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030400/en0908030401/cm1704898308text.xml"/></content-media>
<content-text><p>Starting with IOS 11.3, Cisco changed the default routing behavior from classful to classless. The <span class="cmd"><b>ip classless</b></span> command is configured by default. The <span class="cmd"><b>show running-config</b></span> command displays the routing behavior. Classless routing behavior means that the routing process no longer assumes that all subnets for a major classful network can only be reached within the child routes of the parent. Classless routing behavior works well for discontiguous networks and CIDR supernets.</p> <p>In this section, we will examine the effect of classless routing behavior. All routers are configured with the <span class="cmd"><b>ip classless</b></span> command. </p> <span class="cmd"><p>R1(config)#<b>ip classless</b></p></span> <span class="cmd"><p>R2(config)#<b>ip classless</b></p></span> <span class="cmd"><p>R3(config)#<b>ip classless</b></p></span> <p>We will discuss what happens to a packet when there is a match with a level 1 parent route but there is not a match with any of the level 2 child routes or subnets. This takes us to Step 3b, Classless routing behavior.</p></content-text>
</page>
<page type="OneColumn" id="en0908030402">
<content-media type="InteractiveGraphicHotspots" id="cm1001089653"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030400/en0908030402/cm1001089653.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030400/en0908030402/cm1001089653text.xml"/></content-media>
<content-text><p>As you recall from the routing table process, in Steps 1 and 2, the routing table process examines level 1 and level 2 child routes looking for the best match with the IP packet's destination address. Let's assume there is no match and resume our review of the route lookup process with Step 3.</p> <p><b>The Route Lookup Process:</b></p> <p>Follow these steps in the figure to see the route lookup process:</p> <p><b>Click Step 3.</b></p> <p>Is the router implementing classful or classless routing behavior?</p> <p><b>Click Step 3a.</b></p> <p><b>Classful routing behavior:</b> If <i>classful</i> routing behavior is in effect, terminate the lookup process and <i>drop the packet</i>.</p> <p><b>Click Step 3b.</b></p> <p><b>Classless routing behavior:</b> If <i>classless</i> routing behavior is in effect, continue searching level 1 supernet routes in the routing table for a match, including the default route, if there is one.</p> <p><b>Click Step 4.</b></p> <p>If there is now a lesser match with a level 1 supernet or default routes, the router uses that route to <i>forward the packet</i>.</p> <p><b>Click Step 5.</b></p> <p>If there is not a match with any route in the routing table, the router <i>drops the packet</i>.</p></content-text>
</page>
</topic>
<topic type="" id="en0908030500">
<title><content-text>Classless Routing Behavior - Search Process</content-text></title>
<page type="OneColumn" id="en0908030501">
<content-media type="InteractiveGraphicHotspots" id="cm3241825150"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030500/en0908030501/cm3241825150.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030500/en0908030501/cm3241825150text.xml"/></content-media>
<content-text><p>Let's revisit our sample topology and look at the bit matching that happens when classless routing behavior (<span class="cmd"><b>ip classless</b></span>) is in effect. </p> <p><b>Example: R2 Operating with Classless Routing Behavior</b></p> <p><b>Click R2 Routing Table and Parent in the figure.</b></p> <p>Again, R2 receives a packet destined for PC3 at 172.16.4.10. Just as it did with the classful routing behavior, the router searches the routing table and finds a 16-bit match with the parent route 172.16.0.0, as shown in the figure. According to Step1b of the routing process, if there is a match with a parent route, then the child routes are checked. </p> <p><b>Click 1, 2, 3 in the figure.</b></p> <p>As before, none of the 24 left-most bits of the child routes matches the destination IP address of 172.16.4.10. At most, only 21 bits match. There is no match with the level 2 child routes.</p></content-text>
</page>
<page type="OneColumn" id="en0908030502">
<content-media type="StaticGraphic" id="cm6864267801"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030500/en0908030502/cm6864267801.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030500/en0908030502/cm6864267801text.xml"/></content-media>
<content-text><p>Because we are using classless routing behavior (<span class="cmd">ip classless</span>), the router continues searching the routing table, beyond this parent route and its child routes. The routing process will continue to search the routing table for a route with a subnet mask fewer than the 16 bits of the previous parent route. In other words, the router will now continue to search the other routes in the routing table where there may be fewer bits that match, but still a match.</p> <p><b>Click Network Route in the figure.</b></p> <p>The 192.168.1.0<span class="blue">/24 </span>route does not have 24 left-most bits that match the destination IP address. </p> <span class="cmd"><p>C 192.168.1.0/24 is directly connected, Serial0/0/1</p></span> <p><b>Click Default Route in the figure.</b></p> <p>How about the default route? How many bits need to match? </p> <span class="cmd"><p>S* 0.0.0.0/<span class="blue">0</span> is directly connected, Serial0/0/1</p></span> <p>The mask is /0, which means that zero or no bits need to match. A default route will be the lowest-bit match. In classless routing behavior, if no other route matches, the default route will match. </p> <p><b>Click Forward Packet in the figure.</b></p> <p>In this case the router will use the default route, because it is the best match. The packet will be forwarded out the Serial 0/0/1 interface.</p> <p><b>Classful Route on R3</b></p> <p><b>Click R3 Routing Table in the figure.</b></p> <p>What does R3 do with return traffic back to PC2 at 172.16.2.10? In the figure, you'll see that in the routing table for R3, both the 172.16.4.0/24 subnet route and the 172.16.0.0/16 classful network route are level 2 child routes of the 172.16.0.0/16 parent route. Whenever there are routes for both the subnets of a classful network and a route for the classful network route itself, the classful route is considered a level 2 child route, just like the subnets.</p> <p>In this case, R3 uses the 172.16.0.0/16 child route and forwards the traffic out Serial 0/0/1 back to R2.</p></content-text>
</page>
<page type="OneColumn" id="en0908030503">
<content-media type="StaticGraphic" id="cm7174144403"><title><content-text></content-text></title><media ref="en0908000000/en0908030000/en0908030500/en0908030503/cm7174144403.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908030000/en0908030500/en0908030503/cm7174144403text.xml"/></content-media>
<content-text><p><b>Classful vs. Classless Routing Behavior in the Real World</b></p> <p>Remember that classful and classless routing <i>behaviors</i> are independent from classful and classless routing <i>protocols</i>. A router could be configured with classful routing behavior (<span class="cmd"><b>no ip classless</b></span>) and a classless routing protocol, such as RIPv2. A router could also be configured with classless routing behavior (<span class="cmd"><b>ip classless</b></span>) and a classful routing protocol, such as RIPv1. </p> <p>In today's networks, it is recommended to use classless routing behavior so that supernet and default routes can be used whenever needed.</p></content-text>
</page>
</topic>
</section>
<section type="" id="en0908040000">
<title><content-text>Routing Table Labs</content-text></title>
<topic type="" id="en0908040100">
<title><content-text>Investigating the Routing Table Lookup Process</content-text></title>
<page type="OneColumn" id="en0908040101">
<content-media type="ActivityLab" id="cm9730041587"><title><content-text></content-text></title><media ref="en0908000000/en0908040000/en0908040100/en0908040101/cm9730041587/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="en0908000000/en0908040000/en0908040100/en0908040101/cm9730041587/icontext.xml"/></content-media>
<content-text><p>In this lab, you will be able to investigate classless and classful routing behavior.</p><p><b>Click the lab icon for more details.</b></p></content-text>
</page>
<page type="OneColumn" id="en0908040102">
<content-media type="ActivityPKA" id="cm9403955628"><title><content-text></content-text></title><media ref="en0908000000/en0908040000/en0908040100/en0908040102/cm9403955628/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0908000000/en0908040000/en0908040100/en0908040102/cm9403955628/icontext.xml"/></content-media>
<content-text><p>In this packet tracer activity, you will be able to investigate classless and classful routing behavior.</p><p><b>Click the packet tracer icon for more details.</b></p></content-text>
</page>
</topic>
<topic type="" id="en0908040200">
<title><content-text>The show ip route Challenge Lab</content-text></title>
<page type="OneColumn" id="en0908040201">
<content-media type="ActivityLab" id="cm5231194811"><title><content-text></content-text></title><media ref="en0908000000/en0908040000/en0908040200/en0908040201/cm5231194811/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="en0908000000/en0908040000/en0908040200/en0908040201/cm5231194811/icontext.xml"/></content-media>
<content-text><p><b>Click the lab icon for more details.</b></p></content-text>
</page>
<page type="OneColumn" id="en0908040202">
<content-media type="ActivityPKA" id="cm5835199697"><title><content-text></content-text></title><media ref="en0908000000/en0908040000/en0908040200/en0908040202/cm5835199697/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0908000000/en0908040000/en0908040200/en0908040202/cm5835199697/icontext.xml"/></content-media>
<content-text><p>In this lab activity, you will determine the topology of a network using the outputs from the <span class="cmd"><b>show ip route</b></span> command. </p> <p>You must draw a topology diagram and determine the interface addressing on each router. Next, you must build and configure the network based on the outputs. The DTE and DCE assignment is at your discretion. When complete, the outputs from your network must match those given below. </p><p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterSummary" id="en0908050000">
<title><content-text>Chapter Summary</content-text></title>
<topic type="" id="en0908050100">
<title><content-text>Summary and Review</content-text></title>
<page type="OneColumn" id="en0908050101">
<content-media type="StaticGraphic" id="cm7098108824"><title><content-text></content-text></title><media ref="en0908000000/en0908050000/en0908050100/en0908050101/cm7098108824.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908050000/en0908050100/en0908050101/cm7098108824text.xml"/></content-media>
<content-text><p><b>Summary</b></p> <p>Understanding the structure and lookup process of the routing table can be an important tool in verifying and troubleshooting networks. Knowing which routes should be included and which routes should not be included in the routing table is a critical skill when troubleshooting routing issues.</p> <p>The Cisco IP routing table is structured in a classful manner, which means that it uses to the default, classful addresses, to organize the route entries. The source of a routing entry can be a directly connected network, static route, or a route learned dynamically from a routing protocol.</p> <p>In this chapter, you learned that there are level 1 and level 2 routes. A level 1 route can be either an ultimate route or a parent route. A level 1 ultimate route is a route with a subnet mask equal to, or less than the default classful mask of the network; and either a next hop address or an exit interface. For example, a route learned through RIP with the network address of 192.168.1.0 and a /24 network mask is a level 1 ultimate route. These routes are displayed in the routing table as a single route entry, such as:</p> <span class="cmd"><p>R 192.168.1.0/24 [120/1] via 172.16.2.2, 00:00:25, Serial0/0/0</p></span> <p>Another type of level 1 route is a parent route. A level 1 parent route is automatically created when a subnet route is added to the routing table. The subnet route is known as a level 2 child route. The parent route is a header for level 2 child routes. Here is an example of a level 1 parent route and a level 2 child route:</p> <span class="cmd"><p> 172.16.0.0/24 is subnetted, 1 subnets</p></span> <span class="cmd"><p>R 172.16.1.0 [120/1] via 172.16.2.1, 00:00:07, Serial0/0/0</p></span> <p>The subnet mask of the child routes are displayed in the parent route unless VLSM is used. With VLSM, the parent route displays the default classful mask and the subnet mask is included with the individual VLSM route entries.</p> <p>You were also introduced to the routing table lookup process in this chapter. When a packet is received by the router, it looks for the longest match with one of the routes in the routing table. The longest match is the route with the largest number of left-most bits that match between the destination IP address of the packet and the network address of the route in the routing table. The subnet mask associated with the network address in the routing table defines the minimum number of bits that must match for that route to be a match.</p> <p>Before examining any level 2 child routes (subnets) for a match there must first be a match with the level 1 parent route. The classful mask of the parent determines how many bits must match the parent route. If there is a match with the parent route, then the child routes will be searched for a match.</p> <p>What happens when there is a match with the parent route but none of the child routes? If the router is using classful routing behavior, no other routes will be searched and the packet will be discarded. Classful routing behavior was the default routing behavior on Cisco routers prior to IOS 11.3. Classful routing behavior can be implemented using the <span class="cmd"><b>no ip classless</b></span> command.</p> <p>Starting with IOS 11.3 classless routing behavior became the default. If there is a match with a parent route but none of the child routes, the routing table process will continue to search other routes in the routing table including a default route should one exist. Classless routing behavior is implemented by using the <span class="cmd"><b>ip classless</b></span> command.</p> <p>Routes to networks get added to the routing table from various sources including directly connected networks, static routes, classful routing protocols and classless routing protocols. The lookup process, classful or classless routing behavior, is independent of the source of the route. A routing table may have routes learned from a classful routing protocol such as RIPv1, but uses classless routing behavior, <span class="cmd"><b>no ip classless</b></span>, for the lookup process.</p></content-text>
</page>
<page type="FullScreen" id="en0908050102">
<content-media type="ChapterSummary" id="cm5229847571"><title><content-text></content-text></title><media ref="en0908000000/en0908050000/en0908050100/en0908050102/cm5229847571.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908050000/en0908050100/en0908050102/cm5229847571text.xml"/></content-media>
<content-text></content-text>
</page>
<page type="OneColumn" id="en0908050103">
<content-media type="ActivityPKT" id="cm4154847951"><title><content-text></content-text></title><media ref="en0908000000/en0908050000/en0908050100/en0908050103/cm4154847951/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en0908000000/en0908050000/en0908050100/en0908050103/cm4154847951/icontext.xml"/></content-media>
<content-text><p><content-link target="E2_PTAct_8_5_1_Directions.pdf" type="internalfile">Packet Tracer Skills Integration Instructions (PDF)</content-link></p><p><b>Click the PT icon for more details.</b></p></content-text>
</page>
<page type="OneColumn" id="en0908050104">
<content-media type="StaticGraphic" id="cm6303911579"><title><content-text></content-text></title><media ref="en0908000000/en0908050000/en0908050100/en0908050104/cm6303911579.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en0908000000/en0908050000/en0908050100/en0908050104/cm6303911579text.xml"/></content-media>
<content-text><p><b>To Learn More</b></p> <p>An excellent source on the routing table structure and the lookup process is Alex Zinin's book, <i>Cisco IP Routing</i>, which goes into more detail than was discussed in this chapter.</p> <p><i>Cisco IP Routing</i>, Chapter 4: Routing Table Maintenance includes:</p> <ul><li> Comparison of Route Sources</li> <li> Representation of Routing Information and Interfaces</li> <li> Routing Table Structure</li> <li> Route Source Selection</li> <li> Routing Table Initialization</li> <li> Asynchronous Table Maintenance</li> <li> Route Resolvability</li> <li> Dynamic Route Processing</li> <li> Static Route Processing</li> <li> Manual Routing Table Clearance</li> <li> Default Route Selection</li></ul></content-text>
</page>
</topic>
</section>
<section type="ChapterQuiz" id="en0908060000">
<title><content-text>Chapter Quiz</content-text></title>
<topic type="" id="en0908060100">
<title><content-text>Chapter Quiz</content-text></title>
<page type="FullScreen" id="en0908060101">
<content-media type="ChapterQuiz" id="cm6422503043"><title><content-text></content-text></title><media ref="en0908000000/en0908060000/en0908060100/en0908060101/cm6422503043/" mime="" scale="true" type="directory" width="100%" height="100%" external="en0908000000/en0908060000/en0908060100/en0908060101/cm6422503043/icontext.xml"/></content-media>
<content-text></content-text>
</page>
</topic>
</section>
</chapter>
