<chapter type="" id="en1306000000">
<title><content-text>Inter-VLAN Routing</content-text></title>
<section type="ChapterSummary" id="en1306000000">
<title><content-text>Chapter Introduction</content-text></title>
<topic type="" id="en1306000100">
<title><content-text>Introduction</content-text></title>
<page type="OneColumn" id="en1306000101">
<content-media type="ChapterIntroduction" id="cm3175050671">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306000000/en1306000100/en1306000101/cm3175050671.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306000000/en1306000100/en1306000101/cm3175050671text.xml"/></content-media>
<content-text><p>In the previous chapters of this course, we discussed how you can use VLANs and trunks to segment a network. Limiting the scope of each broadcast domain on the LAN through VLAN segmentation provides better performance and security across the network. You also learned how VTP is used to share the VLAN information across multiple switches in a LAN environment to simplify management of VLANs. Now that you have a network with many different VLANs, the next question is, "How do we permit devices on separate VLANs to communicate?"</p> <p>In this chapter, you will learn about inter-VLAN routing and how it is used to permit devices on separate VLANs to communicate. You will learn different methods for accomplishing inter-VLAN routing, and the advantages and disadvantages of each. You will also learn how different router interface configurations facilitate inter-VLAN routing. Finally, you will explore the potential issues faced when implementing inter-VLAN routing, and how to identify and correct them.</p></content-text>
</page>
</topic>
</section>
<section type="" id="en1306010000">
<title><content-text>Inter-VLAN Routing</content-text></title>
<topic type="" id="en1306010100">
<title><content-text>Introducing Inter-VLAN Routing</content-text></title>
<page type="OneColumn" id="en1306010101">
<content-media type="StaticGraphic" id="cm6052420007">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010100/en1306010101/cm6052420007.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010100/en1306010101/cm6052420007text.xml"/></content-media>
<content-text><p>Now that you know how to configure VLANs on a network switch, the next step is to allow devices connected to the various VLANs to communicate with each other. In a previous chapter, you learned that each VLAN is a unique broadcast domain, so computers on separate VLANs are, by default, not able to communicate. There is a way to permit these end stations to communicate; it is called inter-VLAN routing. In this topic, you will learn what inter-VLAN routing is and some of the different ways to accomplish inter-VLAN routing on a network.</p> <p>In this chapter, we focus on one type of inter-VLAN routing using a separate router connected to the switch infrastructure. We define inter-VLAN routing as a process of forwarding network traffic from one VLAN to another VLAN using a router. VLANs are associated with unique IP subnets on the network. This subnet configuration facilitates the routing process in a multi-VLAN environment. When using a router to facilitate inter-VLAN routing, the router interfaces can be connected to separate VLANs. Devices on those VLANs send traffic through the router to reach other VLANs.</p> <p>As you can see in the figure, traffic from PC1 on VLAN10 is routed through router R1 to reach PC3 on VLAN30.</p></content-text>
</page>
<page type="OneColumn" id="en1306010102">
<content-media type="AnimationPartialScreen" id="cm9892743321">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010100/en1306010102/cm9892743321.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010100/en1306010102/cm9892743321text.xml"/></content-media>
<content-text><p>Traditionally, LAN routing has used routers with multiple physical interfaces. Each interface needed to be connected to a separate network and configured for a different subnet. </p> <p>In a traditional network that uses multiple VLANs to segment the network traffic into logical broadcast domains, routing is performed by connecting different physical router interfaces to different physical switch ports. The switch ports connect to the router in access mode; in access mode, different static VLANs are assigned to each port interface. Each switch interface would be assigned to a different static VLAN. Each router interface can then accept traffic from the VLAN associated with the switch interface that it is connected to, and traffic can be routed to the other VLANs connected to the other interfaces.</p> <p><b>Click the Play button in the figure </b>to view traditional inter-VLAN routing.</p> <p>As you can see in the animation:</p> <p>1. PC1 on VLAN10 is communicating with PC3 on VLAN30 through router R1.</p> <p>2. PC1 and PC3 are on different VLANs and have IP addresses on different subnets. </p> <p>3. Router R1 has a separate interface configured for each of the VLANs.</p> <p>4. PC1 sends unicast traffic destined for PC3 to switch S2 on VLAN10, where it is then forwarded out the trunk interface to switch S1. </p> <p>5. Switch S1 then forwards the unicast traffic to router R1 on interface F0/0. </p> <p>6. The router routes the unicast traffic through to its interface F0/1, which is connected to VLAN30. </p> <p>7. The router forwards the unicast traffic to switch S1 on VLAN 30. </p> <p>8. Switch S1 then forwards the unicast traffic to switch S2 through the trunk link, after which switch S2 can then forward the unicast traffic to PC3 on VLAN30.</p> <p>In this example, the router was configured with two separate physical interfaces to interact with the different VLANs and perform the routing.</p></content-text>
</page>
<page type="OneColumn" id="en1306010103">
<content-media type="AnimationPartialScreen" id="cm7226520633">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010100/en1306010103/cm7226520633.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010100/en1306010103/cm7226520633text.xml"/></content-media>
<content-text><p>Traditional inter-VLAN routing requires multiple physical interfaces on both the router and the switch. However, not all inter-VLAN routing configurations require multiple physical interfaces. Some router software permits configuring router interfaces as trunk links. This opens up new possibilities for inter-VLAN routing.</p> <p>"Router-on-a-stick" is a type of router configuration in which a single physical interface routes traffic between multiple VLANs on a network. As you can see in the figure, the router is connected to switch S1 using a single, physical network connection. </p> <p>The router interface is configured to operate as a trunk link and is connected to a switch port configured in trunk mode. The router performs the inter-VLAN routing by accepting VLAN tagged traffic on the trunk interface coming from the adjacent switch and internally routing between the VLANs using <content-link target="{203128F8-5310-41FB-9C34-3DCC2366D677}" type="glossary">subinterfaces</content-link>. The router then forwards the routed traffic-VLAN tagged for the destination VLAN-out the same physical interface. </p> <p>Subinterfaces are multiple virtual interfaces, associated with one physical interface. These subinterfaces are configured in software on a router that is independently configured with an IP address and VLAN assignment to operate on a specific VLAN. Subinterfaces are configured for different subnets corresponding to their VLAN assignment to facilitate logical routing before the data frames are VLAN tagged and sent back out the physical interface. You will learn more about interfaces and subinterfaces in the next topic.</p> <p><b>Click the Play button in the figure</b> to view how a router-on-a-stick performs its routing function.</p> <p>As you can see in the animation:</p> <p>1. PC1 on VLAN10 is communicating with PC3 on VLAN30 through router R1 using a single, physical router interface.</p> <p>2. PC1 sends its unicast traffic to switch S2.</p> <p>3. Switch S2 then tags the unicast traffic as originating on VLAN10 and forwards the unicast traffic out its trunk link to switch S1.</p> <p>4. Switch S1 forwards the tagged traffic out the other trunk interface on port F0/5 to the interface on router R1.</p> <p>5. Router R1 accepts the tagged unicast traffic on VLAN10 and routes it to VLAN30 using its configured subinterfaces.</p> <p>6. The unicast traffic is tagged with VLAN30 as it is sent out the router interface to switch S1.</p> <p>7. Switch S1 forwards the tagged unicast traffic out the other trunk link to switch S2.</p> <p>8. Switch S2 removes the VLAN tag of the unicast frame and forwards the frame out to PC3 on port F0/6.</p></content-text>
</page>
<page type="OneColumn" id="en1306010104">
<content-media type="AnimationPartialScreen" id="cm3685035496">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010100/en1306010104/cm3685035496.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010100/en1306010104/cm3685035496text.xml"/></content-media>
<content-text><p>Some switches can perform Layer 3 functions, replacing the need for dedicated routers to perform basic routing on a network. Multilayer switches are capable of performing inter-VLAN routing.</p> <p><b>Click the Play button in the figure </b>to see how switch-based inter-VLAN routing occurs. </p> <p>As you can see in the animation:</p> <p>1. PC1 on VLAN10 is communicating with PC3 on VLAN30 through switch S1 using VLAN interfaces configured for each VLAN.</p> <p>2. PC1 sends its unicast traffic to switch S2.</p> <p>3. Switch S2 tags the unicast traffic as originating on VLAN10 as it forwards the unicast traffic out its trunk link to switch S1.</p> <p>4. Switch S1 removes the VLAN tag and forwards the unicast traffic to the VLAN10 interface.</p> <p>5. Switch S1 routes the unicast traffic to its VLAN30 interface.</p> <p>6. Switch S1 then retags the unicast traffic with VLAN30 and forwards it out the trunk link back to switch S2.</p> <p>7. Switch S2 removes the VLAN tag of the unicast frame and forwards the frame out to PC3 on port F0/6.</p> <p>To enable a multilayer switch to perform routing functions, VLAN interfaces on the switch need to be configured with the appropriate IP addresses that match the subnet that the VLAN is associated with on the network. The multilayer switch also must have IP routing enabled. Multilayer switching is complex and beyond the scope of this course. For a good overview of multilayer switching, visit: <content-link target="http://cisco.com/en/US/docs/ios/12_0/switch/configuration/guide/xcmls.html" type="external">http://cisco.com/en/US/docs/ios/12_0/switch/configuration/guide/xcmls.html</content-link>.</p> <p>Configuring inter-VLAN routing on a multilayer switch is beyond the scope of this course. However, the CCNP curriculum covers the concept comprehensively. Also, to explore additional information, visit: <content-link target="http://www.cisco.com/en/US/tech/tk389/tk815/technologies_configuration_example09186a008019e74e.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk815/technologies_configuration_example09186a008019e74e.shtml</content-link>.</p></content-text>
</page>
</topic>
<topic type="" id="en1306010200">
<title><content-text>Interfaces and Subinterfaces</content-text></title>
<page type="OneColumn" id="en1306010201">
<content-media type="StaticGraphic" id="cm4266202165">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010200/en1306010201/cm4266202165.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010200/en1306010201/cm4266202165text.xml"/></content-media>
<content-text><p>As we discussed, there are various inter-VLAN routing options to choose from. Each uses a different router configuration to accomplish the task of routing between VLANs. In this topic, we will look at how each type of router interface configuration routes between VLANs, and the advantages and disadvantages. We will begin by reviewing the traditional model.</p> <p><b>Using the Router as a Gateway</b></p> <p>Traditional routing requires routers to have multiple physical interfaces to facilitate inter-VLAN routing. The router accomplishes the routing by having each of its physical interfaces connected to a unique VLAN. Each interface is also configured with an IP address for the subnet associated with the particular VLAN that it is connected to. By configuring the IP addresses on the physical interfaces, network devices connected to each of the VLANs can communicate with the router using the physical interface connected to the same VLAN. In this configuration, network devices can use the router as a <content-link target="{FB725A1C-0CBD-42E3-AD35-B855760B8D04}" type="glossary">gateway</content-link> to access the devices connected to the other VLANs.</p> <p>The routing process requires the source device to determine if the destination device is local or remote to the local subnet. The source device accomplishes this by comparing the source and destination addresses against the subnet mask. Once the destination address has been determined to be on a remote network, the source device has to identify where it needs to forward the packet to reach the destination device. The source device examines the local <content-link target="{A5B54AF5-42F2-4206-A727-B3A046A12DB5}" type="glossary">routing table</content-link> to determine where it needs to send the data. Typically, devices use their default gateway as the destination for all traffic that needs to leave the local subnet. The default gateway is the route that the device uses when it has no other explicitly defined route to the destination network. The router interface on the local subnet acts as the default gateway for the sending device.</p> <p>Once the source device has determined that the packet must travel through the local router interface on the connected VLAN, the source device sends out an ARP request to determine the MAC address of the local router interface. Once the router sends its ARP reply back to the source device, the source device can use the MAC address to finish framing the packet before it sends it out on the network as unicast traffic.</p> <p>Since the Ethernet frame has the destination MAC address of the router interface, the switch knows exactly which switch port to forward the unicast traffic out of to reach the router interface on that VLAN. When the frame arrives at the router, the router removes the source and destination MAC address information to examine the destination IP address of the packet. The router compares the destination address to entries in its routing table to determine where it needs to forward the data to reach its final destination. If the router determines that the destination network is a locally connected network, as would be the case in inter-VLAN routing, the router sends an ARP request out the interface physically connected to the destination VLAN. The destination device responds back to the router with its MAC address, which the router then uses to frame the packet. The router then sends the unicast traffic to the switch, which forwards it out the port where the destination device is connected.</p> <p><b>Click the Play button in the figure</b> to view how traditional routing is accomplished.</p> <p>Even though there are many steps in the process of inter-VLAN routing when two devices on different VLANs communicate through a router, the entire process happens in a fraction of a second.</p></content-text>
</page>
<page type="OneColumn" id="en1306010202">
<content-media type="InteractiveGraphicHotspots" id="cm2197222106">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010200/en1306010202/cm2197222106.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010200/en1306010202/cm2197222106text.xml"/></content-media>
<content-text><p><b>Interface Configuration</b></p> <p><b>Click the Interface Configuration button in the figure </b>to see an example of router interfaces being configured.</p> <p>Router interfaces are configured similarly to configuring VLAN interfaces on switches. In global configuration mode, switch to interface configuration mode for the specific interface you want to configure. </p> <p>As you see in the example, interface F0/0 is configured with IP address 172.17.10.1 and subnet mask 255.255.255.0 using the <span class="cmd"><b>ip address 172.17.10.1 255.255.255.0</b></span> command. </p> <p>To enable a router interface, the <span class="cmd"><b>no shutdown</b></span> command needs to be entered for the interface. Notice also that interface F0/1 has been configured. After both IP addresses are assigned to each of the physical interfaces, the router is capable of performing routing.</p> <p><b>Click the Routing Table button in the figure </b>to see an example of a routing table on a Cisco router.</p> <p><b>Routing Table</b></p> <p>As you can see in the example, the routing table has two entries, one for network 172.17.10.0 and the other for network 172.17.30.0. Notice the letter <b>C</b> to the left of each route entry. This letter indicates that the route is local for a connected interface, which is also identified in the route entry. Using the output in this example, if traffic was destined for the 172.17.30.0 subnet, the router would forward the traffic out interface F0/1.</p> <p>Traditional inter-VLAN routing using physical interfaces does have a limitation. As the number of VLANs increases on a network, the physical approach of having one router interface per VLAN quickly becomes hindered by the physical hardware limitations of a router. Routers have a limited number of physical interfaces that they can use to connect to different VLANs. Large networks with many VLANs must use VLAN trunking to assign multiple VLANs to a single router interface to work within the hardware constraints of dedicated routers.</p></content-text>
</page>
<page type="OneColumn" id="en1306010203">
<content-media type="InteractiveGraphicHotspots" id="cm4604745480">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010200/en1306010203/cm4604745480.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010200/en1306010203/cm4604745480text.xml"/></content-media>
<content-text><p>To overcome the hardware limitations of inter-VLAN routing based on router physical interfaces, virtual subinterfaces and trunk links are used, as in the router-on-a-stick example described earlier. Subinterfaces are software-based virtual interfaces that are assigned to physical interfaces. Each subinterface is configured with its own IP address, subnet mask, and unique VLAN assignment, allowing a single physical interface to simultaneously be part of multiple logical networks. This is useful when performing inter-VLAN routing on networks with multiple VLANs and few router physical interfaces.</p> <p>When configuring inter-VLAN routing using the router-on-a-stick model, the physical interface of the router must be connected to a trunk link on the adjacent switch. Subinterfaces are created for each unique VLAN/subnet on the network. Each subinterface is assigned an IP address specific to the subnet that it will be part of and configured to VLAN tag frames for the VLAN that the interface is to interact with. That way, the router can keep the traffic from each subinterface separated as it traverses the trunk link back to the switch.</p> <p>Functionally, the router-on-a-stick model for inter-VLAN routing is the same as using the traditional routing model, but instead of using the physical interfaces to perform the routing, subinterfaces of a single interface are used.</p> <p>Let's explore an example. In the figure, PC1 wants to communicate with PC3. PC1 is on VLAN10, and PC3 is on VLAN30. For PC1 to communicate with PC3, PC1 needs to have its data routed through router R1 using configured subinterfaces.</p> <p><b>Click the Play button in the figure </b>to see how subinterfaces are used to route between VLANs.</p></content-text>
</page>
<page type="OneColumn" id="en1306010204">
<content-media type="InteractiveGraphicHotspots" id="cm7394115148">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010200/en1306010204/cm7394115148.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010200/en1306010204/cm7394115148text.xml"/></content-media>
<content-text><p><b>Subinterface Configuration</b></p> <p>Configuring router subinterfaces is similar to configuring physical interfaces, except that you need to create the subinterface and assign it to a VLAN.</p> <p>In the example, create the router subinterface by entering the <span class="cmd"><b>interface f0/0.10</b></span> command in global configuration mode. The syntax for the subinterface is always the physical interface, in this case <b>f0/0</b>, followed by a period and a subinterface number. The subinterface number is configurable, but it is typically associated to reflect the VLAN number. In the example, the subinterfaces use <b>10</b> and <b>30</b> as subinterface numbers to make it easier to remember which VLANs they are associated with. The physical interface is specified because there could be multiple interfaces in the router, each of which could be configured to support many subinterfaces.</p> <p>Before assigning an IP address to a subinterface, the subinterface needs to be configured to operate on a specific VLAN using the <span class="cmd"><b>encapsulation dot1q </b><i>vlan id</i></span> command. In the example, subinterface Fa0/0.10 is assigned to VLAN10. After the VLAN has been assigned, the <span class="cmd"><b>ip address 172.17.10.1 255.255.255.0</b></span> command assigns the subinterface to the appropriate IP address for that VLAN.</p> <p>Unlike a typical physical interface, subinterfaces are not enabled with the <span class="cmd"><b>no shutdown</b></span> command at the subinterface configuration mode level of the Cisco IOS software. Instead, when the physical interface is enabled with the <span class="cmd"><b>no shutdown</b></span> command, all the configured subinterfaces are enabled. Likewise, if the physical interface is disabled, all subinterfaces are disabled.</p> <p><b>Click the Routing Table button in the figure</b> to see an example of a routing table when subinterfaces are configured.</p> <p><b>Router Table Output</b></p> <p>As you see in the figure, the routes defined in the routing table indicate that they are associated with specific subinterfaces, rather than separate physical interfaces.</p> <p>One advantage of using a trunk link is that the number of router and switch ports used are reduced. Not only can this save money, it can also reduce configuration complexity. Consequently, the router subinterface approach can scale to a much larger number of VLANs than a configuration with one physical interface per VLAN design.</p></content-text>
</page>
<page type="OneColumn" id="en1306010205">
<content-media type="StaticGraphic" id="cm7779989036">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306010000/en1306010200/en1306010205/cm7779989036.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306010000/en1306010200/en1306010205/cm7779989036text.xml"/></content-media>
<content-text><p>As we just discussed, both physical interfaces and subinterfaces are used to perform inter-VLAN routing. There are advantages and disadvantage to each method. </p> <p><b>Port Limits</b></p> <p>Physical interfaces are configured to have one interface per VLAN on the network. On networks with many VLANs, using a single router to perform inter-VLAN routing is not possible. Routers have physical limitations that prevent them from containing large numbers of physical interfaces. Instead, you could use multiple routers to perform inter-VLAN routing for all VLANs if avoiding the use of subinterfaces is a priority.</p> <p>Subinterfaces allow a router to scale to accommodate more VLANs than the physical interfaces permit. Inter-VLAN routing in large environments with many VLANs can usually be better accommodated by using a single physical interface with many subinterfaces.</p> <p><b>Performance</b></p> <p>Because there is no contention for bandwidth on separate physical interfaces, physical interfaces have better performance when compared to using subinterfaces. Traffic from each connected VLAN has access to the full bandwidth of the physical router interface connected to that VLAN for inter-VLAN routing. </p> <p>When subinterfaces are used for inter-VLAN routing, the traffic being routed competes for bandwidth on the single physical interface. On a busy network, this could cause a bottleneck for communication. To balance the traffic load on a physical interface, subinterfaces are configured on multiple physical interfaces resulting in less contention between VLAN traffic.</p> <p><b>Access Ports and Trunk Ports</b></p> <p>Connecting physical interfaces for inter-VLAN routing requires that the switch ports be configured as access ports. Subinterfaces require the switch port to be configured as a trunk port so that it can accept VLAN tagged traffic on the trunk link. Using subinterfaces, many VLANs can be routed over a single trunk link rather than a single physical interface for each VLAN.</p> <p><b>Cost</b></p> <p>Financially, it is more cost-effective to use subinterfaces over separate physical interfaces. Routers that have many physical interfaces cost more than routers with a single interface. Additionally, if you have a router with many physical interfaces, each interface is connected to a separate switch port, consuming extra switch ports on the network. Switch ports are an expensive resource on high performance switches. By consuming additional ports for inter-VLAN routing functions, both the switch and the router drive up the overall cost of the inter-VLAN routing solution. </p> <p><b>Complexity</b></p> <p>Using subinterfaces for inter-VLAN routing results in a less complex physical configuration than using separate physical interfaces, because there are fewer physical network cables interconnecting the router to the switch. With fewer cables, there is less confusion about where the cable is connected on the switch. Because the VLANs are being trunked over a single link, it is easier to troubleshoot the physical connections.</p> <p>On the other hand, using subinterfaces with a trunk port results in a more complex software configuration, which can be difficult to troubleshoot. In the router-on-a-stick model, only a single interface is used to accommodate all the different VLANs. If one VLAN is having trouble routing to other VLANs, you cannot simply trace the cable to see if the cable is plugged into the correct port. You need to check to see if the switch port is configured to be a trunk and verify that the VLAN is not being filtered on any of the trunk links before it reaches the router interface. You also need to check that the router subinterface is configured to use the correct VLAN ID and IP address for the subnet associated with that VLAN.</p></content-text>
</page>
</topic>
</section>
<section type="" id="en1306020000">
<title><content-text>Configuring Inter-VLAN Routing</content-text></title>
<topic type="" id="en1306020100">
<title><content-text>Configure Inter-VLAN Routing</content-text></title>
<page type="OneColumn" id="en1306020101">
<content-media type="InteractiveGraphicHotspots" id="cm3065803732">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306020000/en1306020100/en1306020101/cm3065803732.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306020000/en1306020100/en1306020101/cm3065803732text.xml"/></content-media>
<content-text><p>In this topic, you will learn how to configure a Cisco IOS router for inter-VLAN routing, as well as review the commands needed to configure a switch to support inter-VLAN routing.</p> <p>Before configuring the router, configure the switch that it will be connected to. As you see in the figure, Router R1 is connected to switch ports F0/4 and F0/5, which have been configured for VLANs 10 and 30, respectively.</p> <p><b>Click the Switch Configuration button in the figure </b>to see the example switch configuration.</p> <p>To review, VLANs are created in global configuration mode using the <span class="cmd"><b>vlan </b><i>vlan id</i></span> command. In this example, VLANs 10 and 30 were created on switch S1. </p> <p>After the VLANs have been created, they are assigned to the switch ports that the router will be connecting to. To accomplish this task, the <span class="cmd"><b>switchport access vlan </b><i>vlan id</i></span> command is executed from interface configuration mode on the switch for each interface that the router will connect to. </p> <p>In this example, interfaces F0/4 and F0/11 has been configured on VLAN 10 using the <span class="cmd"><b>switchport access vlan 10</b></span> command. The same process is used to assign VLAN 30 to interface F0/5 and F0/6 on switch S1. </p> <p>Finally, to protect the configuration so that it is not lost after a reload of the switch, the <span class="cmd"><b>copy running-config startup-config</b></span> command is executed in privileged EXEC mode to back up the running configuration to the startup configuration.</p> <p><b>Click the Router Interface Configuration button</b> in the figure to see the example router configuration.</p> <p>Next, the router can be configured to perform the inter-VLAN routing.</p> <p>As you see in the figure, each interface is configured with an IP address using the <span class="cmd"><b>ip address </b><i>ip_address subnet_mask</i></span> command in interface configuration mode. </p> <p>Router interfaces are disabled by default and need to be enabled using the <span class="cmd"><b>no shutdown</b></span> command before they are used. </p> <p>In this example, interface F0/0 has been assigned the IP address of 172.17.10.1 using the <span class="cmd"><b>ip address 172.17.10.1 255.255.255.0</b></span> command. You will also notice that after the <span class="cmd"><b>no shutdown</b></span> interface configuration mode command has been executed a notification is displayed indicating that the interface state has changed to up. This indicates that the interface is now enabled.</p> <p>The process is repeated for all router interfaces. Each router interface needs to be assigned to a unique subnet for routing to occur. In this example, the other router interface, F0/1, has been configured to use IP address 172.17.30.1, which is on a different subnet than interface F0/0.</p> <p>By default, Cisco routers are configured to route traffic between the local interfaces. As a result, routing does not specifically need to be enabled. However, if multiple routers are being configured to perform inter-VLAN routing, you may want to enable a dynamic routing protocol to simplify routing table management. If you have not taken the course CCNA Exploration: Routing Protocols and Concepts, you can learn more at this Cisco site: <content-link target="http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/products_configuration_guide_chapter09186a00800ca760.html" type="external">http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/products_configuration_guide_chapter09186a00800ca760.html</content-link>.</p></content-text>
</page>
<page type="OneColumn" id="en1306020102">
<content-media type="InteractiveGraphicHotspots" id="cm4186557277">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306020000/en1306020100/en1306020102/cm4186557277.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306020000/en1306020100/en1306020102/cm4186557277text.xml"/></content-media>
<content-text><p><b>Routing Table</b></p> <p>Now examine the routing table using the <span class="cmd"><b>show ip route</b></span> privileged EXEC mode command. </p> <p>In the example, there are two routes in the routing table. One route is to the 172.17.10.0 subnet, which is attached to the local interface F0/0. The other route is to the 172.17.30.0 subnet, which is attached to the local interface F0/1. The router uses this routing table to determine where to send the traffic it receives. For example, if the router receives a packet on interface F0/0 destined for the 172.17.30.0 subnet, the router would identify that it should send the packet out interface F0/1 to reach hosts on the 172.17.30.0 subnet.</p> <p><b>Click the Verify Router Configuration button in the figure</b> to see an example router configuration.</p> <p><b>Verify Router Configuration</b></p> <p>To verify the router configuration, use the <span class="cmd"><b>show running-config</b> privileged EXEC mode</span> command. This command displays the current operating configuration of the router. You can see which IP addresses have been configured for each of the router interfaces, as well as the operational status of the interface. </p> <p>In this example, notice that interface F0/0 is configured correctly with the 172.17.10.1 IP address. Also, notice the absence of the <span class="cmd"><b>shutdown</b></span> command below the F0/0 interface. The absence of the <span class="cmd"><b>shutdown</b></span> command confirms that the <span class="cmd"><b>no shutdown</b></span> command has been issued and that the interface is enabled.</p> <p>You can get more detailed information about the router interfaces, such as diagnostic information, status, MAC address, and transmit or receive errors, using the <span class="cmd"><b>show interface</b></span> command in privileged EXEC mode. </p></content-text>
</page>
</topic>
<topic type="" id="en1306020200">
<title><content-text>Configure Router-on-a-Stick Inter-VLAN Routing</content-text></title>
<page type="OneColumn" id="en1306020201">
<content-media type="InteractiveGraphicHotspots" id="cm7507412270">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306020000/en1306020200/en1306020201/cm7507412270.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306020000/en1306020200/en1306020201/cm7507412270text.xml"/></content-media>
<content-text><p>Before configuring the router, configure the switch that it will be connected to. </p> <p>As you see in the figure, Router R1 is connected to switch S1 on trunk port F0/5. VLANs 10 and 30 have also been added to switch S1. </p> <p><b>Click the Switch Configuration button in the figure </b>to see the example switch configuration<b>. </b></p> <p>To review, VLANs are created in global configuration mode using the <span class="cmd"><b>vlan </b><i>vlan id</i></span> command. In this example, VLANs 10 and 30 were created on switch S1 using the <span class="cmd"><b>vlan 10</b></span> and <span class="cmd"><b>vlan 30</b></span> commands. </p> <p>Because switch port F0/5 will be configured as a trunk port, you do not have to assign any VLANs to the port. To configure switch port F0/5 as a trunk port, execute the <span class="cmd"><b>switchport mode trunk</b></span> command in interface configuration mode on the F0/5 interface. You cannot use the <span class="cmd"><b>switchport mode dynamic auto</b></span> or <span class="cmd"><b>switchport mode dynamic desirable</b></span> commands because the router does not support dynamic trunking protocol.</p> <p>Finally, to protect the configuration so that it is not lost after a reload of the switch, the <span class="cmd"><b>copy running-config startup-config</b></span> command is executed in privileged EXEC mode to back up the running configuration to the startup configuration.</p> <p><b>Click the Router Configuration button in the figure</b> to see the example router configuration.</p> <p><b>Router Configuration</b></p> <p>Next, the router can be configured to perform the inter-VLAN routing.</p> <p>As you see in the figure, the configuration of multiple subinterfaces is different than when physical interfaces are used. </p> <p>Each subinterface is created using the <span class="cmd"><b>interface </b><i>interface_id.Subinterface_id</i></span> global configuration mode command. In this example, the subinterface Fa0/0.10 is created using the <span class="cmd"><b>interface fa0/0.10</b></span> global configuration mode command. After the subinterface has been created, the VLAN ID is assigned using the <span class="cmd"><b>encapsulation dot1q </b><i>vlan_id</i></span> subinterface configuration mode command. </p> <p>Next, assign the IP address for the subinterface using the <span class="cmd"><b>ip address </b><i>ip_address subnet_mask</i></span> subinterface configuration mode command. In this example, subinterface F0/0.10 is assigned the IP address 172.17.10.1 using the <span class="cmd"><b>ip address 172.17.10.1 255.255.255.0</b></span> command. You do not need to execute a <span class="cmd"><b>no shutdown</b></span> command at the subinterface level because it does not enable the physical interface.</p> <p>This process is repeated for all the router subinterfaces that are needed to route between the VLANs configured on the network. Each router subinterface needs to be assigned an IP address on a unique subnet for routing to occur. In this example, the other router subinterface, F0/0.30, is configured to use IP address 172.17.30.1, which is on a different subnet from subinterface F0/0.10.</p> <p>Once all subinterfaces have been configured on the router physical interface, the physical interface is enabled. In the example, interface F0/0 has the <span class="cmd"><b>no shutdown</b></span> command executed to enable the interface, which enables all of the configured subinterfaces.</p> <p>By default, Cisco routers are configured to route traffic between the local subinterfaces. As a result, routing does not specifically need to be enabled. </p></content-text>
</page>
<page type="OneColumn" id="en1306020202">
<content-media type="InteractiveGraphicHotspots" id="cm1437849336">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306020000/en1306020200/en1306020202/cm1437849336.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306020000/en1306020200/en1306020202/cm1437849336text.xml"/></content-media>
<content-text><p><b>Routing Table</b></p> <p>Next, examine the routing table using the <span class="cmd"><b>show ip route</b></span> command from privileged EXEC mode. In the example, there are two routes in the routing table. One route is to the 172.17.10.0 subnet, which is attached to the local subinterface F0/0.10. The other route is to the 172.17.30.0 subnet, which is attached to the local subinterface F0/0.30. The router uses this routing table to determine where to send the traffic it receives. For example, if the router received a packet on subinterface F0/0.10 destined for the 172.17.30.0 subnet, the router would identify that it should send the packet out subinterface F0/0.30 to reach hosts on the 172.17.30.0 subnet.</p> <p><b>Click the Verify Router Configuration button in the figure</b> to see an example router configuration.</p> <p><b>Verify Router Configuration</b></p> <p>To verify the router configuration, use the <span class="cmd"><b>show running-config</b></span> command in privileged EXEC mode. The <span class="cmd"><b>show running-config</b></span> command displays the current operating configuration of the router. Notice which IP addresses have been configured for each router subinterface, as well as whether the physical interface has been left disabled or enabled using the <span class="cmd"><b>no shutdown</b></span> command. </p> <p>In this example, notice that interface F0/0.10 has been configured correctly with the 172.17.10.1 IP address. Also, notice the absence of the <span class="cmd"><b>shutdown</b></span> command below the F0/0 interface. The absence of the <span class="cmd"><b>shutdown</b></span> command confirms that the <span class="cmd"><b>no shutdown</b></span> command has been issued and the interface is enabled.</p> <p>You can get more detailed information about the router interfaces, such as diagnostic information, status, MAC address, and transmit or receive errors, using the <span class="cmd"><b>show interface</b></span> command in privileged EXEC mode. </p></content-text>
</page>
<page type="OneColumn" id="en1306020203">
<content-media type="InteractiveGraphicHotspots" id="cm1118334279">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306020000/en1306020200/en1306020203/cm1118334279.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306020000/en1306020200/en1306020203/cm1118334279text.xml"/></content-media>
<content-text><p>After the router and switch have been configured to perform the inter-VLAN routing, the next step is to verify that the router is functioning correctly. You can test access to devices on remote VLANs using the <span class="cmd"><b>ping</b></span> command. </p> <p>For the example shown in the figure, you would initiate a <span class="cmd"><b>ping</b></span> and a <span class="cmd"><b>tracert</b></span> from PC1 to the destination address of PC3.</p> <p><b>The Ping Test</b></p> <p>The <span class="cmd"><b>ping</b></span> command sends an <content-link target="{44396E37-F1F9-4F3D-97AF-EA59F365C8F9}" type="glossary">ICMP</content-link> echo request to the destination address. When a host receives an ICMP echo request, it responds with an ICMP echo reply to confirm that it received the ICMP echo request. The <span class="cmd"><b>ping</b></span> command calculates the elapsed time using the difference between the time the ping was sent and the time the echo reply was received. This elapsed time is used to determine the latency of the connection. Successfully receiving a reply confirms that there is a path between the sending device and the receiving device.</p> <p><b>The Tracert Test</b></p> <p>Tracert is a useful utility for confirming the routed path taken between two devices. On <content-link target="{8DF6BA06-223F-49E7-BCFE-FCB65951843B}" type="glossary">UNIX</content-link> systems, the utility is specified by <span class="cmd"><b>traceroute</b></span>. Tracert also uses ICMP to determine the path taken, but it uses ICMP echo requests with specific time-to-live values defined on the frame. </p> <p>The time-to-live value determines exactly how many router hops away the ICMP echo is allowed to reach. The first ICMP echo request is sent with a time-to-live value set to expire at the first router on route to the destination device. </p> <p>When the ICMP echo request times out on the first route, a confirmation is sent back from the router to the originating device. The device records the response from the router and proceeds to send out another ICMP echo request, but this time with a greater time-to-live value. This allows the ICMP echo request to traverse the first router and reach the second device on route to the final destination. The process repeats until finally the ICMP echo request is sent all the way to the final destination device. After the tracert utility finishes running, you are presented with a list of every router interface that the ICMP echo request reached on its way to the destination.</p> <p><b>Click the Device Outputs button in the figure </b>to see a sample ping and tracert command output.</p> <p>In the example, the ping utility was able to send an ICMP echo request to the IP address of PC3. Also, the tracert utility confirms that the path to PC3 is through the 172.17.10.1 subinterface IP address of router R1.</p></content-text>
</page>
<page type="OneColumn" id="en1306020204">
<content-media type="ActivityPKA" id="cm4353947325">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306020000/en1306020200/en1306020204/cm4353947325/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306020000/en1306020200/en1306020204/cm4353947325/icontext.xml"/></content-media>
<content-text><p>In this activity, you will configure traditional inter-VLAN routing simply by configuring the Fast Ethernet interface on a router. R1 has two connections to S1, one for each of the two VLANs. S1 and R1 already have basic configurations. You will complete the configuration by adding VLANs to S1 and assigning VLANs to the correct ports. Then you will configure R1 with IP addressing. In traditional inter-VLAN routing, there are no additional VLAN-related configurations needed on R1.</p> <p>Detailed instructions are provided within the activity as well as in the PDF link below.</p> <p><content-link target="E3_PTAct_6_2_2_4.pdf" type="internalfile">Activity Instructions (PDF)</content-link></p> <p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
<page type="OneColumn" id="en1306020205">
<content-media type="ActivityPKA" id="cm8661247955">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306020000/en1306020200/en1306020205/cm8661247955/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306020000/en1306020200/en1306020205/cm8661247955/icontext.xml"/></content-media>
<content-text><p>In this activity, you will configure Router-on-a-Stick inter-VLAN routing. R1 has one connection to S1. S1 and R1 already have basic configurations. You will complete the configuration by adding VLANs to S1 and assigning VLANs to the correct ports. Then you will configure R1 with subinterfaces, 802.1Q encapsulation, and IP addressing.</p> <p>Detailed instructions are provided within the activity as well as in the PDF link below.</p> <p><content-link target="E3_PTAct_6_2_2_5.pdf" type="internalfile">Activity Instructions (PDF)</content-link></p> <p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="en1306030000">
<title><content-text>Troubleshooting Inter-VLAN Routing</content-text></title>
<topic type="" id="en1306030100">
<title><content-text>Switch Configuration Issues</content-text></title>
<page type="OneColumn" id="en1306030101">
<content-media type="InteractiveGraphicHotspots" id="cm7323586735">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306030000/en1306030100/en1306030101/cm7323586735.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306030000/en1306030100/en1306030101/cm7323586735text.xml"/></content-media>
<content-text><p>In this topic, we discuss the challenges associated with configuring multiple VLANs on a network. This topic explores common issues and describes troubleshooting methods to identify and correct those issues.</p> <p>When using the traditional routing model for inter-VLAN routing, ensure that the switch ports that connect to the router interfaces are configured on the correct VLANs. If the switch ports are not configured on the correct VLAN, devices configured on that VLAN cannot connect to the router interface, and therefore, are unable to route to the other VLANs.</p> <p><b>Click the Topology 1 button in the figure.</b></p> <p>As you can see in Topology 1, PC1 and router R1 interface F0/0 are configured to be on the same logical subnet, as indicated by their IP address assignment. However, the switch port F0/4 that connects to router R1 interface F0/0 has not been configured and remains in the default VLAN. Because router R1 is on a different VLAN than PC1, they are unable to communicate.</p> <p>To correct this problem, execute the <span class="cmd"><b>switchport access vlan 10</b></span> interface configuration command on switch port F0/4 on switch S1. When the switch port is configured for the correct VLAN, PC1 can communicate with router R1 interface F0/0, which allows it to access the other VLANs connected to router R1.</p> <p><b>Click the Topology 2 button in the figure</b> to see another switch configuration issue.</p> <p>In Topology 2, the router-on-a-stick routing model has been chosen. However, the F0/5 interface on switch S1 is not configured as a trunk and subsequently left in the default VLAN for the port. As a result, the router is not able to function correctly because each of its configured subinterfaces is unable to send or receive VLAN tagged traffic. This prevents all configured VLANs from routing through router R1 to reach the other VLANs.</p> <p>To correct this problem, execute the <span class="cmd"><b>switchport mode trunk</b></span> interface configuration command on switch port F0/5 on switch S1. This converts the interface to a trunk, allowing the trunk to successfully establish a connection with router R1. When the trunk is successfully established, devices connected to each of the VLANs are able to communicate with the subinterface assigned to their VLAN, allowing inter-VLAN routing to occur.</p> <p><b>Click the Topology 3 button in the figure</b> to see another switch configuration issue.</p> <p>In Topology 3, the trunk link between switch S1 and switch S2 is down. Because there is no redundant connection or path between the devices, all devices connected to switch S2 are unable to reach router R1. As a result, all devices connected to switch S2 are unable to route to other VLANs through router R1.</p> <p>To reduce the risk of a failed inter-switch link disrupting inter-VLAN routing, redundant links and alternate paths should be configured between switch S1 and switch S2. Redundant links are configured in the form of an EtherChannel that protects against a single link failure. Cisco EtherChannel technology enables you to aggregate multiple physical links into one logical link. This can provide up to 80 Gb/s of aggregate bandwidth for with 10 Gigabit EtherChannel. </p> <p>Additionally, alternate paths through other interconnected switches could be configured. This approach is dependent on the Spanning Tree Protocol (STP) to prevent the possibility of loops within the switch environment. There would also be a slight disruption in router access while STP determines whether the current link is down and finds an alternate route.</p> <p>The CCNP curriculum addresses EtherChannel technology; also, to learn more about Cisco EtherChannel technology, visit: <content-link target="http://www.cisco.com/en/US/tech/tk389/tk213/technologies_white_paper09186a0080092944.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk213/technologies_white_paper09186a0080092944.shtml</content-link>.</p> <p>To learn more about configuring EtherChannel on a Cisco Catalyst 2960 switch, visit: <content-link target="http://www.cisco.com/en/US/products/ps6406/products_configuration_guide_chapter09186a00808752d9.html" type="external">http://www.cisco.com/en/US/products/ps6406/products_configuration_guide_chapter09186a00808752d9.html</content-link>.</p></content-text>
</page>
<page type="OneColumn" id="en1306030102">
<content-media type="InteractiveGraphicHotspots" id="cm6608656533">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306030000/en1306030100/en1306030102/cm6608656533.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306030000/en1306030100/en1306030102/cm6608656533text.xml"/></content-media>
<content-text><p><b>Switch Cisco IOS Commands</b></p> <p>When you suspect that there is a problem with a switch configuration, use the various verification commands to examine the configuration and identify the problem.</p> <p><b>Click the Incorrect VLAN Assignment button in the figure.</b></p> <p>The screen output shows the results of the <span class="cmd"><b>show interface </b><i>interface-id</i><b> switchport</b></span> command. Assume that you have issued these commands because you suspect that VLAN 10 has not been assigned to port F0/4 on switch S1. The top highlighted area shows that port F0/4 on switch S1 is in access mode, but it does not show that it has been directly assigned to VLAN 10. The bottom highlighted area confirms that port F0/4 is still set to the default VLAN. The <span class="cmd"><b>show running-config</b></span> and the <span class="cmd"><b>show interface </b><i>interface-id</i><b> switchport</b></span> commands are useful for identifying VLAN assignment and port configuration issues.</p> <p><b>Click the Incorrect Access Mode button in the figure.</b></p> <p>After device configuration has changed, communication between router R1 and switch S1 has stopped. The link between the router and the switch is supposed to be a trunk link. The screen output shows the results of the <span class="cmd"><b>show interface </b><i>interface-id</i><b> switchport</b></span> and the <span class="cmd"><b>show running-config</b></span> commands. The top highlighted area confirms that port F0/4 on switch S1 is in access mode, not trunk mode. The bottom highlighted area also confirms that port F0/4 has been configured for access mode.</p></content-text>
</page>
</topic>
<topic type="" id="en1306030200">
<title><content-text>Router Configuration Issues</content-text></title>
<page type="OneColumn" id="en1306030201">
<content-media type="InteractiveGraphicHotspots" id="cm1617308680">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306030000/en1306030200/en1306030201/cm1617308680.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306030000/en1306030200/en1306030201/cm1617308680text.xml"/></content-media>
<content-text><p>One of the most common inter-VLAN router configuration errors is to connect the physical router interface to the wrong switch port, placing it on the incorrect VLAN and preventing it from reaching the other VLANs.</p> <p>As you can see in Topology 1, router R1 interface F0/0 is connected to switch S1 port F0/9. Switch port F0/9 is configured for Default VLAN, not VLAN10. This prevents PC1 from being able to communicate with the router interface, and it is therefore unable to route to VLAN30.</p> <p>To correct this problem, physically connect router R1 interface F0/0 to switch S1 port F0/4. This puts the router interface on the correct VLAN and allows inter-VLAN routing to function. Alternatively, you could change the VLAN assignment of switch port F0/9 to be on VLAN10. This also allows PC1 to communicate with router R1 interface F0/0.</p> <p><b>Click the Topology 2 button in the figure </b>to see another router configuration issue.</p> <p>In Topology 2, router R1 has been configured to use the wrong VLAN on subinterface F0/0.10, preventing devices configured on VLAN10 from communicating with subinterface F0/0.10. This subsequently prevents those devices from being able to route to other VLANs on the network.</p> <p>To correct this problem, configure subinterface F0/0.10 to be on the correct VLAN using the <span class="cmd"><b>encapsulation dot1q 10</b></span> subinterface configuration mode command. When the subinterface has been assigned to the correct VLAN, it is accessible by devices on that VLAN and can perform inter-VLAN routing.</p></content-text>
</page>
<page type="OneColumn" id="en1306030202">
<content-media type="InteractiveGraphicHotspots" id="cm3242450086">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306030000/en1306030200/en1306030202/cm3242450086.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306030000/en1306030200/en1306030202/cm3242450086text.xml"/></content-media>
<content-text><p><b>Verify Router Configuration</b></p> <p>In this troubleshooting scenario, you suspect a problem with the router R1. The subinterface F0/0.10 should allow access to VLAN 10 traffic, and the subinterface F0/0.30 should allow VLAN 30 traffic. The screen capture shows the results of running the <span class="cmd"><b>show interface</b></span> and the <span class="cmd"><b>show running-config</b></span> commands. </p> <p>The top highlighted section shows that the subinterface F0/0.10 on router R1 uses VLAN 100. The <span class="cmd"><b>show interface</b></span> command produces a lot of output, making it sometimes hard to see the problem. </p> <p>The <span class="cmd"><b>show running-config</b></span> confirms that the subinterface F0/0.10 on router R1 has been configured to allow access to VLAN 100 traffic and not VLAN 10. Perhaps this was a typing mistake.</p> <p>With proper verification, router configuration problems are quickly addressed, allowing for inter-VLAN routing to function again properly. Recall that the VLANs are directly connected, which is how they enter the routing table.</p></content-text>
</page>
</topic>
<topic type="" id="en1306030300">
<title><content-text>IP Addressing Issues</content-text></title>
<page type="OneColumn" id="en1306030301">
<content-media type="InteractiveGraphicHotspots" id="cm2297013957">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306030000/en1306030300/en1306030301/cm2297013957.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306030000/en1306030300/en1306030301/cm2297013957text.xml"/></content-media>
<content-text><p>As we have discussed, subnets are the key to implementing inter-VLAN routing. VLANs correspond to unique subnets on the network. For inter-VLAN routing to operate, a router needs to be connected to all VLANs, either by separate physical interfaces or trunked subinterfaces. Each interface, or subinterface, needs to be assigned an IP address that corresponds to the subnet for which it is connected. This permits devices on the VLAN to communicate with the router interface and enable the routing of traffic to other VLANs connected to the router.</p> <p>Let's examine some common errors. </p> <p>As you can see in Topology 1, router R1 has been configured with an incorrect IP address on interface F0/0. This prevents PC1 from being able to communicate with router R1 on VLAN10.</p> <p>To correct this problem, assign the correct IP address to router R1 interface F0/0 using the <span class="cmd"><b>ip address 172.17.10.1 255.255.255.0</b></span> interface command in configuration mode. After the router interface has been assigned the correct IP address, PC1 can use the interface as a default gateway for accessing other VLANs.</p> <p><b>Click the Topology 2 button in the figure </b>to see another IP address configuration issue.</p> <p>In Topology 2, PC1 has been configured with an incorrect IP address for the subnet associated with VLAN10. This prevents PC1 from being able to communicate with router R1 on VLAN10.</p> <p>To correct this problem, assign the correct IP address to PC1. Depending on the type of PC being used, the configuration details may be different.</p> <p><b>Click the Topology 3 button in figure</b> to see another IP address configuration issue.</p> <p>In Topology 3, PC1 has been configured with the incorrect subnet mask. According to the subnet mask configured for PC1, PC1 is on the 172.17.0.0 network. This results in PC1 determining that PC3, with IP address 172.17.30.23, is on the local subnet. As a result, PC1 does not forward traffic destined for PC3 to router R1 interface F0/0. Therefore, the traffic never reaches PC3.</p> <p>To correct this problem, change the subnet mask on PC1 to 255.255.255.0. Depending on the type of PC being used, the configuration details may be different.</p></content-text>
</page>
<page type="OneColumn" id="en1306030302">
<content-media type="InteractiveGraphicHotspots" id="cm7754357121">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306030000/en1306030300/en1306030302/cm7754357121.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306030000/en1306030300/en1306030302/cm7754357121text.xml"/></content-media>
<content-text><p><b>Verification Commands</b></p> <p>Earlier you learned that each interface, or subinterface, needs to be assigned an IP address that corresponds to the subnet for which it is connected. A common error is to incorrectly configure an IP address for a subinterface. The screen capture shows the results of the <span class="cmd"><b>show running-config</b></span> command. The highlighted area shows that the subinterface F 0/0.10 on router R1 has an IP address of 172.17.20.1. The VLAN for this subinterface should allow VLAN 10 traffic. There is an IP address that has been incorrectly configured. The <span class="cmd"><b>show ip interface</b></span> is another useful command. The second highlight shows the incorrect IP address.</p> <p><b>Click PC IP Addressing Issue button.</b></p> <p>Sometimes it is the end-user device, such as a personal computer, that is the culprit. In the screen output configuration of the computer PC1, the IP address is 172.17.20.21, with a subnet mask of 255.255.255.0. But in this scenario, PC1 should be in VLAN10, with an address of 172.17.10.21 and a subnet mask of 255.255.255.0.</p></content-text>
</page>
<page type="OneColumn" id="en1306030303">
<content-media type="ActivityPKA" id="cm7464815800">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306030000/en1306030300/en1306030303/cm7464815800/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306030000/en1306030300/en1306030303/cm7464815800/icontext.xml"/></content-media>
<content-text><p>In this activity, you will troubleshoot connectivity problems between PC1 and PC3. The activity is complete when you achieve 100% and the two PCs can ping each other. Any solution you implement must conform to the topology diagram.</p> <p>Detailed instructions are provided within the activity as well as in the PDF link below.</p> <p><content-link target="E3_PTAct_6_3_3.pdf" type="internalfile">Activity Instructions (PDF)</content-link></p> <p>Click the Packet Tracer icon for more details.</p></content-text>
</page>
</topic>
</section>
<section type="" id="en1306040000">
<title><content-text>Chapter Labs</content-text></title>
<topic type="" id="en1306040100">
<title><content-text>Basic Inter-VLAN Routing</content-text></title>
<page type="OneColumn" id="en1306040101">
<content-media type="ActivityLab" id="cm2334396946">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306040000/en1306040100/en1306040101/cm2334396946/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306040000/en1306040100/en1306040101/cm2334396946/icontext.xml"/></content-media>
<content-text><p>It is necessary to break up large broadcast domains created by the physical topology of a switched network using VLANs. It is also necessary for users on one VLAN to be able to communicate with each other. This communication is possible because of Inter-VLAN routing. This lab will teach you how to configure it.</p></content-text>
</page>
<page type="OneColumn" id="en1306040102">
<content-media type="ActivityPKA" id="cm3295293020">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306040000/en1306040100/en1306040102/cm3295293020/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306040000/en1306040100/en1306040102/cm3295293020/icontext.xml"/></content-media>
<content-text><p>This activity is a variation of Lab 6.4.1. Packet Tracer may not support all the tasks specified in the hands-on lab. This activity should not be considered equivalent to completing the hands-on lab. Packet Tracer is not a substitute for a hands-on lab experience with real equipment.</p> <p>Detailed instructions are provided within the activity as well as in the PDF link below.</p> <p><content-link target="E3_PTAct_6_4_1.pdf" type="internalfile">Activity Instructions (PDF)</content-link></p> <p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
<topic type="" id="en1306040200">
<title><content-text>Challenge Inter-VLAN Routing</content-text></title>
<page type="OneColumn" id="en1306040201">
<content-media type="ActivityLab" id="cm1784797972">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306040000/en1306040200/en1306040201/cm1784797972/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306040000/en1306040200/en1306040201/cm1784797972/icontext.xml"/></content-media>
<content-text><p>Given a network topology and a set of requirements, are you able to set up Inter-VLAN routing? This lab will test your abilities. Be sure to verify your answers with your instructor.</p></content-text>
</page>
<page type="OneColumn" id="en1306040202">
<content-media type="ActivityPKA" id="cm3105974180">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306040000/en1306040200/en1306040202/cm3105974180/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306040000/en1306040200/en1306040202/cm3105974180/icontext.xml"/></content-media>
<content-text><p>This activity is a variation of Lab 6.4.2. Packet Tracer may not support all the tasks specified in the hands-on lab. This activity should not be considered equivalent to completing the hands-on lab. Packet Tracer is not a substitute for a hands-on lab experience with real equipment. </p> <p>Detailed instructions are provided within the activity as well as in the PDF link below.</p> <p><content-link target="E3_PTAct_6_4_2.pdf" type="internalfile">Activity Instructions (PDF)</content-link></p> <p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
<topic type="" id="en1306040300">
<title><content-text>Troubleshooting Inter-VLAN Routing</content-text></title>
<page type="OneColumn" id="en1306040301">
<content-media type="ActivityLab" id="cm7109533792">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306040000/en1306040300/en1306040301/cm7109533792/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306040000/en1306040300/en1306040301/cm7109533792/icontext.xml"/></content-media>
<content-text><p>The network has been designed and configured to support five VLANs and a separate server network. Inter-VLAN routing is being provided by an external router in a router-on-a-stick configuration, and the server network is routed across a separate Fast Ethernet interface. However, it is not working as designed, and complaints from your users have not given much insight into the source of the problems. You must first define what is not working as expected, and then analyze the existing configurations to determine and correct the source of the problems. </p> <p>This lab is complete when you can demonstrate IP connectivity between each of the user VLANs and the external server network, and between the switch management VLAN and the server network. </p></content-text>
</page>
<page type="OneColumn" id="en1306040302">
<content-media type="ActivityPKA" id="cm9342422805">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306040000/en1306040300/en1306040302/cm9342422805/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306040000/en1306040300/en1306040302/cm9342422805/icontext.xml"/></content-media>
<content-text><p>This activity is a variation of Lab 6.4.3. Packet Tracer may not support all the tasks specified in the hands-on lab. This activity should not be considered equivalent to completing the hands-on lab. Packet Tracer is not a substitute for a hands-on lab experience with real equipment.</p> <p>Detailed instructions are provided within the activity as well as in the PDF link below.</p> <p><content-link target="E3_PTAct_6_4_3.pdf" type="internalfile">Activity Instructions (PDF)</content-link></p> <p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterSummary" id="en1306050000">
<title><content-text>Chapter Summary</content-text></title>
<topic type="" id="en1306050100">
<title><content-text>Chapter Summary</content-text></title>
<page type="OneColumn" id="en1306050101">
<content-media type="ChapterSummary" id="cm5808330128">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306050000/en1306050100/en1306050101/cm5808330128.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306050000/en1306050100/en1306050101/cm5808330128text.xml"/></content-media>
<content-text><p>Inter-VLAN routing is the process of routing traffic between different VLANs, using either a dedicated router or a multilayer switch. Inter-VLAN routing facilitates communication between devices isolated by VLAN boundaries. </p> <p>The inter-VLAN routing topology using an external router with subinterfaces trunked to a Layer 2 switch is called router-on-a-stick. With this option, it is important to configure an IP address on each logical subinterface as well as the associated VLAN number.</p> <p>Modern switched networks use switch virtual interfaces on multilayer switches to enable inter-VLAN routing.</p> <p>Catalyst 2960 switches can be used in a router-on-a-stick scenario, while Catalyst 3560 switches can be used for the multilayer switching option for inter-VLAN routing.</p></content-text>
</page>
<page type="FullScreen" id="en1306050102">
<content-media type="StaticGraphic" id="cm1273733225">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306050000/en1306050100/en1306050102/cm1273733225.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="en1306000000/en1306050000/en1306050100/en1306050102/cm1273733225text.xml"/></content-media>
<content-text></content-text>
</page>
<page type="OneColumn" id="en1306050103">
<content-media type="ActivityPKA" id="cm9061605460">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306050000/en1306050100/en1306050103/cm9061605460/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="en1306000000/en1306050000/en1306050100/en1306050103/cm9061605460/icontext.xml"/></content-media>
<content-text><p>In this activity, you will demonstrate and reinforce your ability to configure switches and routers for inter-VLAN communication. Among the skills you will demonstrate are configuring VLANs, VTP, and trunking on switches. You will also administer STP on switches and configure a router-on-a-stick using subinterfaces.</p> <p>Detailed instructions are provided within the activity as well as in the PDF link below.</p> <p><content-link target="E3_PTAct_6_5_1.pdf" type="internalfile">Activity Instructions (PDF)</content-link></p> <p><b>Click the Packet Tracer icon for more details.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterQuiz" id="en1306060000">
<title><content-text>Chapter Quiz</content-text></title>
<topic type="" id="en1306060100">
<title><content-text>Chapter Quiz</content-text></title>
<page type="FullScreen" id="en1306060101">
<content-media type="ChapterQuiz" id="cm8991483235">	<title><content-text></content-text></title>	<media ref="en1306000000/en1306060000/en1306060100/en1306060101/cm8991483235/" mime="" scale="true" type="directory" width="100%" height="100%" external="en1306000000/en1306060000/en1306060100/en1306060101/cm8991483235/icontext.xml"/></content-media>
<content-text><p>Chapter Quiz</p></content-text>
</page>
</topic>
</section>
</chapter>
