<chapter type="" id="tl1305000000">
<title><content-text>Protocole STP</content-text></title>
<section type="ChapterIntroduction" id="tl1305000000">
<title><content-text>Présentation du chapitre</content-text></title>
<topic type="" id="tl1305000100">
<title><content-text>Présentation</content-text></title>
<page type="OneColumn" id="tl1305000101">
<content-media type="ChapterIntroduction" id="cm8716362792">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305000000/tl1305000100/tl1305000101/cm8716362792.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305000000/tl1305000100/tl1305000101/cm8716362792text.xml"/></content-media>
<content-text><p>Pour la plupart des petites et moyennes entreprises, les réseaux informatiques sont indéniablement des composants essentiels. Les administrateurs informatiques doivent donc mettre en oeuvre une architecture redondante dans leurs réseaux hiérarchiques. Cependant, l’ajout de liaisons supplémentaires aux commutateurs et aux routeurs du réseau crée des boucles dans le trafic, qui doivent être gérées de manière dynamique ; lorsqu’une connexion à un commutateur est coupée, une autre liaison doit rapidement prendre le relais sans générer de nouvelles <content-link target="{0DE28A74-DFF2-4B0B-8CA6-0FAD549CD488}" type="glossary">boucles</content-link>. Dans ce chapitre, vous découvrirez comment le <content-link target="{8776D853-1CAD-4943-AEA4-BC2E928BA0BF}" type="glossary">STP</content-link> (Spanning Tree Protocol) répond à la problématique des boucles dans le réseau, et comment ce protocole a évolué en un protocole qui calcule rapidement les ports devant être bloqués pour éviter la formation de boucles dans un réseau local virtuel (VLAN).</p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305010000">
<title><content-text>Topologies redondantes de couche 2</content-text></title>
<topic type="" id="tl1305010100">
<title><content-text>Redondance</content-text></title>
<page type="OneColumn" id="tl1305010101">
<content-media type="AnimationPartialScreen" id="cm9869081782">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010100/tl1305010101/cm9869081782.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010100/tl1305010101/cm9869081782text.xml"/></content-media>
<content-text><p><b>Redondance dans un réseau hiérarchique</b></p> <p>Le modèle de conception hiérarchique a été présenté dans le chapitre 1. Il résout les problèmes présents dans les topologies non hiérarchisées. La redondance constitue l’un de ces problèmes. La redondance de couche 2 améliore la disponibilité du réseau grâce à la mise en place de chemins alternatifs via l’ajout d’équipements et de câbles. Si les données ont la possibilité d’emprunter plusieurs chemins pour traverser le réseau, un chemin peut être coupé sans aucune incidence sur la connectivité des périphériques du réseau.</p> <p>Comme vous pouvez le voir dans l’animation :</p> <p>1. PC1 communique avec PC4 sur une topologie de réseau configurée de manière redondante.</p> <p>2. En cas de défaillance de la liaison réseau entre le commutateur S1 et le commutateur S2, le chemin entre PC1 et PC4 est automatiquement modifié afin d’assurer la continuité du service. </p> <p>3. Lorsque la connexion réseau entre S1 et S2 est restaurée, le chemin est alors réajusté afin que le trafic passe directement de S2 à S1 pour parvenir à PC4.</p> <p>Dans la mesure où les réseaux sont de plus en plus importants pour les entreprises, la disponibilité de l’infrastructure réseau, qui constitue désormais un critère primordial, doit être assurée. La redondance est la solution qui permet d’obtenir la disponibilité nécessaire.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010102">
<content-media type="InteractiveGraphicRollovers" id="cm6903122720">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010100/tl1305010102/cm6903122720.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010100/tl1305010102/cm6903122720text.xml"/></content-media>
<content-text><p><b>Examen d’une conception redondante</b></p> <p>Dans une conception hiérarchique, la redondance est assurée au niveau de la couche distribution et de la couche coeur de réseau par le biais de matériel supplémentaire et de chemins de substitution grâce au matériel supplémentaire.</p> <p><b>Cliquez sur le bouton Accès du point de départ à la couche de distribution dans la figure.</b></p> <p>Cet exemple illustre un réseau hiérarchique comprenant une couche coeur de réseau, une couche de distribution et une couche d’accès. Chaque commutateur de la couche d’accès est connecté à deux commutateurs de la couche de distribution, et chaque commutateur de la couche de distribution est connecté aux deux commutateurs de la couche coeur de réseau. Le fait de disposer de plusieurs chemins pour la liaison entre PC1 et PC4 crée une redondance qui peut gérer un point d’échec unique entre la couche d’accès et la couche de distribution, et entre la couche de distribution et la couche coeur de réseau.</p> <p>Le protocole STP est activé sur tous les commutateurs. Le protocole STP est le sujet de ce chapitre et fera l’objet d’explications détaillées. Pour l’instant, notez que le protocole STP a placé certains ports de commutateurs en état de transmission (forwarding), et d’autres en état de blocage (blocking). Cette configuration permet d’éviter les boucles dans le réseau de couche 2. Le protocole STP utilise une liaison redondante uniquement en cas de défaillance de la liaison principale.</p> <p>Dans l’exemple, PC1 peut communiquer avec PC4 en empruntant le chemin identifié.</p> <p><b>Cliquez sur le bouton Échec du chemin de la couche d’accès à la couche de distribution dans la figure.</b></p> <p>La liaison entre le commutateur S1 et le commutateur D1 a été interrompue, ce qui empêche les données de PC1 destinées à PC4 d’atteindre le commutateur D1 via le chemin initial. Cependant, étant donné que le commutateur S1 dispose d’un second chemin vers PC4 via le commutateur D2, le chemin est mis à jour et les données peuvent atteindre PC4.</p> <p><b>Cliquez sur le bouton Échec du chemin de la couche de distribution à la couche coeur de réseau dans la figure.</b></p> <p>La liaison entre le commutateur D1 et le commutateur C2 a été interrompue, ce qui empêche les données de PC1 destinées à PC4 d’atteindre le commutateur C2 via le chemin initial. Cependant, étant donné que le commutateur D1 dispose d’un second chemin vers PC4 via le commutateur C1, le chemin est mis à jour et les données peuvent atteindre PC4.</p> <p><b>Cliquez sur le bouton Échec du commutateur de la couche de distribution dans la figure.</b></p> <p>Ici, le commutateur D1 est défaillant, et les données de PC1, destinées à PC4, ne peuvent donc pas atteindre le commutateur C2 via le chemin initial. Cependant, étant donné que le commutateur S1 dispose d’un second chemin vers PC4 par le biais du commutateur D2, le chemin est mis à jour et les données peuvent atteindre PC4.</p> <p><b>Cliquez sur le bouton Échec du commutateur de la couche coeur de réseau dans la figure.</b></p> <p>Ici, le commutateur C2 est défaillant et les données de PC1 destinées à PC4 ne peuvent pas atteindre le commutateur D4 via le chemin initial. Cependant, étant donné que le commutateur D1 dispose d’un second chemin vers PC4 via le commutateur C1, le chemin est mis à jour et les données peuvent atteindre PC4.</p> <p>La redondance offre une grande liberté de choix des chemins dans un réseau ; elle permet d’assurer la transmission des données même si un chemin ou un périphérique est défaillant dans la couche de distribution ou la couche coeur de réseau. La redondance implique certaines difficultés qui doivent être résolues pour permettre le déploiement en toute sécurité d’une architecture redondante dans un réseau hiérarchique.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305010200">
<title><content-text>Problèmes liés à la redondance</content-text></title>
<page type="OneColumn" id="tl1305010201">
<content-media type="AnimationPartialScreen" id="cm8959741771">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010200/tl1305010201/cm8959741771.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010200/tl1305010201/cm8959741771text.xml"/></content-media>
<content-text><p><b>Boucles de couche 2 </b></p> <p>La redondance est une composante importante de la conception hiérarchique. Bien que la redondance soit importante pour la disponibilité du réseau, il est essentiel de prendre en compte certains facteurs avant de pouvoir envisager la mise en oeuvre d’une architecture redondante dans un réseau.</p> <p>Lorsqu’il existe plusieurs chemins entre deux périphériques du réseau et que le protocole STP a été désactivé sur ces commutateurs, une boucle de couche 2 peut se former. Si le protocole STP est activé sur ces commutateurs (paramètre par défaut), aucune boucle de couche 2 ne se forme.</p> <p>Les trames Ethernet n’ont pas de <content-link target="{D7F5E517-2991-49F7-B10B-3A4D238DA810}" type="glossary">durée de vie</content-link> (TTL) comme les paquets IP qui traversent les routeurs. Par conséquent, si elles ne sont pas arrêtées correctement dans un réseau commuté, elles continuent de circuler indéfiniment d’un commutateur à un autre ou jusqu’à ce qu’une liaison soit interrompue et mette fin à la boucle.</p> <p>Des trames de diffusion sont transmises par tous les ports, hormis le port d’origine. De cette manière, tous les périphériques du domaine de diffusion reçoivent la trame. Si la trame peut emprunter plusieurs chemins, une boucle sans fin pourra être créée.</p> <p><b>Cliquez sur Lire dans la figure pour lancer l’animation.</b></p> <p>Dans l’animation :</p> <p>1. PC1 envoie une trame de diffusion au commutateur S2. </p> <p>2. Lorsque le commutateur S2 reçoit la trame de diffusion, il met à jour sa table d’adresses MAC pour consigner que PC1 est disponible sur le port F0/11. </p> <p>3. Étant donné qu’il s’agit d’une trame de diffusion, le commutateur S2 transmet la trame à tous les ports, y compris Agrégation1 et Agrégation2. </p> <p>4. Lorsque la trame de diffusion parvient aux commutateurs S3 et S1, ces derniers mettent à jour leur table d’adresses MAC pour indiquer que PC1 est disponible à partir du port F0/1 sur le commutateur S1 et du port F0/2 sur le commutateur S3. </p> <p>5. Étant donné qu’il s’agit d’une trame de diffusion, les commutateurs S1 et S3 la transmettent à tous les ports, sauf au port sur lequel elle a été reçue. </p> <p>6. Le commutateur S3 envoie ensuite la trame au commutateur S1, et inversement. Chacun d’eux met à jour sa table d’adresses MAC en consignant le port incorrect pour PC1. </p> <p>7. Chaque commutateur transmet de nouveau la trame de diffusion à tous ses ports, à l’exception de celui sur lequel elle est arrivée ; les deux commutateurs transmettent donc la trame à S2.</p> <p>8. Lorsque le commutateur S2 reçoit les trames de diffusion à partir des commutateurs S3 et S1, la table d’adresses MAC est de nouveau mise à jour, la dernière entrée reçue des deux autres commutateurs étant alors consignée. </p> <p>Ce déroulement se répète en continu, jusqu’à ce que la boucle soit désactivée par la déconnexion physique des connexions qui l’ont créée, ou jusqu’à ce que l’un des commutateurs inclus dans la boucle soit mis hors tension.</p> <p>Les boucles entraînent une charge UC importante sur tous les commutateurs pris dans la boucle. Dans la mesure où les mêmes trames transitent constamment entre les différents commutateurs faisant partie de la boucle, à terme, l’UC du commutateur est amenée à traiter une importante quantité de données. Par conséquent, les performances du commutateur se dégradent lors de l’arrivée du trafic légitime.</p> <p>Lorsqu’un hôte est pris dans une boucle réseau, les autres hôtes du réseau ne peuvent pas y accéder. Étant donné que la table d’adresses MAC change constamment en raison des mises à jour des trames de diffusion, le commutateur ne sait pas vers quel port il doit transmettre les trames de monodiffusion (unicast) pour qu’elles atteignent la destination finale. Les trames de monodiffusion finissent également par tourner en boucle sur le réseau. Avec la multiplication progressive des trames qui circulent en boucle sur le réseau, une tempête de diffusion se produit.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010202">
<content-media type="AnimationPartialScreen" id="cm3521427881">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010200/tl1305010202/cm3521427881.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010200/tl1305010202/cm3521427881text.xml"/></content-media>
<content-text><p><b>Tempêtes de diffusion</b></p> <p>Une tempête de diffusion se produit lorsque toute la bande passante disponible est consommée en raison du nombre trop élevé de trames de diffusion prises dans une boucle de couche 2. Par conséquent, il n’y a plus de bande passante disponible pour le trafic légitime et le réseau est rendu inutilisable pour les communications de données.</p> <p>Une tempête de diffusion est inévitable sur un réseau comportant des boucles. Avec la multiplication des périphériques qui envoient des trames de diffusion sur le réseau, le trafic inclus dans la boucle est de plus en plus important. À terme, il se produit une tempête de diffusion qui provoque une panne du réseau.</p> <p>Les tempêtes de diffusion génèrent d’autres problèmes. Dans la mesure où le trafic de diffusion est transmis à chaque port d’un commutateur, tous les périphériques connectés doivent traiter l’intégralité du trafic de diffusion qui circule sans fin sur le réseau comportant des boucles. Par conséquent, il est possible que le périphérique final ne fonctionne pas correctement en raison des exigences de traitement élevées pour gérer une charge de trafic aussi importance sur la <content-link target="{9AB79491-096F-4FF5-9B18-3535B2A31227}" type="glossary">carte d'interface réseau</content-link>.</p> <p><b>Cliquez sur Lire dans la figure pour lancer l’animation.</b></p> <p>Dans l’animation :</p> <p>1. PC1 envoie une trame de diffusion sur le réseau comportant des boucles. </p> <p>2. La trame de diffusion finit par circuler en boucle entre tous les commutateurs interconnectés sur le réseau.</p> <p>3. PC4 envoie également une trame de diffusion sur le réseau comportant des boucles. </p> <p>4. La trame de diffusion de PC4 est également prise dans la boucle et finit par circuler en boucle entre tous les commutateurs interconnectés, exactement comme la trame de diffusion de PC1. </p> <p>5. Avec la multiplication progressive des trames de diffusion envoyées sur le réseau par d’autres périphériques, la quantité de trafic prise dans la boucle s’accroît, ce qui provoque à terme une tempête de diffusion. </p> <p>6. Lorsque le réseau est complètement saturé par le trafic de diffusion circulant en boucle entre les commutateurs, tout trafic supplémentaire est rejeté par le commutateur, car ce dernier n’est pas en mesure de le traiter.</p> <p>Étant donné que les périphériques connectés à un réseau envoient constamment des trames de diffusion (telles que des requêtes ARP), une tempête de diffusion peut survenir en un rien de temps. Par conséquent, la formation d’une boucle provoque rapidement la désactivation du réseau.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010203">
<content-media type="AnimationPartialScreen" id="cm2657468873">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010200/tl1305010203/cm2657468873.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010200/tl1305010203/cm2657468873text.xml"/></content-media>
<content-text><p><b>Trames de monodiffusion en double</b></p> <p>Les boucles ne concernent pas uniquement les trames de diffusion : lorsque des trames de monodiffusion (unicast) sont envoyées sur un réseau comportant des boucles, des trames en double peuvent parvenir à la destination finale.</p> <p><b>Cliquez sur Lire dans la figure pour lancer l’animation.</b></p> <p>Dans l’animation :</p> <p>1. PC1 envoie une trame de monodiffusion destinée à PC4. </p> <p>2. Le commutateur S2 ne possède pas d’entrée pour PC4 dans sa table d’adresses MAC. Par conséquent, il achemine la trame de monodiffusion par tous ses ports afin de trouver PC4. </p> <p>3. La trame parvient aux commutateurs S1 et S3. </p> <p>4. Le commutateur S1 possède une entrée pour PC4 dans sa table d’adresses MAC. Par conséquent, il achemine la trame vers PC4. </p> <p>5. Le commutateur S3 possède également une entrée dans sa table d’adresses MAC pour PC4. Par conséquent, il achemine la trame de monodiffusion via Agrégation3 vers le commutateur S1. </p> <p>6. Le commutateur S1 reçoit la trame en double et l’achemine une fois encore vers PC4. </p> <p>7. PC4 a reçu la même trame deux fois.</p> <p>La plupart des protocoles de couche supérieure ne sont pas conçus pour reconnaître ou gérer les transmissions en double. En général, les protocoles qui utilisent un mécanisme de numérotation de séquences considèrent que la transmission a échoué et que le <content-link target="{BD96A90F-5261-4D4D-836C-146032461C8D}" type="glossary">numéro d’ordre</content-link> a été recyclé pour une autre session de communication. D’autres protocoles tentent de passer la transmission en double au protocole de couche supérieure approprié afin que la transmission soit traitée et éventuellement rejetée.</p> <p>Heureusement, les commutateurs sont capables de détecter les boucles dans un réseau. Le protocole STP (Spanning Tree Protocol) élimine ces problèmes de boucle. Nous étudierons le protocole STP dans la section suivante.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305010300">
<title><content-text>Problèmes de redondance réels</content-text></title>
<page type="OneColumn" id="tl1305010301">
<content-media type="InteractiveGraphicRollovers" id="cm8338690347">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010300/tl1305010301/cm8338690347.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010300/tl1305010301/cm8338690347text.xml"/></content-media>
<content-text><p><b>Boucles dans le local technique</b></p> <p>La redondance est une composante importante de la topologie d’un réseau hiérarchique à disponibilité élevée, mais des boucles peuvent se former en raison des nombreux chemins configurés sur le réseau. Vous pouvez utiliser le protocole STP (Spanning Tree Protocol) pour éviter la création de boucles. Cependant, si le protocole STP n’a pas été mis en oeuvre pour préparer une topologie redondante, des boucles peuvent se former à votre insu.</p> <p>Dans les petites et moyennes entreprises, la configuration du câblage du réseau se révèle souvent difficile. Les câbles d’interconnexion du réseau entre les commutateurs de la couche d’accès, situés dans des locaux techniques, disparaissent dans les murs, les sols et les plafonds, où ils sont raccordés aux commutateurs de la couche de distribution du réseau. Si les câbles réseau ne sont pas correctement étiquetés aux points de terminaison dans le <content-link target="{91B034DD-46D3-4FE4-B97B-8A1215971BF9}" type="glossary">panneau de brassage</content-link> du local technique, il est difficile de savoir où se situe la destination du port du panneau de brassage sur le réseau. Les boucles réseau résultant de connexions dupliquées accidentelles dans les locaux techniques sont monnaie courante.</p> <p><b>Cliquez sur le bouton Boucle résultant de deux connexions au même commutateur dans la figure.</b></p> <p>L’exemple illustre une boucle qui se forme si deux connexions à partir du même commutateur sont raccordées à un autre commutateur. La boucle est située au niveau des commutateurs interconnectés. Cependant, la boucle a des répercussions sur l’ensemble du réseau en raison des nombreuses transmissions de trames de diffusion qui parviennent à tous les autres commutateurs du réseau. Même si l’incidence sur les autres commutateurs n’est pas suffisante pour perturber les communications normales, la boucle pourra entraîner une dégradation significative des performances générales des autres commutateurs.</p> <p>Ce type de boucle est fréquent dans le local technique. La boucle est créée lorsqu’un administrateur connecte par erreur un câble à un commutateur auquel il est déjà connecté. Cette situation se produit généralement lorsque les câbles réseau ne sont pas correctement étiquetés ou lorsque l’administrateur n’a pas pris le temps de vérifier où les câbles sont connectés.</p> <p>Il existe cependant une exception à ce problème. Un EtherChannel est un groupement de ports Ethernet sur un commutateur qui joue le rôle de connexion réseau logique unique. Étant donné que le commutateur traite les ports configurés pour l’EtherChannel comme une liaison réseau unique, les boucles ne sont pas possibles. La configuration des EtherChannels n’est pas au programme de ce cours. Si vous souhaitez en savoir plus sur la technologie EtherChannel, consultez : <content-link target="http://www.cisco.com/en/US/tech/tk389/tk213/technologies_white_paper09186a0080092944.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk213/technologies_white_paper09186a0080092944.shtml (en anglais).</content-link></p> <p><b>Cliquez sur le bouton Boucle résultant d’une connexion à un second commutateur sur le même réseau dans la figure.</b></p> <p>L’exemple illustre une boucle qui se forme si un commutateur est connecté à deux autres commutateurs qui sont également interconnectés sur le réseau. Les conséquences de ce type de boucle sont beaucoup plus graves, car la boucle affecte directement un plus grand nombre de commutateurs. </p></content-text>
</page>
<page type="OneColumn" id="tl1305010302">
<content-media type="InteractiveGraphicRollovers" id="cm3558548482">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010300/tl1305010302/cm3558548482.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305010000/tl1305010300/tl1305010302/cm3558548482text.xml"/></content-media>
<content-text><p><b>Boucles dans les bureaux cloisonnés</b></p> <p>En raison des connexions de données insuffisantes, certains utilisateurs finaux disposent d’un commutateur ou d’un concentrateur personnel situé dans leur environnement de travail. Au lieu d’imputer les coûts de l’exécution des connexions de données réseau à l’espace de travail, un simple concentrateur ou commutateur est raccordé à une connexion de données réseau existante pour que tous les périphériques connectés au commutateur ou au concentrateur personnel puissent accéder au réseau.</p> <p>Les locaux techniques sont généralement protégés pour empêcher tout accès non autorisé. Par conséquent, l’administrateur réseau est bien souvent la seule personne qui contrôle totalement la manière dont les périphériques sont connectés au réseau et le choix de ces périphériques. En revanche, l’administrateur ne gère pas la méthode d’utilisation ou de connexion des commutateurs et concentrateurs personnels. L’utilisateur final peut donc interconnecter accidentellement les commutateurs ou concentrateurs.</p> <p><b>Cliquez sur le bouton Boucle résultant de deux concentrateurs interconnectés dans la figure.</b></p> <p>Dans l’exemple, les deux concentrateurs des utilisateurs sont interconnectés, ce qui génère une boucle sur le réseau. La boucle perturbe les communications entre tous les périphériques connectés au commutateur S1.</p></content-text>
</page>
<page type="OneColumn" id="tl1305010303">
<content-media type="ActivityPKA" id="cm8108696416">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305010000/tl1305010300/tl1305010303/cm8108696416/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305010000/tl1305010300/tl1305010303/cm8108696416/icontext.xml"/></content-media>
<content-text><p>Dans cet exercice, vous étudierez le mode de fonctionnement par défaut du protocole STP. Des commutateurs « prêts à l’emploi » ont été ajoutés directement au réseau. Le branchement et le raccordement des commutateurs Cisco à un réseau ne nécessitent aucune intervention de la part de l’administrateur réseau. Par conséquent, ces commutateurs ne sont pas encore configurés.</p> <p>Des instructions détaillées sont fournies dans l’exercice même, ainsi que dans le lien PDF ci-dessous.</p> <p><content-link target="E3_PTAct_5_1_3.pdf" type="internalfile">Instructions pour l’exercice (PDF)</content-link></p> <p><b>Cliquez sur l’icône Packet Tracer pour plus de détails.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305020000">
<title><content-text>Présentation du protocole STP</content-text></title>
<topic type="" id="tl1305020100">
<title><content-text>Algorithme Spanning Tree</content-text></title>
<page type="OneColumn" id="tl1305020101">
<content-media type="AnimationPartialScreen" id="cm7357858340">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020101/cm7357858340.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020101/cm7357858340text.xml"/></content-media>
<content-text><p><b>Topologie STP</b></p> <p>La redondance améliore la disponibilité de la topologie du réseau en supprimant le risque de points de défaillance uniques dans un réseau ; par exemple, une panne d’un commutateur ou d’un câble du réseau. Lorsqu’une architecture redondante est introduite dans une conception de couche 2, des boucles et des trames en double peuvent apparaître, et les conséquences peuvent être dramatiques pour le réseau. Le protocole STP (Spanning Tree Protocol) a été conçu afin de résoudre ces problèmes.</p> <p>Le protocole STP garantit l’unicité du chemin logique entre toutes les destinations sur le réseau en procédant intentionnellement au <content-link target="{48DC2295-740D-4C48-80A2-A77009A412F9}" type="glossary">blocage</content-link> des chemins redondants susceptibles d’entraîner la formation d’une boucle. Un port est considéré comme bloqué lorsqu’aucune donnée ne peut être envoyée ou reçue sur ce port, à l’exception des trames <content-link target="{7325E922-35C1-4E53-BD8F-EE5B1AD2B92B}" type="glossary">BPDU</content-link> (bridge protocol data unit) qui sont employées par le protocole STP pour empêcher la formation de boucles. Nous aborderons les trames BPDU STP ultérieurement dans le chapitre. Le blocage des chemins redondants est essentiel pour empêcher la formation de boucles sur le réseau. Les chemins physiques sont préservés pour assurer la redondance, mais ils sont désactivés afin d’empêcher la création de boucles. Si le chemin est amené à être utilisé en cas de panne d’un commutateur ou d’un câble réseau, l’algorithme Spanning Tree (STA) recalcule les chemins et débloque les ports nécessaires pour permettre la réactivation du chemin redondant.</p> <p><b>Cliquez sur Lire dans la figure pour lancer l’animation.</b></p> <p>Dans l’exemple, le protocole STP est activé sur tous les commutateurs :</p> <p>1. PC1 envoie une trame de diffusion sur le réseau. </p> <p>2. Le commutateur S3 est configuré avec le protocole STP et a placé le port de Agrégation2 en état de blocage. Cet état de blocage empêche l’utilisation des ports pour acheminer le trafic du commutateur, ce qui évite la formation d’une boucle. Le commutateur S2 transmet une trame de diffusion à tous les ports des commutateurs, à l’exception de celui d’où provient la trame et du port sur Agrégation2, lequel conduit au port bloqué sur S3. </p> <p>3. Le commutateur S1 reçoit la trame de diffusion et la transmet par tous ses ports à destination de PC4 et de S3. S3 n’achemine pas la trame vers S2 sur Agrégation2 en raison du port bloqué. La boucle de couche 2 est évitée.</p> <p><b>Cliquez sur le bouton Le protocole STP compense les pannes réseau dans la figure et cliquez sur Lire pour lancer l’animation.</b></p> <p>Dans cet exemple :</p> <p>1. PC1 envoie une trame de diffusion sur le réseau. </p> <p>2. La diffusion est transmise sur le réseau, exactement comme dans l’animation précédente. </p> <p>3. La liaison agrégée entre le commutateur S2 et le commutateur S1 est coupée, ce qui entraîne l’interruption du chemin précédent. </p> <p>4. Le commutateur S3 débloque le port préalablement bloqué pour Agrégation2 et autorise le trafic de diffusion à emprunter le chemin de substitution sur le réseau afin d’assurer la continuité des communications. Si cette liaison est rétablie, l’algorithme STP reconverge et le port sur S3 est de nouveau bloqué.</p> <p>STP empêche la formation de boucles en configurant un chemin sans boucle sur le réseau à l’aide de ports en état de blocage placés de façon stratégique. Les commutateurs qui exécutent le protocole STP sont capables d’assurer la continuité des communications en cas de panne en débloquant dynamiquement les ports préalablement bloqués et en autorisant le trafic à emprunter les chemins de substitution. La rubrique suivante explique de quelle manière le protocole STP accomplit automatiquement ce processus.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020102">
<content-media type="StaticGraphic" id="cm2890436022">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020102/cm2890436022.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020102/cm2890436022text.xml"/></content-media>
<content-text><p><b>Algorithme STP</b></p> <p>Le protocole STP utilise l’algorithme Spanning Tree (<content-link target="{2E20BEC9-C39A-4E09-BEAD-E5B244449406}" type="glossary">STA</content-link>) pour déterminer quels ports de commutateurs doivent être configurés en état de blocage afin d’empêcher la formation de boucles sur un réseau. L’algorithme STA désigne un commutateur unique comme <content-link target="{9A230324-DAFA-4F0F-8FF8-4AD66C9055EC}" type="glossary">pont racine</content-link> et il l’utilise comme point de référence pour le calcul de tous les chemins. Dans la figure, le pont racine (commutateur S1) est choisi par le biais d’un processus de sélection. Tous les commutateurs associés au protocole STP échangent des trames BPDU pour identifier le commutateur doté de l’identificateur de pont (BID) le plus faible sur le réseau. Le commutateur doté de l’identificateur (ID) le plus faible devient automatiquement le pont racine pour les calculs de l’algorithme STA. Le processus de sélection du pont racine est traité de manière approfondie ci-après.</p> <p>L’unité BPDU est la trame de message échangée par les commutateurs pour le protocole STP. Chaque trame BPDU contient un identificateur de pont qui identifie le commutateur ayant envoyé la trame BPDU. L’identificateur de pont contient une valeur de priorité, l’adresse MAC du commutateur émetteur et un ID système étendu facultatif. La valeur d’identificateur de pont la plus faible est déterminée par la combinaison de ces trois champs. Nous aborderons plus en détail le pont racine, les trames BPDU et l’identificateur de pont dans d’autres rubriques.</p> <p>Une fois que le pont racine a été déterminé, l’algorithme STA calcule le chemin le plus court vers le pont racine. Chaque commutateur utilise l’algorithme STA pour identifier les ports devant être bloqués. Pendant que l’algorithme STA détermine les meilleurs chemins vers le pont racine pour toutes les destinations du domaine de diffusion, aucune donnée ne peut être transmise sur le réseau. L’algorithme STA prend en compte les coûts de chemin et de port lors de la sélection du chemin qui ne doit pas être bloqué. Le <content-link target="{645B6073-78F7-4A3D-A408-7013391FAFF8}" type="glossary">coût de la route</content-link> est calculé à l’aide des valeurs de coût de port associées à la vitesse de port de chacun des ports des commutateurs sur un chemin donné. La somme des valeurs des coûts de ports détermine le coût du chemin global vers le pont racine. Si plusieurs chemins sont disponibles, l’algorithme STA choisit le chemin doté du coût de chemin le plus faible. Nous aborderons les coûts de chemin et de port dans d’autres rubriques.</p> <p>Lorsque l’algorithme STA a déterminé les chemins qui doivent rester disponibles, il configure les ports des commutateurs dans des rôles de ports indépendants. Les rôles des ports décrivent le lien entre les ports et le pont racine du réseau et spécifient s’ils sont autorisés à acheminer le trafic. </p> <p><b>Ports racine</b> : il s’agit des ports de commutateur les plus proches du pont racine. Dans l’exemple, le port racine du commutateur S2 est F0/1, configuré pour la liaison agrégée entre le commutateur S2 et le commutateur S1. Le port racine du commutateur S3 est F0/1, configuré pour la liaison agrégée entre le commutateur S3 et le commutateur S1.</p> <p><b>Ports désignés</b> : il s’agit de tous les ports non racine qui sont autorisés à acheminer le trafic sur le réseau. Dans l’exemple, les ports F0/1 et F0/2 du commutateur S1 sont les ports désignés. Le port F0/2 du commutateur S2 est également configuré comme port désigné.</p> <p><b>Ports non désignés</b> : il s’agit de tous les ports configurés dans un état de blocage pour empêcher la formation de boucles. Dans l’exemple, l’algorithme STA a configuré le port F0/2 sur le commutateur S3 dans le rôle de port non désigné. Le port F0/2 du commutateur S3 est dans un état de blocage.</p> <p>Nous aborderons les rôles et les états des ports dans d’autres rubriques.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020103">
<content-media type="StaticGraphic" id="cm2709716635">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020103/cm2709716635.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020103/cm2709716635text.xml"/></content-media>
<content-text><p><b>Pont racine</b></p> <p>Chaque instance de l’arbre recouvrant (= instance « spanning-tree ») (domaine de diffusion ou réseau local commuté) possède un commutateur désigné comme pont racine. Ce pont racine sert de point de référence pour tous les calculs de l’algorithme STA afin de déterminer les chemins redondants devant être bloqués.</p> <p>Un processus de sélection détermine le commutateur qui devient le pont racine. </p> <p><b>Cliquez sur le bouton Champs d’identificateur de pont dans la figure.</b></p> <p>La figure affiche les champs de l’identificateur de pont (BID). Les détails de chaque champ BID seront abordés ultérieurement. Cependant, il est bon de savoir dès à présent que l’identificateur de pont est constitué d’une valeur de priorité, d’un ID système étendu et de l’adresse MAC du commutateur.</p> <p>Tous les commutateurs du domaine de diffusion participent au processus d’élection. Après l’initialisation d’un commutateur, ce dernier envoie des trames BPDU contenant l’ID de pont du commutateur et l’ID de racine toutes les deux secondes. Par défaut, l’ID de racine correspond à l’ID de pont local de tous les commutateurs du réseau. L’ID de racine identifie le pont racine du réseau. Au départ, chaque commutateur s’identifie comme étant le pont racine après son initialisation.</p> <p>Au fur et à mesure que les commutateurs transmettent leurs trames BPDU, les commutateurs voisins dans le domaine de diffusion lisent les informations d’ID de racine à partir de la trame BPDU. Si l’ID de racine de la trame BPDU reçue est inférieur à l’ID de racine sur le commutateur où elle est reçue, ce dernier met à jour son ID de racine identifiant le commutateur adjacent comme pont racine. Remarque : le pont racine n’est pas nécessairement un commutateur adjacent. Il peut s’agir de tout autre commutateur du domaine de diffusion. Le commutateur transmet ensuite les nouvelles trames BPDU dotées de l’ID de racine plus faible aux autres commutateurs adjacents. Finalement, le commutateur doté de l’ID de pont le plus faible est alors identifié comme pont racine pour l’instance de l’arbre recouvrant. </p></content-text>
</page>
<page type="OneColumn" id="tl1305020104">
<content-media type="InteractiveGraphicRollovers" id="cm9062133227">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020100/tl1305020104/cm9062133227.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020100/tl1305020104/cm9062133227text.xml"/></content-media>
<content-text><p><b>Meilleurs chemins vers le pont racine</b></p> <p>Lorsque le pont racine a été désigné pour l’instance Spanning Tree, l’algorithme STA entame le processus de détermination des meilleurs chemins vers le pont racine à partir de toutes les destinations du domaine de diffusion. Les informations de chemin sont déterminées par la somme des différents coûts de ports sur le chemin de la destination vers le pont racine.</p> <p>Les coûts du port par défaut sont définis par la vitesse de fonctionnement du port. Dans le tableau, vous pouvez voir que les ports Ethernet à 10 Gbits/s présentent un coût de port de 2, les ports Ethernet à 1 Gbit/s présentent un coût de 4, les ports Fast Ethernet à 100 Mbits/s présentent un coût de 19, et les ports Ethernet à 10 Mbits/s présentent un coût de 100. </p> <p><b>Remarque :</b> la norme IEEE définit les valeurs de coût de port utilisées par le protocole STP. Avec l’apparition des technologies Ethernet de plus en plus rapides, les valeurs de coûts de chemins peuvent évoluer pour gérer les différentes vitesses disponibles. Les chiffres non linéaires permettent de gérer certaines améliorations de la norme Ethernet, mais sachez que les chiffres peuvent être modifiés par la norme IEEE si besoin est. Dans le tableau, les valeurs ont déjà été modifiées pour prendre en compte la nouvelle norme Ethernet de 10 Gbits/s.</p> <p>Bien qu’un coût de port par défaut soit associé aux ports des commutateurs, il est possible de configurer le coût des ports. Cette possibilité de configuration des coûts des différents ports permet à l’administrateur de déterminer les chemins de l’arbre recouvrant vers le pont racine.</p> <p><b>Cliquez sur le bouton Configuration des coûts des ports dans la figure.</b></p> <p>Pour configurer le coût des ports d’une interface, entrez la commande <span class="cmd"><b>spanning-tree cost </b><i>value</i></span> en mode de configuration d’interface. La <span class="cmd">valeur</span> de <i>plage</i> peut être comprise entre 1 et 200 000 000.</p> <p>Dans l’exemple, le port F0/1 a été configuré avec un coût de port de 25 à l’aide de la commande de configuration d’interface <span class="cmd"><b>spanning-tree cost 25</b></span> sur l’interface F0/1.</p> <p>Pour rétablir la valeur par défaut du coût du port, entrez la commande de configuration d’interface <span class="cmd"><b>no spanning-tree cost</b></span>.</p> <p><b>Cliquez sur le bouton Coûts des chemins dans la figure.</b></p> <p>Le coût du chemin est la somme de tous les coûts des ports sur le chemin vers le pont racine. Les chemins dotés du coût le plus faible deviennent le chemin optimal et tous les autres chemins redondants sont bloqués. Dans l’exemple, le coût de chemin du commutateur S2 vers le commutateur pont racine S1 sur le chemin 1 est 19 (d’après le coût de port spécifié par la norme IEEE), alors que le coût de chemin sur le chemin 2 est 38. Étant donné que le chemin 1 présente un coût de chemin global plus faible vers le pont racine, il s’agit du meilleur chemin. Le protocole STP configure alors le chemin redondant à bloquer pour empêcher la formation d’une boucle.</p> <p><b>Cliquez sur le bouton Vérification des coûts des chemins et des ports dans la figure.</b></p> <p>Pour vérifier le coût des chemins et des ports vers le pont racine, entrez la commande <span class="cmd"><b>show spanning-tree</b></span> en mode d’exécution privilégié. Le champ Cost dans la sortie est le coût de chemin total vers le pont racine. Cette valeur change en fonction du nombre de ports de commutateurs devant être traversés pour atteindre le pont racine. Dans la sortie, chaque interface est également identifiée avec un coût de port individuel de 19. </p> <p>Il existe une autre commande disponible : la commande <span class="cmd"><b>show spanning-tree detail</b></span> en mode d’exécution privilégié.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020200">
<title><content-text>BPDU du protocole STP</content-text></title>
<page type="OneColumn" id="tl1305020201">
<content-media type="InteractiveGraphicRollovers" id="cm1061344390">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020200/tl1305020201/cm1061344390.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020200/tl1305020201/cm1061344390text.xml"/></content-media>
<content-text><p><b>Champs BPDU</b></p> <p>Dans la rubrique précédente, vous avez appris que le protocole STP détermine un pont racine pour l’instance de l’arbre recouvrant en échangeant des trames BPDU. Dans cette rubrique, nous étudierons de manière détaillée la trame BPDU et son utilité pour le processus d’arbre recouvrant.</p> <p>La trame BPDU contient 12 champs distincts permettant de transmettre les paramètres de priorité et de chemin que le protocole STP utilise pour déterminer le pont racine et les chemins vers ce pont racine.</p> <p><b>Placez le pointeur sur les différents champs BPDU dans la figure pour découvrir leur contenu.</b></p> <p><ul><li> Les quatre premiers champs identifient le protocole, la version, le type de message et les indicateurs d’état.</li><li>Les quatre champs suivants permettent d’identifier le pont racine et le coût du chemin vers le pont racine.</li><li> Les quatre derniers champs correspondent à tous les champs de minuteurs qui déterminent la fréquence d’envoi des messages BPDU et la durée de conservation des informations reçues par le biais du processus des trames BPDU (rubrique suivante). Le rôle de chaque champ sera traité de manière plus approfondie ultérieurement dans ce cours.</li></ul></p> <p><b>Cliquez sur le bouton Exemple de BPDU dans la figure.</b></p> <p>L’exemple de la figure a été capturé à l’aide de Wireshark. Dans la trame BPDU illustrée dans cet exemple, les champs sont plus nombreux que dans notre description précédente. Le message BPDU est encapsulé dans une trame Ethernet lorsqu’il est transmis sur le réseau. L’en-tête 802.3 indique les adresses source et de destination de la trame BPDU. Cette trame possède une adresse MAC de destination de 01:80:C2:00:00:00, qui est une adresse de multidiffusion pour le groupe Spanning Tree. Lorsqu’une trame est adressée avec cette adresse MAC, tous les commutateurs configurés pour STP acceptent les informations de la trame et les lisent. Avec cette adresse de groupe de multidiffusion, tous les autres périphériques du réseau qui reçoivent cette trame l’ignorent.</p> <p>Dans l’exemple, l’ID de racine et l’ID de pont (BID) sont identiques dans la trame BPDU capturée, ce qui indique que la trame a été capturée à partir d’un commutateur pont racine. </p> <p>Tous les minuteurs sont configurés avec des valeurs par défaut.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020202">
<content-media type="AnimationPartialScreen" id="cm7714824057">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020200/tl1305020202/cm7714824057.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020200/tl1305020202/cm7714824057text.xml"/></content-media>
<content-text><p><b>Processus des trames BPDU</b></p> <p>Chaque commutateur du domaine de diffusion se considère initialement comme le pont racine de l’instance de l’arbre recouvrant. Par conséquent, les trames BPDU envoyées contiennent l’ID de pont du commutateur local comme ID de racine. Par défaut, les trames BPDU sont envoyées toutes les deux secondes après l’initialisation d’un commutateur ; c’est-à-dire que la valeur par défaut d’intervalle entre chaque envoi de trames (hello time) spécifiée dans la trame BPDU correspond à 2 secondes. Chaque commutateur met à jour les informations locales concernant son ID de pont, l’ID de racine et le coût du chemin vers la racine.</p> <p>Lorsque des commutateurs adjacents reçoivent une trame BPDU, ils comparent l’ID de racine de la trame BPDU à leur ID de racine local. Si l’ID de racine de la trame BPDU est plus faible que l’ID de racine local, le commutateur met à jour l’ID de racine local et l’ID dans ses messages BPDU. Ces messages ont pour rôle d’indiquer le nouveau pont racine du réseau. Qui plus est, le coût du chemin est mis à jour pour indiquer à quelle distance se trouve le pont racine. Par exemple, si la trame BPDU a été reçue sur un port de commutateur Fast Ethernet, le coût du chemin est défini à 19. Si l’ID de racine local est inférieur à l’ID de racine reçu dans la trame BPDU, la trame BPDU est rejetée.</p> <p>Une fois qu’un ID de racine a été mis à jour pour identifier un nouveau pont racine, toutes les trames BPDU suivantes envoyées à partir de ce commutateur contiennent le nouvel ID de racine et le coût de chemin mis à jour. Ainsi, tous les autres commutateurs adjacents peuvent systématiquement voir l’ID de racine le plus faible identifié. Au fur et à mesure que les trames BPDU circulent entre d’autres commutateurs adjacents, le coût du chemin est continuellement mis à jour pour indiquer le coût du chemin total vers le pont racine. Chaque commutateur inclus dans l’arbre recouvrant utilise ses coûts de chemins pour identifier le meilleur chemin possible vers le pont racine.</p> <p><b>Cliquez sur chaque étape dans la figure pour découvrir le processus des trames BPDU.</b></p> <p>Le déroulement du processus des trames BPDU est résumé ci-dessous :</p> <p>Remarque : la priorité est le critère initial sur lequel repose le choix d’un pont racine. Si tous les commutateurs présentaient la même priorité, l’adresse MAC constituerait alors le facteur déterminant.</p> <p><b>Étape 1. </b>Au départ, chaque commutateur s’identifie comme étant le pont racine. Le commutateur 2 transmet les trames BPDU sur tous ses ports de commutateur. </p> <p><b>Étape 2. </b>Lorsque le commutateur S3 reçoit une trame BPDU du commutateur S2, il compare son ID de racine à celui de la trame BPDU qu’il a reçue. Les priorités étant identiques, le commutateur doit examiner la partie correspondant à l’adresse MAC pour savoir quelle adresse MAC présente la valeur la plus faible. Étant donné que S2 possède la valeur d’adresse MAC la plus faible, S3 met à jour son ID de racine avec celui de S2. À ce stade, S3 considère S2 comme le pont racine. </p> <p><b>Étape 3. </b> Lorsque S1 compare son ID de racine à celui figurant dans la trame BPDU reçue, il identifie l’ID de racine local comme étant la valeur la plus faible et rejette la trame BPDU de S2.</p> <p><b>Étape 4. </b>Lorsque S3 envoie ses trames BPDU, l’ID de racine contenu dans la trame BPDU est celui de S2. </p> <p><b>Étape 5. </b> Lorsque le commutateur S2 reçoit la trame BPDU, il la rejette après avoir vérifié que l’ID de racine contenu dans la trame BPDU correspond à son ID de racine local.</p> <p><b>Étape 6. </b> Étant donné que le commutateur S1 présente une priorité plus faible dans son ID de racine, il rejette la trame BPDU reçue du commutateur S3.</p> <p><b>Étape 7. </b> Le commutateur S1 envoie ses trames BPDU.</p> <p><b>Étape 8. </b> Le commutateur S3 identifie l’ID de racine dans la trame BPDU comme présentant une valeur plus faible ; par conséquent, il met à jour ses valeurs d’ID de racine pour indiquer que le commutateur S1 est désormais le pont racine.</p> <p><b>Étape 9. </b> Le commutateur S2 identifie l’ID de racine dans la trame BPDU comme présentant une valeur plus faible ; par conséquent, il met à jour ses valeurs d’ID de racine pour indiquer que le commutateur S1 est désormais le pont racine.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020300">
<title><content-text>ID de pont</content-text></title>
<page type="OneColumn" id="tl1305020301">
<content-media type="InteractiveGraphicRollovers" id="cm7118167866">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020300/tl1305020301/cm7118167866.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020300/tl1305020301/cm7118167866text.xml"/></content-media>
<content-text><p><b>Champs d’identificateur de pont</b></p> <p>L’ID de pont (BID) permet de déterminer le pont racine d’un réseau. Cette rubrique décrit les composantes d’un ID de pont et explique comment configurer l’ID de pont sur un commutateur pour influer sur le processus de sélection afin de garantir que le rôle de pont racine est affecté à des commutateurs spécifiques du réseau.</p> <p>Le champ BID d’une trame BPDU contient trois champs distincts : la priorité du pont, l’ID système étendu et l’adresse MAC. Chaque champ est utilisé lors du processus de sélection du pont racine.</p> <p><b>Priorité du pont</b></p> <p>La priorité du pont est une valeur personnalisable que vous pouvez modifier pour choisir le commutateur qui sera le pont racine. Le commutateur qui possède la priorité la plus faible, c’est-à-dire l’ID de pont le plus faible, devient le pont racine (plus la valeur de priorité est faible, plus la priorité est élevée). Par exemple, pour faire en sorte qu’un commutateur soit systématiquement le pont racine, vous devez lui affecter une valeur de priorité plus faible que celle de tous les autres commutateurs du réseau. La valeur de priorité par défaut de tous les commutateurs Cisco est 32 768. La plage des valeurs de priorité est comprise entre 1 et 65 536 ; par conséquent, 1 correspond à la priorité la plus élevée.</p> <p><b>ID système étendu</b></p> <p>Comme l’illustre l’exemple, l’ID système étendu peut être omis dans les trames BPDU dans certaines configurations. La mise en oeuvre initiale du protocole STP était destinée aux réseaux qui n’utilisaient pas la technologie des réseaux locaux virtuels (VLAN). Il existait un seul arbre recouvrant commun sur tous les commutateurs. Lorsque les réseaux locaux virtuels ont commencé à se généraliser pour la segmentation des infrastructures réseau, le protocole STP a été optimisé pour assurer la prise en charge de ces réseaux. Par conséquent, le champ d’ID système étendu contient l’ID du VLAN auquel la trame BPDU est associée. </p> <p>Lorsque l’ID système étendu est employé, il modifie le nombre de bits disponibles pour la valeur de priorité de pont, et l’incrément pour la valeur de priorité de pont passe donc de 1 à 4 096. Par conséquent, les valeurs de priorité de pont doivent être des multiples de 4 096.</p> <p>La valeur d’ID système étendu est ajoutée à la valeur de priorité de pont dans le champ BID pour identifier la priorité et le VLAN de la trame BPDU.</p> <p>Nous étudierons le protocole PVST (Per VLAN Spanning Tree) dans une autre section de ce chapitre.</p> <p><b>Adresse MAC</b></p> <p>Lorsque deux commutateurs sont configurés avec la même priorité et possèdent le même ID système étendu, le commutateur dont l’adresse MAC présente la valeur hexadécimale la plus faible possède le BID le plus faible. Au départ, tous les commutateurs sont configurés avec la même valeur de priorité par défaut. L’adresse MAC est alors le critère qui détermine le choix du commutateur devant faire office de pont racine. Ceci aboutit à un choix imprévisible pour le pont racine. Il est recommandé de configurer le commutateur pont racine souhaité en lui attribuant une priorité plus faible pour garantir son choix comme pont racine. Cette procédure garantit également que l’ajout de nouveaux commutateurs sur le réseau ne déclenchera pas de nouvelle sélection par l’algorithme STA, susceptible de perturber les communications réseau pendant la sélection d’un nouveau pont racine.</p> <p><b>Cliquez sur le bouton Décision reposant sur la priorité dans la figure.</b></p> <p>Dans l’exemple, le commutateur S1 possède une priorité plus faible que les autres commutateurs ; par conséquent, il est privilégié comme pont racine pour cette instance d’arbre recouvrant.</p> <p><b>Cliquez sur le bouton Décision reposant sur l’adresse MAC dans la figure.</b></p>  <p>Lorsque tous les commutateurs sont configurés avec la même priorité (comme c’est le cas avec tous les commutateurs laissés dans la configuration par défaut avec une priorité de 32 768), l’adresse MAC devient le facteur déterminant pour le choix du commutateur désigné comme pont racine.</p> <p><b>Remarque :</b> dans l’exemple, la priorité de tous les commutateurs est 32 769. La valeur repose sur la priorité par défaut 32 768 et l’attribution VLAN 1 associée à chaque commutateur (1+32 768).</p> <p>L’adresse MAC dont la valeur hexadécimale est la plus faible sera celle choisie pour la désignation du pont racine. Dans l’exemple, le commutateur S2 est celui qui possède la valeur d’adresse MAC la plus faible ; il est donc désigné comme pont racine pour cette instance d’arbre recouvrant.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020302">
<content-media type="InteractiveGraphicRollovers" id="cm9895864332">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020300/tl1305020302/cm9895864332.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020300/tl1305020302/cm9895864332text.xml"/></content-media>
<content-text><p><b>Configuration et vérification du BID</b></p> <p>Lorsqu’un commutateur spécifique est amené à jouer le rôle de pont racine, la valeur de priorité de pont doit être modifiée pour garantir qu’elle soit plus faible que celle de tous les autres commutateurs du réseau. Deux méthodes de configuration sont disponibles pour configurer la valeur de priorité de pont d’un commutateur Cisco Catalyst.</p> <p><b>Méthode 1</b>. Pour être certain que le commutateur possède la valeur de priorité de pont la plus faible, utilisez la commande <span class="cmd"><b>spanning-tree vlan </b><i>id de vlan</i><b> root primary</b></span> en mode de configuration globale. La priorité du commutateur est définie à la valeur prédéfinie de 24 576 ou à la valeur de décrément 4 096 suivante en dessous de la priorité de pont la plus faible détectée sur le réseau.</p> <p>Si un pont racine alternatif est souhaité, utilisez la commande <span class="cmd"><b>spanning-tree vlan </b><i>id de vlan</i><b> root secondary</b></span> en mode de configuration globale. Cette commande attribue la valeur prédéfinie 28 672 à la priorité du commutateur. Ainsi, vous êtes certain que ce commutateur devient le pont racine en cas de panne du pont racine principal et d’élection d’un nouveau pont, à condition que la valeur de priorité par défaut 32 768 soit définie pour les autres commutateurs du réseau.</p> <p>Dans l’exemple, le commutateur S1 a été affecté comme pont racine principal à l’aide de la commande <span class="cmd"><b>spanning-tree vlan 1 root primary</b></span> en mode de configuration globale, et le commutateur S2 a été configuré comme pont racine secondaire à l’aide de la commande <span class="cmd"><b>spanning-tree vlan 1 root secondary</b></span> en mode de configuration globale.</p> <p><b>Méthode 2</b>. Cette méthode de configuration de la valeur de priorité du pont consiste à utiliser la commande <span class="cmd"><b>spanning-tree vlan </b><i>id de vlan</i><b> priority </b><i>value</i></span> en mode de configuration globale. Cette commande vous permet de contrôler plus précisément la valeur de priorité du pont. La valeur de priorité est configurée par incréments de 4 096, compris entre 0 et 65 536. </p> <p>Dans l’exemple, une valeur de priorité de pont de 24 576 a été attribuée au commutateur S3 à l’aide de la commande <span class="cmd"><b>spanning-tree vlan 1 priority 24576</b></span> en mode de configuration globale.</p> <p><b>Cliquez sur le bouton Vérification dans la figure.</b></p> <p>Pour vérifier la priorité de pont d’un commutateur, utilisez la commande « show spanning-tree » en mode d’exécution privilégié. Dans l’exemple, la priorité du commutateur a été définie à 24 576. Notez également que le commutateur est désigné comme pont racine pour l’instance de l’arbre recouvrant.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020400">
<title><content-text>Rôles des ports</content-text></title>
<page type="OneColumn" id="tl1305020401">
<content-media type="StaticGraphic" id="cm4461076129">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020401/cm4461076129.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020401/cm4461076129text.xml"/></content-media>
<content-text><p><b>Rôles des ports </b></p> <p>Le pont racine est désigné pour l’instance de l’arbre recouvrant. L’emplacement du pont racine dans la topologie du réseau détermine la manière dont sont calculés les rôles des ports. Cette rubrique décrit comment les ports des commutateurs sont configurés pour des rôles spécifiques afin d’empêcher la formation de boucles sur le réseau.</p> <p>Il existe quatre rôles distincts pour lesquels les ports des commutateurs sont automatiquement configurés durant le processus d’arbre recouvrant.</p> <p><b>Port racine</b></p> <p>Le port racine existe sur les ponts non racine ; il s’agit du port de commutateur offrant le meilleur chemin vers le pont racine. Les ports racine acheminent le trafic vers le pont racine. Les adresses MAC sources des trames reçues sur le port racine sont capables d’enrichir la table d’adresses MAC. Un seul port racine est autorisé par pont.</p> <p>Dans l’exemple, le commutateur S1 est le pont racine, et les commutateurs S2 et S3 ont un port racine défini sur les liaisons agrégées en retour vers S1.</p> <p><b>Port désigné</b></p> <p>Le port désigné existe sur les ponts racine et non racine. Pour les ponts racine, tous les ports de commutateur sont des ports désignés. Pour les ponts non racine, un port désigné est le port de commutateur qui reçoit et transmet les trames vers le pont racine en fonction des besoins. Un seul port désigné est autorisé par segment. Si plusieurs commutateurs sont présents sur le même segment, un processus d’élection détermine le commutateur désigné, et le port de commutateur correspondant commence à transmettre les trames du segment. Les ports désignés sont capables d’enrichir la table d’adresses MAC.</p> <p>Dans l’exemple, les deux jeux de ports des deux liaisons agrégées du commutateur S1 sont configurés comme ports désignés. Le commutateur S2 possède également un port désigné configuré sur la liaison agrégée vers le commutateur S3.</p> <p><b>Port non désigné</b></p> <p>Le port non désigné est un port de commutateur qui est bloqué. Par conséquent, il ne transmet pas les trames de données et n’enrichit pas la table d’adresses MAC avec les adresses sources. Un port non désigné n’est ni un port racine, ni un port désigné. Pour certaines variantes du protocole STP, le port non désigné est appelé « port alternatif ».</p> <p>Dans l’exemple, le commutateur S3 possède le seul port non désigné de la topologie. Les ports non désignés empêchent la formation de boucles.</p> <p><b>Port désactivé</b></p> <p>Le port désactivé est un port de commutateur qui est arrêté sur le plan administratif. Un port désactivé est inopérant dans le processus d’arbre recouvrant. Il n’existe aucun port désactivé dans l’exemple.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020402">
<content-media type="StaticGraphic" id="cm5493627119">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020402/cm5493627119.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020402/cm5493627119text.xml"/></content-media>
<content-text><p><b>Rôles des ports</b></p> <p>L’algorithme Spanning Tree (STA) détermine le rôle de port affecté à chacun des ports d’un commutateur. </p> <p>Lors du choix du port racine sur un commutateur, le commutateur compare les coûts de chemin de tous les ports de commutateur faisant partie de l’arbre recouvrant. Le port de commutateur doté du coût de chemin global le plus faible joue automatiquement le rôle de port racine, car il est le plus proche du pont racine. Dans une topologie réseau, tous les commutateurs qui utilisent une configuration STP, à l’exception du pont racine, ont un seul port racine défini.</p> <p>Lorsque deux ports ont le même coût de chemin vers le pont racine et qu’ils représentent tous deux les coûts de chemin les plus faibles sur le commutateur, le commutateur doit déterminer lequel de ces ports jouera le rôle de port racine. Le commutateur utilise la valeur de priorité de port personnalisable, ou l’ID de port le plus faible si les valeurs de priorité des deux ports sont identiques. </p> <p>L’ID de port est l’ID d’interface du port de commutateur. Par exemple, la figure illustre quatre commutateurs. Les ports F0/1 et F0/2 du commutateur S2 ont la même valeur de coût de chemin en retour vers le pont racine. Cependant, le port F0/1 du commutateur S2 est le port privilégié, car il possède une valeur d’ID de port plus faible. </p> <p>L’ID de port est ajouté à la priorité du port. Par exemple, le port F0/1 possède une valeur de priorité par défaut de 128.1, 128 étant la valeur de priorité de port configurable et .1 étant l’ID de port. Par défaut, le port F0/2 possède une valeur de priorité de 128.2.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020403">
<content-media type="StaticGraphic" id="cm6199882431">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020403/cm6199882431.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020403/cm6199882431text.xml"/></content-media>
<content-text><p><b>Configuration de la priorité des ports</b></p> <p>Vous pouvez configurer la valeur de priorité d’un port à l’aide de la commande <span class="cmd"><b>spanning-tree port-priority </b><i>valeur</i></span> en mode de configuration d’interface. La plage des valeurs de priorité des ports est comprise entre 0 et 240, par incréments de 16. La valeur de priorité de port par défaut est 128. Comme pour la priorité des ponts, plus la valeur de priorité du port est faible, plus la priorité du port est élevée. </p> <p>Dans l’exemple, la priorité du port F0/1 a été définie à 112, et cette valeur est inférieure à la priorité de port par défaut de 128. Ainsi, ce port constituera le port préféré lorsqu’il sera comparé à un autre port pour un rôle de port spécifique.</p> <p>Lorsque le commutateur décide d’utiliser un port plutôt qu’un autre comme port racine, l’autre port est configuré comme port non désigné pour éviter la formation d’une boucle.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020404">
<content-media type="InteractiveGraphicRollovers" id="cm5833104874">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020404/cm5833104874.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020404/cm5833104874text.xml"/></content-media>
<content-text><p><b>Décisions en matière des rôles des ports</b></p> <p>Dans l’exemple, le commutateur S1 est le pont racine. Les commutateurs S2 et S3 ont des ports racine configurés pour les ports qui retransmettent le trafic vers S1.</p> <p>Lorsqu’un commutateur a déterminé lequel de ses ports est configuré dans le rôle de port racine, il doit choisir les ports qui se verront attribuer les rôles désigné et non désigné.</p> <p>Le pont racine configure automatiquement tous ses ports de commutateur dans le rôle désigné. Les autres commutateurs de la topologie configurent leurs ports non racine en tant que ports désignés ou non désignés.</p> <p>Les ports désignés sont configurés pour tous les segments LAN. Lorsque deux commutateurs sont connectés au même segment LAN et que les ports racine ont déjà été définis, les deux commutateurs doivent déterminer le port qui sera configuré comme port désigné et celui qui sera configuré comme port non désigné.</p> <p>Les commutateurs du segment LAN concerné échangent des trames BPDU qui contiennent le BID du commutateur. En règle générale, le port du commutateur doté du BID le plus faible est configuré comme port désigné, alors que le port du commutateur doté du BID le plus élevé est configuré comme port non désigné. Cependant, n’oubliez pas que la première priorité est le coût de chemin le plus faible vers le pont racine ; le BID de l’émetteur utilisé constitue la priorité uniquement lorsque les coûts des ports sont égaux.</p> <p>Par conséquent, chaque commutateur détermine le rôle qui est attribué à chacun de ses ports afin de créer un arbre recouvrant exempt de boucles.</p> <p><b>Cliquez sur chaque étape dans la figure </b>pour savoir comment les rôles des ports sont déterminés.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020405">
<content-media type="StaticGraphic" id="cm5806744553">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020400/tl1305020405/cm5806744553.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020400/tl1305020405/cm5806744553text.xml"/></content-media>
<content-text><p><b>Vérification des rôles et de la priorité des ports</b></p> <p>Maintenant que l’arbre recouvrant a déterminé la topologie logique du réseau sans boucle, vous pouvez confirmer le rôle et la priorité de chaque port de commutateur du réseau.</p> <p>Pour vérifier le rôle et la priorité de chacun des ports des commutateurs, utilisez la commande <span class="cmd"><b>show spanning-tree</b></span> en mode d’exécution privilégié.</p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> affiche tous les ports des commutateurs et leurs rôles définis. Les ports de commutateur F0/1 et F0/2 sont configurés en tant que ports désignés. La sortie affiche également la priorité de tous les ports des commutateurs. Le port de commutateur F0/1 présente une priorité de port de 128.1.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305020500">
<title><content-text>États des ports STP et minuteurs BPDU</content-text></title>
<page type="OneColumn" id="tl1305020501">
<content-media type="StaticGraphic" id="cm9723878434">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020501/cm9723878434.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020500/tl1305020501/cm9723878434text.xml"/></content-media>
<content-text><p><b>États des ports </b></p> <p>Le protocole STP détermine le chemin logique sans boucle sur l’ensemble du domaine de diffusion. L’arbre recouvrant est déterminé au moyen des informations recueillies par l’échange de trames BPDU entre les commutateurs interconnectés. Pour faciliter l’apprentissage de l’arbre recouvrant logique, chaque port d’un commutateur passe par cinq états possibles et trois minuteurs BPDU.</p> <p>L’arbre recouvrant est défini dès la fin de l’initialisation d’un commutateur. Si le port d’un commutateur passait directement de l’état de blocage à l’état d’acheminement, le port pourrait créer temporairement une boucle de données si le commutateur n’avait pas connaissance de toutes les informations de topologie à ce moment-là. Pour cette raison, le protocole STP introduit cinq états de port. Le tableau résume le rôle de chacun des états de port. Les informations complémentaires présentées ci-dessous expliquent comment les états des ports garantissent qu’aucune boucle ne se forme durant la création de l’arbre recouvrant logique.</p> <p><ul><li><b>Blocage</b>. Le port est un port non désigné qui ne participe pas à l’acheminement des trames. Le port reçoit des trames BPDU pour déterminer l’emplacement et l’ID de racine du commutateur pont racine, ainsi que le rôle que chaque port d’un commutateur doit jouer dans la topologie STP active finale.</li><li><b>Écoute</b>. Le protocole STP a déterminé que le port peut participer à l’acheminement des trames en fonction des trames BPDU que le commutateur a reçues jusqu’à présent. À ce stade, le port du commutateur ne reçoit pas seulement des trames BPDU, il transmet également ses propres trames BPDU et informe les commutateurs adjacents que le port se prépare à participer à la topologie active.</li><li><b>Apprentissage</b>. Le port se prépare à participer à l’acheminement des trames et commence à enrichir la table d’adresses MAC. </li><li></li><li><b>Acheminement</b>. Le port est considéré comme intégré à la topologie active ; il achemine les trames, et il envoie et reçoit également des trames BPDU. </li><li></li><li><b>Désactivation</b>. Le port de couche 2 ne participe pas à l’arbre recouvrant et n’achemine aucune trame. L’état désactivé est défini lorsque le port du commutateur est désactivé sur le plan administratif.</li></ul></p></content-text>
</page>
<page type="OneColumn" id="tl1305020502">
<content-media type="InteractiveGraphicRollovers" id="cm3451815512">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020502/cm3451815512.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020500/tl1305020502/cm3451815512text.xml"/></content-media>
<content-text><p><b>Minuteurs BPDU</b></p> <p>La durée pendant laquelle un port reste dans les différents états dépend des minuteurs BPDU. Seul le commutateur qui joue le rôle de pont racine peut envoyer des informations dans l’arbre pour modifier les minuteurs. Les minuteurs suivants déterminent les performances du protocole STP et les modifications d’état :</p> <p><ul><li>Hello time</li><li>Forward delay</li><li>Maximum age</li></ul></p> <p><b>Cliquez sur le bouton Rôles et minuteurs dans la figure.</b></p> <p>Lorsque le protocole STP est activé, tous les ports des commutateurs du réseau passent par l’état de blocage et par les états intermédiaires d’écoute et d’identification à la mise sous tension. Les ports se stabilisent ensuite à l’état d’acheminement ou de blocage, comme l’illustre l’exemple. Lors d’une modification de topologie, un port passe temporairement par l’état d’écoute, puis d’identification pendant une période donnée, appelée <content-link target="{CE91AB5A-A0FC-4952-9CE3-5DE98F93AEF5}" type="glossary">temporisation de mise à jour</content-link>.</p> <p>Ces valeurs laissent suffisamment de temps pour la convergence dans un réseau doté d’un diamètre de sept sauts de commutateurs. Pour rappel, le diamètre de commutateur est le nombre de commutateurs qu’une trame doit traverser pour circuler entre les deux points les plus éloignés du domaine de diffusion. Un diamètre de sept sauts est le diamètre le plus important autorisé par le protocole STP en raison des temps de convergence. La convergence dans le contexte du protocole STP est la durée nécessaire au recalcul de l’arbre recouvrant en cas de défaillance d’un commutateur ou d’une liaison. Nous étudierons le fonctionnement de la convergence dans la section suivante.</p> <p><b>Cliquez sur le bouton Configurer le diamètre du réseau dans la figure.</b></p> <p>Il est conseillé de ne pas modifier directement les minuteurs BPDU, car les valeurs ont été optimisées pour le diamètre de sept commutateurs. La diminution de la valeur de diamètre de l’arbre recouvrant sur le pont racine entraîne la modification automatique des minuteurs « forward delay » et « max age » proportionnellement au nouveau diamètre. En principe, vous ne devez pas modifier les minuteurs BPDU ni reconfigurer le diamètre du réseau. Toutefois, si un administrateur estime, après examen, que le temps de convergence du réseau est susceptible d’être optimisé, il peut procéder à l’optimisation en reconfigurant le diamètre du réseau (et non les minuteurs BPDU).</p> <p>Pour reconfigurer le diamètre du réseau dans une configuration STP, utilisez la commande <span class="cmd"><b>spanning-tree vlan </b><i>ID réseau local</i><b> root primary diameter </b><i>valeur</i></span> en mode de configuration globale sur le commutateur pont racine.</p> <p>Dans l’exemple, la commande <span class="cmd"><b>spanning-tree vlan 1 root primary diameter 5</b></span> en mode de configuration globale a été saisie pour attribuer à l’arbre recouvrant un diamètre de cinq commutateurs.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020503">
<content-media type="InteractiveGraphicRollovers" id="cm3682427112">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020503/cm3682427112.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305020000/tl1305020500/tl1305020503/cm3682427112text.xml"/></content-media>
<content-text><p><b>Technologie PortFast de Cisco</b></p> <p>PortFast est une technologie de Cisco. Lorsqu’un port de commutateur configuré avec la technologie PortFast est défini comme port d’accès, ce port passe immédiatement de l’état de blocage à l’état d’acheminement, sans passer par les états traditionnels d’écoute et d’apprentissage STP. Vous pouvez utiliser PortFast sur les ports d’accès (qui sont connectés à une station de travail ou à un serveur unique) pour permettre à ces périphériques de se connecter immédiatement au réseau au lieu d’attendre que l’arbre recouvrant soit convergent. Si une interface configurée en PortFast reçoit une trame BPDU, l’algorithme STA peut placer le port en état de blocage à l’aide d’une fonction appelée « BPDU Guard ». La configuration de la fonction BPDU Guard n’est pas au programme de ce cours.</p> <p><b>Remarque :</b> la technologie PortFast de Cisco peut être employée pour prendre en charge le protocole DHCP. Si la technologie PortFast n’est pas employée, un PC peut envoyer une requête DHCP avant que le port ne soit en état d’acheminement, ce qui empêche l’hôte d’obtenir une adresse IP utilisable et d’autres informations. Dans la mesure où la technologie PortFast assure le passage immédiat à l’état d’acheminement, le PC obtient systématiquement une adresse IP utilisable.</p> <p>Pour plus d’informations sur la configuration de la fonction BPDU Guard, reportez-vous à :</p> <p><content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml</content-link>.</p> <p><b>Remarque :</b> étant donné que la technologie PortFast a pour but de réduire le délai d’attente imposé aux ports d’accès avant la convergence de l’arbre recouvrant, elle ne doit être utilisée que sur les ports d’accès. Si vous activez PortFast sur un port qui est connecté à un autre commutateur, vous risquez de créer une boucle dans l’arbre recouvrant.</p> <p><b>Cliquez sur le bouton Configurer PortFast dans la figure.</b></p> <p>Pour configurer PortFast sur un port de commutateur, entrez la commande <span class="cmd"><b>spanning-tree portfast</b></span> en mode de configuration d’interface sur chaque interface sur laquelle la technologie PortFast doit être activée.</p> <p>Pour désactiver PortFast, entrez la commande <span class="cmd"><b>no spanning-tree portfast</b></span> en mode de configuration d’interface sur chaque interface sur laquelle la technologie PortFast doit être désactivée.</p> <p><b>Cliquez sur le bouton Vérifier PortFast dans la figure.</b></p> <p>Pour vérifier que la technologie PortFast a été activée pour un port, utilisez la commande <span class="cmd"><b>show running-config</b></span> en mode d’exécution privilégié. L’absence de commande <span class="cmd"><b>spanning-tree portfast</b></span> dans la configuration active d’une interface indique que la technologie PortFast a été désactivée pour cette interface. Par défaut, la technologie PortFast est désactivée sur toutes les interfaces.</p></content-text>
</page>
<page type="OneColumn" id="tl1305020504">
<content-media type="ActivityPKA" id="cm3383025613">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305020000/tl1305020500/tl1305020504/cm3383025613/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305020000/tl1305020500/tl1305020504/cm3383025613/icontext.xml"/></content-media>
<content-text><p>Dans cet exercice, les commutateurs sont « prêts à l’emploi » (non configurés). Vous travaillerez sur le processus de sélection du pont racine afin que les commutateurs de la couche coeur de réseau soient choisis avant les commutateurs de la couche de distribution ou d’accès.</p> <p>Des instructions détaillées sont fournies dans l’exercice même, ainsi que dans le lien PDF ci-dessous.</p> <p><content-link target="E3_PTAct_5_2_5.pdf" type="internalfile">Instructions pour l’exercice (PDF)</content-link></p> <p><b>Cliquez sur l’icône Packet Tracer pour plus de détails.</b></p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305030000">
<title><content-text>Convergence du protocole STP</content-text></title>
<topic type="" id="tl1305030100">
<title><content-text>Convergence du protocole STP</content-text></title>
<page type="OneColumn" id="tl1305030101">
<content-media type="StaticGraphic" id="cm9852040856">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030100/tl1305030101/cm9852040856.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030100/tl1305030101/cm9852040856text.xml"/></content-media>
<content-text><p><b>Étapes de la convergence du protocole STP </b></p> <p>Dans la section précédente, nous avons décrit les composants qui permettent au protocole STP de créer une topologie de réseau logique sans boucle. Dans cette section, nous examinerons le processus STP de bout en bout.</p> <p>La convergence est un aspect important du processus de création de l’arbre recouvrant. La convergence est la durée nécessaire au réseau pour déterminer le commutateur qui jouera le rôle de pont racine, pour le passage dans les différents états des ports et pour définir le rôle final de chacun des ports des commutateurs à l’aide de l’algorithme STA afin d’éliminer toutes les boucles potentielles. Le processus de convergence prend du temps en raison des différents minuteurs utilisés pour la coordination du processus.</p> <p>Pour une meilleure compréhension du processus de convergence, ce dernier a été décomposé en trois étapes :</p> <p><b>Étape 1. </b> Désignation d’un pont racine</p> <p><b>Étape 2.</b> Désignation des ports racine</p> <p><b>Étape 3.</b> Sélection des ports désignés et non désignés</p> <p>Les différentes étapes du processus de convergence sont présentées ci-après dans cette section.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305030200">
<title><content-text>Étape 1. Désignation d’un pont racine</content-text></title>
<page type="OneColumn" id="tl1305030201">
<content-media type="InteractiveGraphicRollovers" id="cm6412103216">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030200/tl1305030201/cm6412103216.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030200/tl1305030201/cm6412103216text.xml"/></content-media>
<content-text><p><b>Étape 1. Désignation d’un pont racine</b></p> <p>La première étape du processus de convergence de l’arbre recouvrant consiste à désigner un pont racine. Le pont racine est le point de référence pour le calcul de tous les coûts des chemins de l’arbre recouvrant, et il détermine en définitive l’affectation des différents rôles de ports utilisés pour éviter la formation de boucles.</p> <p>Le processus de sélection du pont racine est déclenché à la fin de l’initialisation d’un commutateur ou lorsqu’un chemin défaillant a été détecté dans un réseau. Au départ, tous les ports des commutateurs sont configurés pour l’état de blocage, qui dure 20 secondes par défaut. Cette configuration a pour but d’empêcher qu’une boucle ne se forme avant que le protocole STP ait eu le temps de calculer les meilleurs chemins racine et de configurer les rôles spécifiques de tous les ports des commutateurs. Pendant que les ports des commutateurs sont dans un état de blocage, ils sont toujours en mesure d’envoyer et de recevoir des trames BPDU afin que le processus de sélection de la racine puisse se poursuivre. Un diamètre réseau maximal de sept sauts de commutateurs est pris en charge d’un bout à l’autre de l’arbre recouvrant. Ainsi, le processus de sélection du pont racine est accompli en 14 secondes, cette valeur étant inférieure au temps que les ports des commutateurs passent dans l’état de blocage. </p> <p>Dès que les commutateurs ont été initialisés, ils commencent à envoyer des trames BPDU qui communiquent leur ID de pont (BID) pour tenter de devenir le pont racine. Au départ, chaque commutateur du réseau se considère comme le pont racine du domaine de diffusion. Lors de la diffusion des trames BPDU sur le réseau, le champ d’ID de racine correspond au champ d’ID de pont, ce qui indique que chaque commutateur se considère comme le pont racine. Ces trames BPDU sont envoyées toutes les deux secondes, conformément à la valeur par défaut du minuteur Hello Time.</p> <p>Lorsque chaque commutateur reçoit les trames BPDU de ses commutateurs voisins, il compare l’ID de racine de la trame BPDU reçue à l’ID de racine configuré localement. Si l’ID de racine de la trame BPDU reçue est inférieur à l’ID de racine actuel du commutateur, l’ID de racine est mis à jour pour indiquer le nouveau candidat optimal au rôle de pont racine.</p> <p>Une fois que le champ d’ID de racine est mis à jour sur un commutateur, ce dernier incorpore le nouvel ID de racine dans toutes les transmissions de trames BPDU suivantes. De cette manière, l’ID de racine le plus faible sera systématiquement transmis à tous les autres commutateurs adjacents dans le réseau. Le processus de sélection du pont racine se termine une fois que l’ID de pont le plus faible a renseigné le champ d’ID de racine de tous les commutateurs dans le domaine de diffusion. </p> <p>Bien que le processus de sélection du pont racine soit terminé, les commutateurs continuent de transmettre leurs trames BPDU communiquant l’ID de racine du pont racine toutes les deux secondes. Chaque commutateur est configuré avec un minuteur d’âge maximum (max age) qui indique pendant combien de temps il conserve la configuration BPDU actuelle au cas où il ne recevrait plus de mise à jour de ses commutateurs voisins. Par défaut, la valeur max age est de 20 secondes. Par conséquent, si un commutateur ne reçoit pas 10 trames BPDU consécutives de l’un de ses voisins, il considère qu’un chemin logique dans l’arbre recouvrant est défaillant et que les informations BPDU ne sont plus correctes. Ainsi, un autre processus de sélection du pont racine est déclenché par le protocole STP.</p> <p><b>Cliquez sur Lire dans la figure</b> pour passer en revue les étapes que suit le protocole STP pour désigner un pont racine.</p> <p>Lors de cette révision de la méthode de sélection d’un pont racine par le protocole STP, n’oubliez pas que tous les commutateurs envoient et reçoivent des trames BPDU simultanément pendant le processus de sélection du pont racine. Le fait que le processus de sélection soit effectué simultanément permet aux commutateurs de déterminer beaucoup plus rapidement le commutateur qui jouera le rôle de pont racine.</p></content-text>
</page>
<page type="OneColumn" id="tl1305030202">
<content-media type="InteractiveGraphicRollovers" id="cm6607674766">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030200/tl1305030202/cm6607674766.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030200/tl1305030202/cm6607674766text.xml"/></content-media>
<content-text><p><b>Vérification de la désignation du pont racine</b></p> <p>Lorsque la désignation du pont racine est terminée, vous pouvez vérifier l’identité du pont racine à l’aide de la commande <span class="cmd"><b>show spanning-tree</b></span> en mode d’exécution privilégié.</p> <p>Dans l’exemple de topologie, le commutateur S1 est celui qui présente la valeur de priorité la plus faible parmi les trois commutateurs ; nous pouvons donc présumer qu’il deviendra le pont racine.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S1 dans la figure.</b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S1 révèle qu’il s’agit du pont racine. Vous pouvez constater que le BID correspond à l’ID de racine, ce qui confirme que S1 est le pont racine.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S2 dans la figure.</b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S2 révèle que l’ID de racine correspond à l’ID de racine attendu du commutateur S1, ce qui indique que S2 considère S1 comme étant le pont racine.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S3 dans la figure.</b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S3 révèle que l’ID de racine correspond à l’ID de racine attendu du commutateur S1, ce qui indique que S3 considère S1 comme étant le pont racine.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305030300">
<title><content-text>Étape 2. Désignation des ports racine</content-text></title>
<page type="OneColumn" id="tl1305030301">
<content-media type="StaticGraphic" id="cm4139731900">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030300/tl1305030301/cm4139731900.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030300/tl1305030301/cm4139731900text.xml"/></content-media>
<content-text><p><b>Étape 2. Désignation des ports racine</b></p> <p>Maintenant que le pont racine a été déterminé, les commutateurs entament la configuration des rôles pour chacun de leurs ports. Le premier rôle à déterminer est le rôle de port racine.</p> <p>Dans une topologie STP, un seul port racine est défini pour chaque commutateur, à l’exception du pont racine. Le port racine est le port qui présente le coût de chemin le plus faible vers le pont racine. En principe, le coût du chemin est le seul critère qui détermine le commutateur à définir comme port racine. Toutefois, des caractéristiques de port supplémentaires déterminent le port racine lorsque plusieurs ports sur le même commutateur ont un coût de chemin identique vers la racine. Ce cas de figure peut se présenter si des liaisons redondantes sont utilisées pour effectuer une liaison ascendante d’un commutateur à un autre lorsqu’une configuration EtherChannel n’est pas employée. N’oubliez pas que la technologie EtherChannel de Cisco vous permet de configurer plusieurs liaisons physiques de type Ethernet sous forme d’une seule liaison logique.</p> <p>Les ports de commutateurs dotés des mêmes coûts de chemins vers la racine utilisent la valeur de priorité de port configurable. Ils utilisent l’ID de port pour se départager en cas d’équivalence. Lorsqu’un commutateur choisit un port présentant le même coût de chemin qu’un autre port comme port racine, le port « perdant » est configuré comme port non désigné pour éviter la formation d’une boucle.</p> <p>Le processus de détermination du port qui deviendra un port racine intervient durant l’échange de trames BPDU lors de la sélection du pont racine. Les coûts des chemins sont instantanément mis à jour lorsque des trames BPDU arrivent pour indiquer un nouvel ID de racine ou un chemin redondant. Lorsque le coût du chemin est mis à jour, le commutateur passe en mode de décision pour déterminer si la configuration des ports doit être mise à jour. Les décisions concernant les rôles des ports n’attendent pas que tous les commutateurs aient désigné le commutateur à définir comme pont racine final. Par conséquent, le rôle d’un port de commutateur peut changer à maintes reprises durant la convergence, et ce, jusqu’à ce que son rôle de port final soit établi après la modification finale de l’ID de racine.</p> <p><b>Cliquez sur chaque étape dans la figure</b> pour savoir comment les ports racine sont désignés.</p></content-text>
</page>
<page type="OneColumn" id="tl1305030302">
<content-media type="InteractiveGraphicRollovers" id="cm6663861202">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030300/tl1305030302/cm6663861202.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030300/tl1305030302/cm6663861202text.xml"/></content-media>
<content-text><p><b>Vérification du port racine</b></p> <p>Lorsque la désignation du pont racine est terminée, vous pouvez vérifier la configuration des ports racine à l’aide de la commande <span class="cmd"><b>show spanning-tree</b></span> en mode d’exécution privilégié.</p> <p>Dans l’exemple de topologie, le commutateur S1 a été identifié comme pont racine. Le port F0/1 du commutateur S2 et le port F0/1 du commutateur S3 sont les deux ports les plus proches du pont racine. Par conséquent, ils doivent être configurés comme ports racine. Vous pouvez confirmer la configuration des ports à l’aide de la commande <span class="cmd"><b>show spanning-tree</b></span> en mode d’exécution privilégié.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S1 dans la figure.</b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S1 révèle qu’il s’agit du pont racine et qu’il n’a donc aucun port racine configuré.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S2 dans la figure. </b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S2 indique que le port de commutateur F0/1 est configuré comme port racine. L’ID de racine indique la priorité et l’adresse MAC du commutateur S1. </p> <p><b>Cliquez sur le bouton Sortie du commutateur S3 dans la figure. </b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S3 indique que le port de commutateur F0/1 est configuré comme port racine. L’ID de racine indique la priorité et l’adresse MAC du commutateur S1. </p></content-text>
</page>
</topic>
<topic type="" id="tl1305030400">
<title><content-text>Étape 3. Sélection des ports désignés et non désignés</content-text></title>
<page type="OneColumn" id="tl1305030401">
<content-media type="StaticGraphic" id="cm4305433573">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030400/tl1305030401/cm4305433573.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030400/tl1305030401/cm4305433573text.xml"/></content-media>
<content-text><p><b>Étape 3. Sélection des ports désignés et non désignés</b></p> <p>Lorsqu’un commutateur a déterminé lequel de ses ports constitue le port racine, les autres ports doivent être configurés soit en tant que port désigné, soit en tant que port non désigné pour terminer la création de l’arbre recouvrant logique exempt de boucles.</p> <p>Chaque segment d’un réseau commuté ne peut comporter qu’un seul port désigné. Lorsque deux ports de commutateur non racine sont connectés sur le même segment LAN, ils entrent en concurrence car ils peuvent prétendre au même rôle de port. Les deux commutateurs échangent des trames BPDU pour déterminer le port qui sera un port désigné et le port qui sera un port non désigné.</p> <p>En général, lorsqu’un port de commutateur est configuré comme port désigné, il est choisi en fonction de l’ID de pont (BID). Cependant, n’oubliez pas que la première priorité est le coût de chemin le plus faible vers le pont racine ; le BID de l’émetteur constitue la priorité uniquement lorsque les coûts des ports sont égaux. </p> <p>Lorsque deux commutateurs échangent leurs trames BPDU, chacun d’eux examine le BID de l’émetteur de la trame BPDU reçue pour déterminer si ce BID est plus faible que le sien. Le commutateur possédant le BID le plus faible « gagne » et son port est configuré dans le rôle de port désigné. Le commutateur « perdant » configure son port dans le rôle de port non désigné, donc en état de blocage pour empêcher la formation d’une boucle.</p> <p>Le processus de détermination des rôles des ports intervient en même temps que les processus de sélection du pont racine et de désignation du port racine. Par conséquent, les rôles de port désigné et non désigné peuvent changer à maintes reprises durant le processus de convergence, et ce, tant que le pont racine final n’a pas été déterminé. L’ensemble du processus de sélection du pont racine, de détermination des ports racine et de détermination des ports désignés et non désignés intervient dans le laps de temps de 20 secondes correspondant à l’état de blocage des ports. Ce temps de convergence repose sur la fréquence de 2 secondes (hello time) de transmission des trames BPDU et sur le diamètre de sept commutateurs pris en charge par le protocole STP. Le délai d’âge maximum (max age) de 20 secondes assure un temps d’attente suffisant pour le diamètre de sept commutateurs avec l’intervalle de 2 secondes (hello time) entre chaque transmission de trames BPDU.</p> <p><b>Cliquez sur chaque étape dans la figure</b> pour découvrir la procédure de sélection des ports désignés et des ports non désignés.</p></content-text>
</page>
<page type="OneColumn" id="tl1305030402">
<content-media type="InteractiveGraphicRollovers" id="cm9994647066">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030400/tl1305030402/cm9994647066.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030400/tl1305030402/cm9994647066text.xml"/></content-media>
<content-text><p><b>Vérification des ports désignés et des ports non désignés</b></p> <p>Une fois que les ports racine ont été affectés, les commutateurs déterminent comment les autres ports seront configurés (soit comme ports désignés, soit comme ports non désignés). Vous pouvez vérifier la configuration des ports désignés et des ports non désignés à l’aide de la commande <span class="cmd"><b>show spanning-tree</b></span> en mode d’exécution privilégié.</p> <p>Dans la topologie :</p> <p>1. Le commutateur S1 est identifié comme étant le pont racine. Par conséquent, il configure ses deux ports comme ports désignés. </p> <p>2. Le port F0/1 du commutateur S2 et le port F0/1 du commutateur S3 sont les deux ports les plus proches du pont racine ; ils sont configurés comme ports racine. </p> <p>3. Le port F0/2 du commutateur S2 et le port F0/2 du commutateur S3 doivent choisir le port qui sera configuré comme port désigné et celui qui sera configuré comme port non désigné. </p> <p>4. Les commutateurs S2 et S3 comparent leurs valeurs d’identificateur de pont (BID) pour déterminer celui qui possède la valeur la plus faible, et qui sera donc configuré comme port désigné. </p> <p>5. Étant donné que les deux commutateurs présentent la même priorité, l’adresse MAC constitue alors le facteur déterminant. </p> <p>6. Dans la mesure où le commutateur S2 possède une adresse MAC plus faible, il configure son port F0/2 comme port désigné. </p> <p>7. Le commutateur S3 configure à son tour son port F0/2 comme port non désigné pour éviter la formation d’une boucle. </p> <p>Vous pouvez confirmer la configuration des ports à l’aide de la commande show spanning-tree en mode d’exécution privilégié.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S1 dans la figure.</b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S1 révèle qu’il s’agit du pont racine. Par conséquent, ses deux ports sont configurés comme ports désignés.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S2 dans la figure.</b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S2 révèle que son port F0/2 est configuré comme port désigné.</p> <p><b>Cliquez sur le bouton Sortie du commutateur S3 dans la figure.</b></p> <p>Dans l’exemple, la sortie <span class="cmd"><b>show spanning-tree</b></span> du commutateur S3 révèle que son port F0/2 est configuré comme port non désigné.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305030500">
<title><content-text>Modification de la topologie STP</content-text></title>
<page type="OneColumn" id="tl1305030501">
<content-media type="InteractiveGraphicRollovers" id="cm6316113290">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305030000/tl1305030500/tl1305030501/cm6316113290.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305030000/tl1305030500/tl1305030501/cm6316113290text.xml"/></content-media>
<content-text><p><b>Processus de notification d’une modification de la topologie STP</b></p> <p>Un commutateur considère qu’il a détecté une modification de topologie lorsqu’un port qui était dans l’état d’acheminement (forwarding) connaît une défaillance, en cas de blocage par exemple, ou lorsqu’un port passe à l’état d’acheminement et que le commutateur possède un port désigné. Lorsqu’une modification est détectée, le commutateur notifie le pont racine de l’arbre recouvrant. Le pont racine diffuse alors les informations sur l’ensemble du réseau.</p> <p>En mode de fonctionnement normal du protocole STP, un commutateur continue de recevoir les trames BPDU de configuration émises par le pont racine sur son port racine. Cependant, il n’envoie jamais de trame BPDU vers le pont racine. Pour que cela soit possible, une trame BPDU spéciale, appelée BPDU de notification de changement de topologie (TCN, Topology Change Notification), a été introduite. Lorsqu’un commutateur doit signaler un changement de topologie, il commence par envoyer les TCN sur son port racine. La TCN est une trame BPDU très simple qui ne contient aucune information et qui est envoyée selon l’intervalle Hello Time. Le commutateur récepteur est appelé pont désigné et il accuse réception de la TCN en renvoyant immédiatement une trame BPDU normale avec le bit TCA (Topology Change Acknowledgement). Cet échange se poursuit jusqu’à ce que le pont racine réponde.</p> <p>Par exemple, dans la figure, le commutateur S2 fait l’objet d’une modification de topologie. Il envoie une TCN à son pont désigné, dans ce cas, le commutateur D1. Le commutateur D1 reçoit la TCN, il en accuse réception (procédure d’acquittement) en la renvoyant au commutateur S2 avec un indicateur TCA défini. Le commutateur D1 génère une TCN et la transmet à son pont désigné, dans ce cas, le pont racine. </p> <p><b>Cliquez sur le bouton Notification de diffusion dans la figure.</b></p> <p><b>Notification de diffusion</b></p> <p>Une fois que le pont racine a été informé d’une modification de la topologie du réseau, il commence à envoyer ses BPDU de configuration avec le bit TC. Ces BPDU sont ensuite relayées par chaque commutateur du réseau avec ce bit défini. Par conséquent, tous les commutateurs sont informés de la modification de topologie et peuvent réduire leur paramètre « aging time » pour le délai de passage à l’état d’acheminement. Les commutateurs reçoivent les BPDU de changement de topologie sur les ports en état d’acheminement et les ports en état de blocage.</p> <p>Le bit TC est défini par la racine pour une durée équivalente à la valeur des minuteurs « max age » + « forward delay », c’est-à-dire, 20+15 = 35 secondes par défaut.</p></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305040000">
<title><content-text>PVST+, RSTP et Rapid PVST+</content-text></title>
<topic type="" id="tl1305040100">
<title><content-text>Variantes du protocole STP (Cisco et autres)</content-text></title>
<page type="OneColumn" id="tl1305040101">
<content-media type="StaticGraphic" id="cm7529133937">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040100/tl1305040101/cm7529133937.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040100/tl1305040101/cm7529133937text.xml"/></content-media>
<content-text><p>Comme pour de nombreuses normes réseau, l’évolution du protocole STP a été dictée par la nécessité de créer des spécifications reconnues par l’ensemble de l’industrie alors que les protocoles propriétaires devenaient des <content-link target="{E2DB50CF-7AB3-4403-AD48-05AA1DA1907E}" type="glossary">normes de facto</content-link>. Lorsque la prédominance d’un protocole propriétaire est telle que tous les concurrents du marché sont contraints de l’adopter, des organismes tels que l’IEEE interviennent et créent une spécification publique. Le protocole STP a connu une évolution de ce type, comme l’illustre le tableau. </p> <p>Lorsque vous consultez les informations disponibles concernant le protocole STP sur le site Cisco.com, vous remarquez qu’il existe de nombreux types ou variantes du protocole STP. Certaines de ces variantes sont des solutions propriétaires Cisco, et d’autres constituent des normes IEEE. Nous étudierons plus en détail certaines variantes du protocole STP, mais pour commencer, vous devez posséder des notions de base sur les principales variantes du protocole STP. Le tableau récapitule les principales variantes du protocole STP (protocoles propriétaires Cisco et normes IEEE).</p> <p><b>Protocoles propriétaires Cisco</b></p> <p><b>Per-VLAN spanning tree protocol (PVST)</b> - Gère une instance d’arbre recouvrant pour chaque VLAN configuré dans le réseau. PVST utilise le protocole d’agrégation ISL (Cisco Inter Switch Link) qui autorise pour certains VLAN l’état d’acheminement d’une agrégation, et qui impose l’état de blocage pour d’autres VLAN. Étant donné que le protocole PVST traite chaque VLAN comme un réseau indépendant, il peut assurer l'<content-link target="{6486955C-ABEA-42FA-8513-891B95FCF479}" type="glossary">équilibrage de la charge</content-link> du trafic de couche 2 en acheminant des informations de certains VLAN sur une agrégation et celles d’autres VLAN sur une autre agrégation sans provoquer de boucle. Pour le protocole PVST, Cisco a développé plusieurs extensions propriétaires à la norme initiale IEEE 802.1D du protocole STP, telles que BackboneFast, UplinkFast et PortFast. Les extensions STP de Cisco ne sont pas traitées dans ce cours. Pour en savoir plus sur ces extensions, consultez le guide suivant : <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst4000/7.4/configuration/guide/stp_enha.html" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst4000/7.4/configuration/guide/stp_enha.html</content-link>. </p> <p><b>Per-VLAN spanning tree protocol plus (PVST+)</b> - La société Cisco a développé le protocole PVST+ pour prendre en charge la norme d’agrégation IEEE 802.1Q. Le protocole PVST+ fournit les mêmes fonctions que le protocole PVST, y compris les extensions STP propriétaires Cisco. Le protocole PVST+ n’est pas pris en charge sur les périphériques non-Cisco. Il inclut l’amélioration PortFast appelée BPDU Guard, et Root Guard. Pour en savoir plus sur BPDU Guard, consultez le guide : <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml</content-link>.</p> <p>Pour en savoir plus sur Root Guard, consultez le guide : <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800ae96b.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800ae96b.shtml</content-link>.</p> <p><b>Rapid per-VLAN spanning tree protocol (rapid PVST+)</b> - Ce protocole reposant sur la norme IEEE 802.1w assure un temps de convergence plus court que le protocole STP (norme 802.1D). Le protocole Rapid PVST+ intègre des extensions propriétaires Cisco telles que BackboneFast, UplinkFast et PortFast.</p> <p><b>Normes IEEE</b></p> <p><b>Rapid spanning tree protocol (RSTP)</b> - L’IEEE a mis en place ce protocole en améliorant la norme 802.1D du protocole STP en 1982. Le protocole RSTP accélère la convergence du réseau après une modification de la topologie. Il intègre les extensions Cisco BackboneFast, UplinkFast et PortFast dans la norme publique. En 2004, l’IEEE a incorporé le protocole RSTP dans la norme 802.1D, en identifiant la spécification dans IEEE 802.1D-2004. Par conséquent, lorsque l’on parle du protocole STP, vous pouvez l’assimiler au protocole RSTP. Nous aborderons le protocole RSTP de manière plus détaillée dans cette section.</p> <p><b>Multiple STP (MSTP)</b> - Permet d’associer plusieurs réseaux locaux virtuels (VLAN) à la même instance d’arbre recouvrant afin de réduire le nombre d’instances requises pour la prise en charge de nombreux VLAN. Le protocole MSTP s’inspire du protocole MISTP (Multiple Instances STP) de Cisco ; il s’agit d’une évolution des protocoles STP et RSTP. Il est apparu pour la première fois dans la norme IEEE 802.1s comme amendement à la norme 802.1Q de 1998. La norme IEEE 802.1Q-2003 inclut désormais le protocole MSTP. Ce protocole offre plusieurs chemins d’acheminement pour le trafic de données et permet un équilibrage de la charge. L’étude du protocole MSTP n’est pas au programme de ce cours. Pour en savoir plus sur le protocole MSTP, consultez le guide : <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst2950/software/release/12.1_19_ea1/configuration/guide/swmstp.html" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst2950/software/release/12.1_19_ea1/configuration/guide/swmstp.html</content-link>.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040200">
<title><content-text>PVST+</content-text></title>
<page type="OneColumn" id="tl1305040201">
<content-media type="StaticGraphic" id="cm5207024464">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040201/cm5207024464.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040201/cm5207024464text.xml"/></content-media>
<content-text><p><b>PVST+</b></p> <p>Cisco a élaboré le protocole PVST+ afin qu’un réseau puisse exécuter une instance STP pour chaque VLAN du réseau. Avec le protocole PVST+, plusieurs agrégations peuvent être en état de blocage pour un VLAN et le partage de la charge peut être mis en oeuvre. Cependant, l’implémentation du protocole PVST+ implique que tous les commutateurs du réseau participent à la convergence du réseau, et les ports des commutateurs doivent pouvoir gérer la bande passante supplémentaire utilisée pour chaque instance PVST+ pour l’envoi de ses propres trames BPDU. </p> <p>Dans un environnement PVST+ Cisco, vous pouvez modifier les paramètres de l’arbre recouvrant afin que la moitié des VLAN soit acheminée sur chaque agrégation de liaison ascendante. Dans la figure, le port F0/3 du commutateur S2 est le port de transmission pour VLAN 20, et le port F0/2 du commutateur S2 est le port de transmission pour VLAN 10. Pour ce faire, un commutateur doit être configuré de sorte qu’il soit désigné comme pont racine pour la moitié des VLAN dans le réseau, et un second commutateur doit être configuré de sorte qu’il soit désigné comme pont racine pour l’autre moitié des VLAN. Dans la figure, le commutateur S3 est le pont racine pour VLAN 20, et le commutateur S1 est le pont racine pour VLAN 10. Le fait de créer différents commutateurs racine STP par VLAN conduit à un réseau plus redondant. </p></content-text>
</page>
<page type="OneColumn" id="tl1305040202">
<content-media type="StaticGraphic" id="cm4119860280">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040202/cm4119860280.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040202/cm4119860280text.xml"/></content-media>
<content-text><p><b>ID de pont PVST+</b></p> <p>Comme vous le savez, dans la norme 802.1D initiale, l’identificateur de pont (BID) sur 8 octets était composé de la priorité du pont (2 octets) et de l’adresse MAC (6 octets) du commutateur. Il était donc inutile d’identifier un VLAN, car un réseau ne comportait qu’un seul arbre recouvrant. Le protocole PVST+ impose qu’une instance d’arbre recouvrant distincte soit exécutée pour chaque VLAN. Pour le protocole PVST+, le champ BID d’une longueur de 8 octets est modifié afin qu’il contienne un ID de VLAN (VID). Dans la figure, le champ de priorité de pont est réduit à 4 bits, et un nouveau champ sur 12 bits (champ d’ID système étendu) contient l’identificateur du VLAN. Le champ d’adresse MAC sur 6 octets reste inchangé. </p> <p>Les différents champs PVST+ sont détaillés ci-dessous :</p> <p><ul><li>Priorité de pont : champ sur 4 bits contenant la priorité du pont. En raison du nombre limité de bits, la priorité est véhiculée dans des valeurs discrètes en incréments de 4 096, et non dans des valeurs discrètes en incréments de 1, comme ce serait le cas si la totalité du champ sur 16 bits était disponible. La priorité par défaut, conformément à la norme IEEE 802.1D, est 32 768, ce qui représente une valeur moyenne.</li><li>ID système étendu : champ sur 12 bits contenant l’ID de VLAN pour PVST+. </li><li>Adresse MAC : champ de 6 octets comportant l’adresse MAC d’un seul commutateur. </li></ul></p> <p>L’adresse MAC est le critère qui rend un BID unique. Lorsque la priorité et l’ID système étendu sont ajoutés initialement à l’adresse MAC du commutateur, chaque VLAN sur le commutateur peut être représenté par un BID unique. </p> <p><b>Cliquez sur le bouton Exemple d’ID de pont PVST+ dans la figure.</b></p> <p>Dans la figure, les valeurs de priorité, de VLAN et d’adresse MAC du commutateur S1 sont affichées. Elles sont combinées pour former le BID.</p> <p><b>Attention :</b> si aucune priorité n’a été configurée, tous les commutateurs présentent la même priorité par défaut et le choix du pont racine de chaque VLAN repose sur l’adresse MAC. Par conséquent, pour que vous soyez sûr d’obtenir le pont racine souhaité, il est conseillé d’affecter une valeur de priorité plus faible au commutateur qui doit faire office de pont racine.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040203">
<content-media type="StaticGraphic" id="cm4046248871">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040203/cm4046248871.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040203/cm4046248871text.xml"/></content-media>
<content-text><p>Le tableau illustre la configuration d’arbre recouvrant par défaut d’un commutateur de la gamme Cisco Catalyst 2960. Notez que le mode par défaut de l’arbre recouvrant est PVST+.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040204">
<content-media type="InteractiveGraphicRollovers" id="cm2329173336">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040200/tl1305040204/cm2329173336.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040200/tl1305040204/cm2329173336text.xml"/></content-media>
<content-text><p><b>Configuration de PVST+</b></p> <p>La topologie présente trois commutateurs reliés par des agrégations 802.1Q. Elle inclut deux VLAN, 10 et 20, qui sont agrégés sur ces liaisons. Ce réseau n’a pas été configuré pour le protocole STP. L’objectif consiste à configurer S3 comme pont racine pour VLAN 20 et S1 comme pont racine pour VLAN 10. Le port F0/3 de S2 est le port en état d’acheminement pour VLAN 20 et le port en état de blocage pour VLAN 10. Le port F0/2 de S2 est le port en état d’acheminement pour VLAN 10 et le port en état de blocage pour VLAN 20. La procédure de configuration du protocole PVST+ dans cet exemple de topologie est la suivante :</p> <p><b>Étape 1. </b> Sélectionnez les commutateurs que vous souhaitez configurer comme ponts racine principal et secondaire pour chaque VLAN.</p> <p><b>Étape 2.</b> Configurez le commutateur qui constituera un pont principal pour un VLAN ; par exemple, le commutateur S3 est un pont principal pour VLAN 20.</p> <p><b>Étape 3.</b> Configurez le commutateur qui constituera un pont secondaire pour l’autre VLAN ; par exemple, le commutateur S3 est un pont secondaire pour VLAN 10.</p> <p>Définissez une priorité suffisamment faible sur chaque commutateur pour qu’il soit sélectionné comme pont principal (facultatif).</p> <p><b>Cliquez sur le bouton Ponts racine principal et secondaire dans la figure.</b></p> <p><b>Configuration des ponts racine secondaires</b></p> <p>L’objectif consiste à configurer S3 comme pont racine principal pour VLAN 20 et S1 comme pont racine principal pour VLAN 10. Pour configurer un commutateur de sorte qu’il devienne le pont racine d’un VLAN spécifié, utilisez la commande <span class="cmd"><b>spanning-tree vlan </b><i>id de vlan</i><b> root primary</b></span> en mode de configuration globale. N’oubliez pas que vous commencez avec un réseau qui n’a pas été configuré avec le protocole STP. Vous partez donc du principe que tous les commutateurs sont configurés par défaut. Dans cet exemple, le commutateur S1, avec VLAN 10 et VLAN 20 activés, conserve sa priorité STP par défaut.</p> <p><b>Configuration des ponts racine secondaires</b></p> <p>Une racine secondaire est un commutateur pouvant devenir le pont racine pour un réseau local virtuel si le premier pont racine est défaillant. Pour configurer un commutateur comme pont racine secondaire, utilisez la commande <span class="cmd"><b>spanning-tree vlan </b><i>id de vlan</i><b> root secondary</b></span> en mode de configuration globale. En supposant que les autres ponts du VLAN conservent leur priorité STP par défaut, ce commutateur devient le pont racine si le pont racine principal tombe en panne. Cette commande peut être exécutée sur plusieurs commutateurs pour configurer différents ponts racine de secours.</p> <p>Le graphique présente la syntaxe de la commande Cisco IOS permettant de spécifier le commutateur S3 comme pont racine principal pour VLAN 20 et comme pont racine secondaire pour VLAN 10. De plus, le commutateur S1 devient le pont racine principal pour VLAN 10 et le pont racine secondaire pour VLAN 20. Cette configuration permet l’équilibrage de la charge de l’arbre recouvrant, le trafic de VLAN 10 étant transmis via le commutateur S1 et le trafic de VLAN 20 étant transmis via le commutateur S3.</p> <p><b>Cliquez sur le bouton Priorité des commutateurs PVST+ dans la figure.</b></p> <p><b>Priorité des commutateurs PVST+</b></p> <p>Nous avons expliqué précédemment dans ce chapitre que les paramètres par défaut employés pour configurer l’arbre recouvrant conviennent pour la plupart des réseaux. Ceci est également vrai pour le protocole PVST+ de Cisco. Il existe différentes manières de configurer le protocole PVST+. La modification d’une mise en oeuvre du protocole PVST+ n’est pas au programme de ce cours. Vous pouvez toutefois définir la priorité du commutateur de l’instance d’arbre recouvrant spécifiée. Ce paramètre affecte la probabilité de sélection de ce commutateur comme commutateur racine. Plus la valeur est faible, plus il y a de chances que le commutateur soit sélectionné. Les valeurs autorisées sont comprises entre 0 et 61 440, par incréments de 4 096. Par exemple, 4 096 x 2 = 8 192 est une valeur de priorité valide. Toutes les valeurs hors de cette plage sont rejetées. </p> <p>Les exemples illustrent la syntaxe de la commande Cisco IOS. </p> <p><b>Cliquez sur le bouton Vérifier dans la figure.</b></p> <p>La commande <span class="cmd"><b>show spanning tree active</b></span> en mode d’exécution privilégié indique les détails de la configuration de l’arbre recouvrant pour les interfaces actives uniquement. La sortie illustrée concerne le commutateur S1 configuré avec le protocole PVST+. Il existe de nombreux paramètres de ligne de commande Cisco IOS associés à la commande <span class="cmd"><b>show spanning tree</b></span>. Pour une description complète de ces paramètres, consultez la page : <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli2.html#wpxref47293" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli2.html#wpxref47293</content-link>.</p> <p><b>Cliquez sur le bouton </b><span class="cmd"><b>show run</b></span><b> dans la figure.</b></p> <p>Vous pouvez constater dans la sortie que la priorité de VLAN 10 est 4 096 ; il s’agit de la priorité la plus basse des trois VLAN. Ce paramètre de priorité garantit que ce commutateur est le pont racine principal de VLAN 10.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040300">
<title><content-text>Protocole RSTP</content-text></title>
<page type="OneColumn" id="tl1305040301">
<content-media type="InteractiveGraphicRollovers" id="cm8106262651">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040300/tl1305040301/cm8106262651.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040300/tl1305040301/cm8106262651text.xml"/></content-media>
<content-text><p><b>Qu’est-ce que le protocole RSTP ?</b></p> <p>Le protocole RSTP (IEEE 802.1w) constitue une évolution de la norme 802.1D. La terminologie du protocole RSTP (norme 802.1w) reste fondamentalement la même que celle du protocole STP (norme IEEE 802.1D). Dans la mesure où la plupart des paramètres demeurent inchangés, les utilisateurs habitués au protocole STP pourront rapidement s’acclimater à ce nouveau protocole. </p> <p>La figure illustre un exemple de réseau configuré avec le protocole RSTP. Le commutateur S1 est le pont racine et il comporte deux ports désignés placés en état d’acheminement. Le protocole RSTP gère un nouveau type de port. Le port F0/3 du commutateur S2 est un port alternatif en état de mise à l’écart (état « discarding »). Notez que le réseau ne comporte aucun port en état de blocage. En effet, le protocole RSTP n’autorise pas l’état de blocage d’un port. Il définit les états suivants pour les ports : mise à l’écart (discarding), apprentissage ou acheminement. Nous aborderons plus en détail les types et les états des ports ultérieurement dans ce chapitre.</p> <p><b>Cliquez sur le bouton Caractéristiques du protocole RSTP dans la figure.</b></p> <p><b>Caractéristiques du protocole RSTP</b></p> <p>Le protocole RSTP optimise le recalcul de l’arbre recouvrant lorsque la topologie d’un réseau de couche 2 change. Le protocole RSTP assure un temps de convergence beaucoup plus rapide dans un réseau correctement configuré, parfois de l’ordre de quelques centaines de millisecondes. Il redéfinit le type des ports et leur état. Si un port est configuré comme port alternatif ou de secours, il peut basculer immédiatement vers l’état d’acheminement sans attendre que le réseau soit convergent. Les caractéristiques du protocole RSTP sont décrites brièvement ci-dessous :</p> <p><ul><li>Le protocole RSTP est le protocole le plus adapté pour garantir qu’il n’y a pas de boucles de couche 2 dans un environnement de réseau commuté. La plupart des différences ont été signalées par les améliorations propriétaires Cisco de la norme 802.1D. Ces améliorations (par exemple, le fait que les trames BPDU véhiculent et envoient les informations concernant les rôles des ports exclusivement aux commutateurs voisins) ne requièrent aucune configuration supplémentaire et sont généralement plus performantes que les versions Cisco antérieures. Elles sont désormais transparentes et intégrées au fonctionnement du protocole. </li><li>Les améliorations propriétaires Cisco apportées à la norme 802.1D (telles que UplinkFast et BackboneFast) ne sont pas compatibles avec le protocole RSTP.</li><li>La norme RSTP (802.1w) remplace celle du STP (802.1D) tout en préservant la compatibilité en amont. La terminologie RSTP reste fondamentalement identique à celle du protocole STP, et la plupart des paramètres demeurent inchangés. Qui plus est, en mode 802.1w, il est possible de revenir à une configuration 802.1D pour garantir l’interfonctionnement avec les anciens commutateurs au niveau de chaque port. Par exemple, l’algorithme STA du protocole RSTP désigne un pont racine exactement de la même manière que le protocole STP (norme 802.1D). </li><li></li><li>Le protocole RSTP conserve le même format de trame BPDU que la norme IEEE 802.1D, à la différence près que le champ de version est défini à 2 pour indiquer RSTP et que le champ d’indicateur utilise les six autres bits dans l’octet. La structure des trames BPDU du protocole RSTP sera traitée ultérieurement.</li><li>Le protocole RSTP est en mesure de confirmer activement qu’un port peut basculer sans risque à l’état d’acheminement en s’affranchissant complètement de tout minuteur.</li></ul></p></content-text>
</page>
<page type="OneColumn" id="tl1305040302">
<content-media type="StaticGraphic" id="cm3472076048">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040300/tl1305040302/cm3472076048.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040300/tl1305040302/cm3472076048text.xml"/></content-media>
<content-text><p><b>Trames BPDU du protocole RTSP</b></p> <p>Le protocole RSTP (802.1w) utilise des trames BPDU de type 2, version 2. Un pont RSTP peut donc communiquer via la norme 802.1D sur toute liaison partagée ou avec tout commutateur exécutant 802.1D. Quelques changements mineurs ont été introduits par le protocole RSTP au niveau de l’envoi des trames BPDU et du remplissage de l’octet du champ d’indicateurs (flag) par rapport au protocole STP (802.1D) :</p> <p><ul><li>Il existe un « vieillissement » accéléré des informations de protocole sur un port si les messages « hello » ne sont pas reçus trois fois de suite (6 secondes par défaut) ou si le délai « max age » du minuteur est dépassé. </li><li>Étant donné que les trames BPDU sont utilisées en tant que mécanisme « keep-alive » (maintien en vie), la perte de trois trames BPDU consécutives signifie que la connexion a été coupée entre un pont et son pont désigné ou racine voisin. Le vieillissement accéléré des informations permet une détection rapide des pannes.</li></ul></p> <p><b>Remarque : </b>comme dans une configuration STP, un pont RSTP envoie une trame BPDU contenant ses informations actuelles à chaque battement défini par la valeur du « hello time » (2 secondes par défaut), et cela même s’il ne reçoit aucune trame BPDU en provenance du pont racine. </p> <p>Le protocole RSTP utilise l’octet du champ d’indicateurs des trames BPDU version 2, comme l’indique la figure :</p> <p><ul><li>Les bits 0 et 7 sont utilisés pour la TCN (Topology Change Notification) et la TCA (Topology Change Acknowledgement) ou <content-link target="{5BD1CB6F-D813-41FC-957A-674825DFA6C6}" type="glossary">reçu</content-link>, tout comme avec le protocole 802.1D. </li><li>Les bits 1 et 6 sont utilisés pour le processus de proposition et d’accord (employé pour la convergence rapide).</li><li>Les bits 2 à 5 codent le rôle et l’état du port émetteur de la trame BPDU.</li><li>Les bits 4 et 5 sont utilisés pour coder le rôle du port à l’aide d’un code sur 2 bits.</li></ul></p></content-text>
</page>
</topic>
<topic type="" id="tl1305040400">
<title><content-text>Ports d’extrémité</content-text></title>
<page type="OneColumn" id="tl1305040401">
<content-media type="InteractiveGraphicRollovers" id="cm7199801801">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040400/tl1305040401/cm7199801801.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040400/tl1305040401/cm7199801801text.xml"/></content-media>
<content-text><p><b>Ports d’extrémité</b></p> <p>Un port d’extrémité RSTP est un port de commutateur qui ne doit jamais être connecté à un autre périphérique de commutateur. Il passe immédiatement à l’état d’acheminement lorsqu’il est activé. </p> <p>Le concept de port d’extrémité est déjà bien connu des utilisateurs du protocole Spanning Tree de Cisco, car il correspond à la fonctionnalité « PortFast » dans laquelle tous les ports directement connectés aux stations d’extrémité anticipent qu’ils ne sont connectés à aucun périphérique de commutateur. Les ports PortFast basculent immédiatement vers l’état d’acheminement STP sans passer par les longues étapes d’écoute et d’identification. Ni les ports d’extrémité ni les ports PortFast ne produisent de changement de topologie lorsque le port passe à un état désactivé ou activé.</p> <p>À la différence de PortFast, un port d’extrémité RSTP qui reçoit une trame BPDU perd immédiatement son statut de port d’extrémité et devient un port « Spanning Tree » normal. </p> <p>L’implémentation RSTP de Cisco réserve le mot-clé PortFast, à l’aide de la commande <span class="cmd"><b>spanning-tree portfast</b></span>, pour la configuration de port d’extrémité. Par conséquent, une transition globale du réseau vers le protocole RSTP est plus transparente. La configuration d’un port d’extrémité devant être relié à un autre commutateur peut avoir des conséquences négatives pour le protocole RSTP lorsque ce port est en état de synchronisation. En effet, une boucle temporaire peut se former et ralentir éventuellement la convergence de RSTP en raison du conflit des trames BPDU avec le trafic sur la boucle.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040500">
<title><content-text>Types de liaisons</content-text></title>
<page type="OneColumn" id="tl1305040501">
<content-media type="InteractiveGraphicRollovers" id="cm7881346778">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040500/tl1305040501/cm7881346778.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040500/tl1305040501/cm7881346778text.xml"/></content-media>
<content-text><p><b>Types de liaisons</b></p> <p>Le type de liaison permet de classer dans différentes catégories chacun des ports d’une configuration RSTP. Le type de liaison peut prédéterminer le rôle actif que joue le port lorsqu’il est en attente d’une transition immédiate vers l’état d’acheminement si certaines conditions sont réunies. Ces conditions ne sont pas les mêmes pour les ports d’extrémité et les autres types de ports. Les ports qui ne sont pas des ports d’extrémité appartiennent à deux catégories de type de liaison : point à point et partagée. Le type de liaison est automatiquement déterminé, mais il peut être remplacé par une configuration de port explicite.</p> <p>Les ports d’extrémité (l’équivalent des ports PortFast) et les liaisons point à point sont d’excellents choix pour une transition rapide vers l’état d’acheminement. Cependant, avant que le paramètre de type de liaison soit pris en compte, le protocole RSTP doit déterminer le rôle du port. Nous étudierons les rôles des ports dans la section suivante, mais pour l’instant, retenez les éléments suivants :</p> <p><ul><li>Les ports racine n’utilisent pas le paramètre de type de liaison. Les ports racine sont capables d’opérer une transition rapide vers l’état d’acheminement dès que le port est synchronisé.</li><li>Les ports alternatifs et de secours n’utilisent pas le paramètre de type de liaison dans la plupart des cas. </li><li>Les ports désignés sont ceux qui utilisent le plus le paramètre de type de liaison. Une transition rapide vers l’état d’acheminement pour le port désigné intervient uniquement si le paramètre de type de liaison indique une liaison point à point.</li></ul></p></content-text>
</page>
</topic>
<topic type="" id="tl1305040600">
<title><content-text>Rôles et états des ports RSTP</content-text></title>
<page type="OneColumn" id="tl1305040601">
<content-media type="InteractiveGraphicRollovers" id="cm2421624064">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040600/tl1305040601/cm2421624064.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040600/tl1305040601/cm2421624064text.xml"/></content-media>
<content-text><p><b>États des ports RSTP</b></p> <p>Le protocole RSTP assure une convergence rapide suite à une panne ou durant le rétablissement d’un commutateur, d’un port d’un commutateur ou d’une liaison. Une modification de topologie RSTP provoque une transition des ports appropriés vers l’état d’acheminement par le biais de protocoles d’échange explicites ou d’un processus de proposition/accord et d’une synchronisation. Nous étudierons le processus de proposition et d’accord ultérieurement. </p> <p>Dans une configuration RSTP, le rôle d’un port est indépendant de l’état d’un port. Par exemple, un port désigné peut être placé temporairement en état de mise à l’écart (discarding), même si son état final doit être l’état d’acheminement. La figure illustre les trois états possibles des ports RSTP : mise à l’écart, apprentissage et acheminement. </p> <p><b>Cliquez sur le bouton Descriptions dans la figure.</b></p> <p>Le tableau dans la figure décrit les caractéristiques de chacun des états des ports RSTP. Quel que soit son état, un port accepte et traite les trames BPDU.</p> <p><b>Cliquez sur le bouton Ports STP et RSTP dans la figure.</b></p> <p>Le tableau dans la figure compare les états des ports STP et RSTP. N’oubliez pas qu’avec le protocole STP, les ports en état de blocage et d’écoute, ainsi que les ports désactivés, ne transmettent aucune trame. Ces états ont été fusionnés dans l’état de mise à l’écart pour la configuration RSTP. </p></content-text>
</page>
<page type="OneColumn" id="tl1305040602">
<content-media type="InteractiveGraphicRollovers" id="cm4492059859">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040600/tl1305040602/cm4492059859.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040600/tl1305040602/cm4492059859text.xml"/></content-media>
<content-text><p><b>Rôles des ports RSTP</b></p> <p>Le rôle d’un port définit la fonction finale d’un port de commutateur et la manière dont il gère les trames de données. Les rôles des ports et les états des ports peuvent changer indépendamment les uns des autres. La création de rôles de ports supplémentaires permet au protocole RSTP de définir un port de commutateur de secours avant une panne ou une modification de topologie. Le port alternatif passe à l’état d’acheminement en cas de panne sur le port désigné pour le segment.</p> <p><b>Placez le pointeur sur les rôles des ports dans la figure </b>pour en savoir plus sur les différents rôles des ports RSTP.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040603">
<content-media type="AnimationPartialScreen" id="cm4927707777">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040600/tl1305040603/cm4927707777.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040600/tl1305040603/cm4927707777text.xml"/></content-media>
<content-text><p><b>Processus de proposition et d’accord RSTP</b></p> <p>Dans une configuration STP (IEEE 802.1D), lorsqu’un port a été sélectionné par l’algorithme STA pour jouer le rôle de port désigné, le protocole doit attendre deux fois la valeur du délai d’acheminement (« forward delay ») avant d’effectuer la transition vers l’état d’acheminement. Le protocole RSTP accélère considérablement le processus de recalcul après une modification de topologie, car il effectue la convergence en fonction de chaque liaison et il peut autoriser le changement d’état d’un port sans attendre l’expiration du délai d’un minuteur. La transition rapide à l’état d’acheminement peut être opérée uniquement sur les ports d’extrémité et les liaisons point à point. En mode RSTP, cette condition correspond à un port désigné en état de mise à l’écart. </p> <p><b>Cliquez sur Lire dans la figure pour lancer l’animation.</b></p></content-text>
</page>
</topic>
<topic type="" id="tl1305040700">
<title><content-text>Configuration du protocole Rapid PVST+</content-text></title>
<page type="OneColumn" id="tl1305040701">
<content-media type="InteractiveGraphicRollovers" id="cm5262070542">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040700/tl1305040701/cm5262070542.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040700/tl1305040701/cm5262070542text.xml"/></content-media>
<content-text><p>Le protocole Rapid PVST+ est une implémentation Cisco du protocole RSTP. Il prend en charge un arbre recouvrant pour chaque VLAN et il constitue la variante STP rapide à utiliser dans les réseaux Cisco. La topologie présentée dans la figure comporte deux VLAN : 10 et 20. La configuration finale implémentera le protocole Rapid PVST+ sur le commutateur S1, lequel est le pont racine. </p> <p><b>Instructions de configuration</b></p> <p>Il est utile d’examiner certaines des directives concernant la configuration de l’arbre recouvrant. Si vous souhaitez revoir la configuration STP par défaut sur un commutateur Cisco 2960, reportez-vous à la section Configuration par défaut d’un commutateur ci-dessus dans ce chapitre. Gardez ces directives à l’esprit lorsque vous mettez en oeuvre le protocole Rapid PVST+.</p> <p>Les commandes Rapid PVST+ déterminent la configuration des instances d’arbre recouvrant des VLAN. Une instance d’arbre recouvrant est créée lorsqu’une interface est affectée à un VLAN, et elle est supprimée lorsque la dernière interface est déplacée sur un autre VLAN. Vous pouvez également configurer les paramètres des ports et des commutateurs STP avant la création d’une instance d’arbre recouvrant. Ces paramètres sont appliqués lorsqu’une boucle se forme et qu’une instance d’arbre recouvrant est créée. Assurez-vous toutefois qu’au moins un commutateur sur chaque boucle du VLAN exécute l’algorithme STA. Dans le cas contraire, une tempête de diffusion peut se produire. </p> <p>Le commutateur Cisco 2960 prend en charge les protocoles PVST+, Rapid PVST+ et MSTP, mais une seule version peut être active pour tous les VLAN. </p> <p><b>Cliquez sur le bouton Commandes de configuration dans la figure.</b></p> <p>La figure présente la syntaxe des commandes Cisco IOS requises pour configurer le protocole Rapid PVST+ sur un commutateur Cisco. Il existe d’autres paramètres susceptibles d’être configurés.</p> <p><b>Remarque :</b> si vous connectez un port configuré avec la commande « spanning-tree link-type point-to-point » à un port distant via une liaison point à point et que le port local devient un port désigné, le commutateur négocie avec le port distant et fait basculer rapidement le port local à l’état d’acheminement. </p> <p><b>Remarque :</b> lorsqu’un port est configuré avec la commande « clear spanning-tree detected-protocols » et qu’il est connecté à un port situé sur un ancien commutateur en mode IEEE 802.1D, le logiciel Cisco IOS relance le processus de migration du protocole sur l’ensemble du commutateur. Bien que cette étape soit facultative, elle est recommandée de manière générale, même si le commutateur désigné détecte que ce commutateur exécute le protocole Rapid PVST+. </p> <p>Pour obtenir des informations détaillées sur tous les paramètres associés à des commandes Cisco IOS spécifiques, visitez le site indiqué ci-dessous : <content-link target="http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli3.html" type="external">http://www.cisco.com/en/US/docs/switches/lan/catalyst2960/software/release/12.2_37_se/command/reference/cli3.html</content-link>.</p> <p><b>Cliquez sur le bouton Exemple de configuration dans la figure.</b></p> <p>L’exemple de configuration présente les commandes Rapid PVST+ en cours d’activation sur le commutateur S1.</p> <p><b>Cliquez sur le bouton Vérifier dans la figure.</b></p> <p>La commande <span class="cmd"><b>show spanning-tree vlan </b><i>id de vlan</i></span> affiche la configuration de VLAN 10 sur le commutateur S1. Notez que la priorité de l’ID de pont (BID) est définie à 4 096. Le BID a été défini à l’aide de la commande <span class="cmd"><b>spanning-tree vlan </b><i>id de vlan</i><b> priority </b><i>numéro-priorité</i></span>.</p> <p><b>Cliquez sur le bouton </b><span class="cmd"><b>show run</b></span><b> dans la figure.</b></p> <p>Dans cet exemple, la commande <span class="cmd"><b>show running-configuration</b></span> a été utilisée pour vérifier la configuration du protocole Rapid PVST+ sur le commutateur S1. </p></content-text>
</page>
</topic>
<topic type="" id="tl1305040800">
<title><content-text>Conception STP pour éviter les problèmes</content-text></title>
<page type="OneColumn" id="tl1305040801">
<content-media type="StaticGraphic" id="cm3090994125">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040801/cm3090994125.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040801/cm3090994125text.xml"/></content-media>
<content-text><p><b>Identification de l’emplacement de la racine</b></p> <p>Vous savez à présent que l’algorithme STA a pour principale fonction de supprimer les boucles créées par les liaisons redondantes dans les réseaux reposant sur des ponts. Le protocole STP est employé sur des équipements fonctionnant au niveau 2 du modèle OSI. Cependant, ce protocole STP peut ne pas fonctionner dans certains cas. La résolution du problème peut se révéler très difficile et dépend de la conception du réseau. Par conséquent, il est conseillé d’anticiper ce problème.</p> <p>Très souvent, les informations concernant l’emplacement de la racine ne sont pas disponibles au moment du dépannage. Ne laissez pas au protocole STP le soin de sélectionner le pont racine. En principe, vous pouvez identifier pour chaque VLAN le commutateur qui sera optimal comme pont racine. En règle générale, il est judicieux de choisir un pont performant situé au milieu du réseau. Si vous placez le pont racine au centre du réseau en le raccordant directement aux serveurs et aux routeurs, vous réduisez la distance moyenne qui sépare les clients des serveurs et des routeurs.</p> <p>La figure présente les éléments suivants :</p> <p><ul><li>Si le commutateur S2 est la racine, la liaison de S1 à S3 est bloquée sur S1 ou S3. Dans ce cas, les hôtes qui se connectent au commutateur S2 peuvent accéder au serveur et au routeur en deux sauts. Les hôtes qui se connectent au commutateur S3 peuvent accéder au serveur et au routeur en trois sauts. La distance moyenne est deux sauts et demi. </li><li> Si le commutateur S1 est la racine, les hôtes connectés au commutateur S2 et les hôtes connectés au commutateur S3 peuvent atteindre le routeur et le serveur en deux sauts. À présent, la distance moyenne est deux sauts. </li></ul></p> <p> </p> <p>La logique qui sous-tend cet exemple simple s’applique à des topologies plus complexes. </p> <p><b>Remarque :</b> pour chaque VLAN, configurez le pont racine et le pont racine de secours en employant les priorités les plus faibles.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040802">
<content-media type="InteractiveGraphicRollovers" id="cm8796978135">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040802/cm8796978135.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040802/cm8796978135text.xml"/></content-media>
<content-text><p>Pour faciliter la résolution de problèmes liés au protocole STP, prévoyez l’organisation de vos liaisons redondantes. Dans les réseaux non hiérarchiques, vous devrez peut-être modifier le paramètre de coût STP pour déterminer les ports devant être bloqués. Cependant, ce réglage est généralement inutile si votre réseau est conçu de manière hiérarchique et comprend un pont racine situé à un emplacement approprié.</p> <p><b>Remarque :</b> pour chaque VLAN, vous devez identifier les ports à placer en état de blocage dans le réseau stable. Tracez un diagramme du réseau qui indique clairement chaque boucle physique dans le réseau, ainsi que les ports bloqués qui suppriment les boucles.</p> <p>Si vous savez où se situent les liaisons redondantes, vous serez en mesure d’identifier une boucle de pontage accidentelle et son origine. De plus, si vous savez où se situent les ports bloqués, vous pourrez déterminer l’emplacement de l’erreur.</p> <p><b>Réduction du nombre de ports bloqués</b> </p> <p>Le blocage des ports est la seule opération importante que le protocole STP effectue. Un seul port bloqué qui passe par erreur à l’état d’acheminement peut perturber le fonctionnement d’une grande partie du réseau. Pour limiter les risques inhérents à l’utilisation du protocole STP, il est judicieux de limiter au maximum le nombre de ports bloqués.</p> <p><b>Élagage VTP</b></p> <p>Il est inutile de configurer plus de deux liaisons redondantes entre deux noeuds d’un réseau commuté. Cependant, la configuration illustrée dans la figure est courante. Les commutateurs de la couche de distribution sont doublement associés à deux commutateurs de la couche coeur de réseau (les commutateurs C1 et C2). Les utilisateurs raccordés aux commutateurs S1 et S2 qui se connectent aux commutateurs de distribution appartiennent uniquement à un sous-ensemble des VLAN disponibles dans le réseau. Dans la figure, les utilisateurs qui se connectent au commutateur D1 appartiennent tous à VLAN 20 ; le commutateur D2 connecte uniquement les utilisateurs appartenant à VLAN 30. Par défaut, les agrégations transportent les informations de tous les VLAN définis dans le domaine VTP (Virtual Trunking Protocol). Seul le commutateur D1 reçoit du trafic de diffusion et de multidiffusion inutile pour VLAN 20, mais il bloque également l’un de ses ports pour VLAN 30. Il existe trois chemins redondants entre le commutateur C1 et le commutateur C2 (couche coeur de réseau). Cette redondance se traduit par un plus grand nombre de ports bloqués et par une plus forte probabilité d’apparition de boucle.</p> <p><b>Remarque :</b> dans les agrégations, élaguez les VLAN dont vous n’avez pas besoin.</p> <p><b>Cliquez sur le bouton Élagage manuel dans la figure.</b></p> <p><b>Élagage manuel</b></p> <p>L’élagage VTP peut être utile, mais cette fonctionnalité n’est pas nécessaire dans la couche coeur de réseau. Dans cette figure, un VLAN d’accès uniquement est utilisé pour connecter les commutateurs de distribution à la couche coeur de réseau. Dans cette conception, un seul port est bloqué par VLAN. De plus, avec cette conception, vous pouvez supprimer toutes les liaisons redondantes en une seule fois si vous arrêtez le commutateur C1 ou C2.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040803">
<content-media type="StaticGraphic" id="cm1043369401">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040803/cm1043369401.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040803/cm1043369401text.xml"/></content-media>
<content-text><p><b>Utilisation de la commutation de couche 3</b></p> <p>La commutation de couche 3 signifie que le routage est opéré approximativement à la même vitesse que la commutation. Un routeur a deux fonctions principales :</p> <p><ul><li>Il construit une table d’acheminement. Le routeur échange généralement des informations avec ses homologues par le biais de protocoles de routage.</li><li>Il reçoit des paquets et les transmet à l’interface appropriée en fonction de l’adresse de destination.</li></ul></p> <p>Les commutateurs Cisco haut de gamme de couche 3 peuvent désormais assurer cette seconde fonction, à la même vitesse que la commutation de couche 2. Dans la figure :</p> <p><ul><li>Il n’y a aucun ralentissement avec le <content-link target="{F6C44F67-4253-4668-B1CB-79DDD64C8C16}" type="glossary">saut</content-link> du routage et un segment supplémentaire entre C1 et C2.</li><li>Les commutateurs de la couche coeur de réseau C1 et C2 sont des commutateurs de couche 3. VLAN 20 et VLAN 30 ne sont plus reliés par un pont entre C1 et C2. Par conséquent, la formation d’une boucle est impossible.</li></ul></p> <p>La redondance est toujours présente dans le réseau ; elle s’appuie sur les protocoles de routage de couche 3. Dans cette conception, la convergence est encore plus rapide qu’avec le protocole STP.</p> <p><ul><li>Étant donné que le protocole STP ne bloque plus de port, aucune boucle de pontage ne peut se former.</li><li>En conservant la commutation de couche 3 pour le VLAN, la vitesse est aussi rapide qu’en effectuant un pontage au sein du VLAN.</li></ul></p></content-text>
</page>
<page type="OneColumn" id="tl1305040804">
<content-media type="StaticGraphic" id="cm4295140158">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040800/tl1305040804/cm4295140158.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040800/tl1305040804/cm4295140158text.xml"/></content-media>
<content-text><p><b>Observations finales </b></p> <p><b>Conservez le protocole STP, même s’il n’est pas nécessaire. </b></p> <p>En supposant que vous ayez supprimé tous les ports bloqués du réseau et qu’il n’existe pas de redondance physique, il est vivement conseillé de ne pas désactiver le protocole STP.</p> <p>En règle générale, le protocole STP sollicite peu les ressources du processeur ; la commutation des paquets ne fait pas intervenir l’unité centrale (UC) pour la plupart des commutateurs Cisco. De plus, les quelques trames BPDU qui sont envoyées sur chaque liaison ne réduisent pas beaucoup la quantité de bande passante disponible. Cependant, si un technicien fait une erreur de connexion sur un panneau de brassage et crée accidentellement une boucle, les performances du réseau s’en ressentiront. Généralement, dans un réseau commuté, il vaut mieux éviter de désactiver le protocole STP. </p> <p><b>Isolez le trafic du VLAN d’administration et n’utilisez pas un seul VLAN qui recouvre tout le réseau. </b></p> <p>Un commutateur Cisco possède généralement une adresse IP unique qui l’associe à un VLAN, appelé « VLAN d’administration ». Dans ce VLAN, le commutateur se comporte comme un hôte IP générique. En particulier, chaque paquet de diffusion ou de multidiffusion est transféré au processeur. Un trafic de diffusion ou de multidiffusion intensif sur le VLAN d’administration peut avoir une incidence négative sur le processeur et sur sa capacité à traiter les trames BPDU essentielles. Par conséquent, vous devez isoler le trafic utilisateur du VLAN d’administration.</p> <p>Il n’y a pas si longtemps encore, il n’existait aucun moyen de supprimer le VLAN 1 d’une agrégation dans une implémentation Cisco. Le VLAN 1 fait généralement office de VLAN d’administration où tous les commutateurs sont accessibles dans le même sous-réseau IP. Bien que cette configuration soit utile, elle peut être dangereuse, car une boucle de pontage sur le VLAN 1 affecte toutes les agrégations, ce qui peut provoquer l’arrêt de tout le réseau. Bien entendu, ce problème existe quel que soit le VLAN que vous utilisez. Essayez de segmenter les domaines de pontage en utilisant des commutateurs rapides de couche 3. </p> <p><b>Remarque :</b> depuis la commercialisation de Cisco IOS version 12.1(11b)E, il est possible de supprimer le VLAN 1 des agrégations. Le VLAN 1 existe toujours, mais il bloque le trafic, ce qui empêche la formation de boucles.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305040900">
<title><content-text>Résolution des problèmes de fonctionnement de STP</content-text></title>
<page type="OneColumn" id="tl1305040901">
<content-media type="AnimationPartialScreen" id="cm4756369660">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040901/cm4756369660.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040901/cm4756369660text.xml"/></content-media>
<content-text><p><b>Échec d’une liaison ou d’un commutateur</b></p> <p>Dans l’animation, vous constatez que lorsqu’un port tombe en panne dans un réseau configuré avec le protocole STP, une tempête de diffusion peut se produire.</p> <p>Dans ce scénario d’échec du protocole STP, au départ, l’ID de pont (BID) du commutateur S3 est inférieur à celui du commutateur S2. Par conséquent, le port désigné entre S3 et S2 est le port F0/1 du commutateur S3. On considère que le commutateur S3 possède une « meilleure BPDU » que le commutateur S2.</p> <p><b>Cliquez sur Lire dans la figure pour voir un exemple de configuration STP inopérante.</b></p></content-text>
</page>
<page type="OneColumn" id="tl1305040902">
<content-media type="StaticGraphic" id="cm1702814491">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040902/cm1702814491.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040902/cm1702814491text.xml"/></content-media>
<content-text><p><b>Résolution d’un problème </b></p> <p>Malheureusement, il n’existe pas de procédure spécifique permettant de résoudre systématiquement un problème lié au protocole STP. Cette section résume certaines opérations que vous pouvez effectuer. La plupart des procédures concernent la résolution des problèmes liés aux boucles de pontage en général. Vous pouvez suivre une approche plus conventionnelle pour identifier d’autres échecs du protocole STP qui conduisent à une perte de connectivité. Par exemple, vous pouvez analyser le chemin qu’emprunte le trafic concerné par l’incident.</p> <p><b>Remarque :</b> il est possible que l’accès de type « in-band » ne soit pas disponible au cours d’une boucle de pontage. Par exemple, durant une tempête de diffusion, vous ne pourrez pas contrôler les périphériques de l’infrastructure à l’aide du protocole Telnet. Par conséquent, une <content-link target="{C0B9FF31-9120-41F8-8EC3-6EB44A9BF039}" type="glossary">signalisation hors bande</content-link>, telle qu’un accès aux périphériques réseau via leur port console, pourra être nécessaire.</p> <p>Avant de résoudre un problème de boucle de pontage, vous devez être en possession des trois informations suivantes au minimum :</p> <p><ul><li>la topologie du réseau à pont ;</li><li>l’emplacement du pont racine ;</li><li>l’emplacement des ports bloqués et des liaisons redondantes.</li></ul></p> <p>Ces informations sont essentielles. Pour être en mesure de déterminer ce qui doit être corrigé dans le réseau, vous devez savoir comment se présente le réseau lorsqu’il fonctionne correctement. La plupart des étapes de dépannage utilisent simplement des commandes <span class="cmd"><b>show</b></span> pour tenter d’identifier des conditions d’erreur. Une bonne connaissance du réseau vous permet de vous concentrer sur les ports stratégiques et les principaux périphériques. </p> <p>Ci-après, nous examinerons brièvement deux problèmes fréquents liés au protocole STP : erreur de configuration PortFast et problème de diamètre du réseau. Pour obtenir des informations sur d’autres problèmes liés au protocole STP, consultez le document suivant : <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800951ac.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a00800951ac.shtml</content-link>.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040903">
<content-media type="StaticGraphic" id="cm4211036363">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040903/cm4211036363.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040903/cm4211036363text.xml"/></content-media>
<content-text><p><b>Erreur de configuration PortFast</b></p> <p>En principe, vous activez la technologie PortFast uniquement pour un port ou une interface qui établit une connexion à un hôte. Lorsque la liaison est établie sur ce port, le pont saute les premières étapes de l’algorithme STA et passe directement en mode d’acheminement.</p> <p><b>Attention :</b> n’utilisez pas PortFast sur des interfaces ou des ports de commutateur qui se connectent à d’autres commutateurs, concentrateurs ou routeurs, car vous risqueriez de créer une boucle dans le réseau.</p> <p>Dans cet exemple, le port F0/1 du commutateur S1 est déjà en mode d’acheminement. Le port F0/2 a été malencontreusement configuré avec la fonction PortFast. Par conséquent, lorsqu’une seconde connexion du commutateur S2 est connectée au port F0/2 sur S1, le port passe automatiquement en mode d’acheminement et crée une boucle.</p> <p>À terme, l’un des commutateurs acheminera une trame BPDU et l’un de ces commutateurs fera basculer un port en mode de blocage.</p> <p>Cependant, un problème se pose avec ce type de boucle transitoire. Si le trafic dans la boucle est très important, le commutateur ne parviendra peut-être pas à transmettre correctement la trame BPDU qui met fin à la boucle. Ce problème peut ralentir considérablement la convergence, voire provoquer une panne du réseau dans certains cas extrêmes.</p> <p>Même avec une configuration PortFast, le port ou l’interface participera au processus STP. Si un commutateur doté d’une priorité de pont plus faible que celle du pont racine actif est raccordé à une interface ou à un port configuré avec PortFast, il peut être désigné comme pont racine. Ce changement de pont racine peut avoir une incidence négative sur la topologie STP active et peut dégrader les performances du réseau. Pour éviter ce problème, la plupart des commutateurs Catalyst qui exécutent Cisco IOS incluent une fonction appelée BPDU Guard. BPDU Guard désactive une interface ou un port PortFast si l’interface ou le port reçoit une trame BPDU.</p> <p>Pour plus d’informations sur l’utilisation de PortFast sur les commutateurs exécutant Cisco IOS, reportez-vous au document « Using PortFast and Other Commands to Fix Workstation Startup Connectivity Delays », disponible à l’adresse : <content-link target="http://www.cisco.com/en/US/products/hw/switches/ps700/products_tech_note09186a00800b1500.shtml" type="external">http://www.cisco.com/en/US/products/hw/switches/ps700/products_tech_note09186a00800b1500.shtml</content-link>.</p> <p>Pour plus d’informations sur l’utilisation de la fonction BPDU Guard sur les commutateurs exécutant Cisco IOS, reportez-vous au document : <content-link target="http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml" type="external">http://www.cisco.com/en/US/tech/tk389/tk621/technologies_tech_note09186a008009482f.shtml</content-link>.</p></content-text>
</page>
<page type="OneColumn" id="tl1305040904">
<content-media type="StaticGraphic" id="cm1369055914">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040904/cm1369055914.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040904/cm1369055914text.xml"/></content-media>
<content-text><p><b>Problèmes de diamètre du réseau</b></p> <p>Le diamètre d’un réseau commuté est un autre problème peu connu. Les valeurs par défaut « conservatrices » des minuteurs du protocole STP imposent un diamètre de réseau maximal de sept sauts. Dans la figure, cette conception crée un diamètre de réseau de huit sauts. Le diamètre de réseau maximal impose des restrictions sur la distance séparant les différents commutateurs. Dans ce cas, deux commutateurs ne peuvent pas être distants de plus de sept sauts. Une partie de cette restriction découle du champ d’âge que les trames BPDU contiennent.</p> <p>Lorsqu’une trame BPDU se propage du pont racine vers les feuilles de l’arbre, le champ d’âge est incrémenté chaque fois que la trame BPDU passe par un commutateur. Au bout d’un certain temps, le commutateur rejette la trame BPDU lorsque le champ d’âge excède le seuil maximal (max age). Si la racine est trop éloignée de certains commutateurs du réseau, les BPDU seront abandonnées. Ce problème affecte la convergence de l’arbre recouvrant.</p> <p>Soyez vigilant si vous prévoyez de modifier les minuteurs STP en utilisant des valeurs autres que celles par défaut. Vous courez un risque si vous tentez d’obtenir une convergence plus rapide de cette manière. La modification d’un minuteur STP a des répercussions sur le diamètre du réseau et la stabilité du protocole STP. Vous pouvez modifier la priorité des commutateurs pour sélectionner le pont racine, et vous pouvez modifier le paramètre de priorité ou de coût des ports pour contrôler la redondance et l’équilibrage de la charge.</p></content-text>
</page>
<page type="FullScreen" id="tl1305040905">

<content-media type="ActivityCustom" id="cm1056323676">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305040000/tl1305040900/tl1305040905/cm1056323676.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305040000/tl1305040900/tl1305040905/cm1056323676text.xml"/></content-media>
<content-text></content-text>
</page>
</topic>
</section>
<section type="" id="tl1305050000">
<title><content-text>Travaux pratiques du chapitre</content-text></title>
<topic type="" id="tl1305050100">
<title><content-text>Protocole STP - Notions de base</content-text></title>
<page type="OneColumn" id="tl1305050101">
<content-media type="ActivityLab" id="cm7380097902">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050100/tl1305050101/cm7380097902/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050100/tl1305050101/cm7380097902/icontext.xml"/></content-media>
<content-text><p>Dans tout réseau, l’un des objectifs consiste à assurer une redondance. En cas de défaillance d’une liaison réseau, existe-t-il une liaison de secours capable de commuter immédiatement le trafic qui transitait auparavant par la liaison coupée ? La redondance physique est indispensable dans le réseau pour éviter les pannes de réseau ou les temps d’arrêt. Cependant, cette même redondance physique dans le réseau crée un problème logique. S’il existe une redondance physique dans le réseau commuté, comment empêchez-vous la formation de boucles de couche 2 ? Le protocole STP (Spanning Tree Protocol) a été conçu pour résoudre ce problème. Dans ces travaux pratiques, vous apprendrez à configurer le protocole STP.</p></content-text>
</page>
</topic>
<topic type="" id="tl1305050200">
<title><content-text>Protocole STP – Notions avancées</content-text></title>
<page type="OneColumn" id="tl1305050201">
<content-media type="ActivityLab" id="cm4910421381">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050200/tl1305050201/cm4910421381/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050200/tl1305050201/cm4910421381/icontext.xml"/></content-media>
<content-text><p>Il est essentiel de bien comprendre la configuration du protocole STP pour la mise en oeuvre de réseaux commutés. Ces travaux pratiques vous permettront de vous entraîner à configurer le protocole STP.</p></content-text>
</page>
<page type="OneColumn" id="tl1305050202">
<content-media type="ActivityPKA" id="cm2035957299">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050200/tl1305050202/cm2035957299/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050200/tl1305050202/cm2035957299/icontext.xml"/></content-media>
<content-text><p>Cet exercice est une variante des travaux pratiques 5.5.2. Il est possible que Packet Tracer ne prenne pas en charge toutes les tâches spécifiées dans les travaux pratiques. Cet exercice doit être effectué ; il ne remplace pas les travaux pratiques. Packet Tracer n’est pas un substitut aux travaux pratiques avec un équipement réel.</p> <p>Des instructions détaillées sont fournies dans l’exercice même, ainsi que dans le lien PDF ci-dessous.</p> <p><content-link target="E3_PTAct_5_5_2.pdf" type="internalfile">Instructions pour l’exercice (PDF)</content-link></p> <p><b>Cliquez sur l’icône Packet Tracer pour plus de détails.</b></p></content-text>
</page>
</topic>
<topic type="" id="tl1305050300">
<title><content-text>Résolution des problèmes du protocole STP</content-text></title>
<page type="OneColumn" id="tl1305050301">
<content-media type="ActivityLab" id="cm8824744930">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050300/tl1305050301/cm8824744930/" mime="application/pdf" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050300/tl1305050301/cm8824744930/icontext.xml"/></content-media>
<content-text><p>Vous êtes responsable de l’exploitation du réseau local commuté redondant présenté dans le schéma de topologie. Vos utilisateurs et vous-même avez observé une augmentation de la latence pendant les heures de pointe et votre analyse met en cause les agrégations encombrées. Vous reconnaissez que sur les six agrégations configurées, seules trois acheminent des paquets dans la configuration STP par défaut en cours d’exécution. La solution à ce problème repose sur une utilisation plus efficace des agrégations disponibles. La fonction PVST+ des commutateurs Cisco offre la souplesse nécessaire pour répartir le trafic entre les différents commutateurs en utilisant toutes les agrégations.</p> <p>Ces travaux pratiques sont terminés lorsque toutes les agrégations câblées acheminent le trafic et que les trois commutateurs participent à l’équilibrage de la charge par VLAN pour les trois VLAN utilisateur. </p></content-text>
</page>
<page type="OneColumn" id="tl1305050302">
<content-media type="ActivityPKA" id="cm9675636910">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305050000/tl1305050300/tl1305050302/cm9675636910/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305050000/tl1305050300/tl1305050302/cm9675636910/icontext.xml"/></content-media>
<content-text><p>Cet exercice est une variante des travaux pratiques 5.5.3. Il est possible que Packet Tracer ne prenne pas en charge toutes les tâches spécifiées dans les travaux pratiques. Cet exercice doit être effectué ; il ne remplace pas les travaux pratiques. Packet Tracer n’est pas un substitut aux travaux pratiques avec un équipement réel.</p> <p>Des instructions détaillées sont fournies dans l’exercice même, ainsi que dans le lien PDF ci-dessous.</p> <p><content-link target="E3_PTAct_5_5_3.pdf" type="internalfile">Instructions pour l’exercice (PDF)</content-link></p> <p><b>Cliquez sur l’icône Packet Tracer pour plus de détails.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterSummary" id="tl1305060000">
<title><content-text>Résumé du chapitre</content-text></title>
<topic type="" id="tl1305060100">
<title><content-text>Résumé</content-text></title>
<page type="OneColumn" id="tl1305060101">
<content-media type="ChapterSummary" id="cm1170567563">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305060000/tl1305060100/tl1305060101/cm1170567563.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305060000/tl1305060100/tl1305060101/cm1170567563text.xml"/></content-media>
<content-text><p>La mise en place de liaisons redondantes dans un réseau hiérarchique crée des boucles physiques qui provoquent des problèmes au niveau de la couche 2 ayant une incidence sur la disponibilité du réseau. Le protocole STP a été développé pour répondre à la problématique des boucles physiques introduites pour améliorer la redondance du réseau. Le protocole STP recourt à l’algorithme Spanning Tree (STA) pour calculer une topologie logique exempte de boucles pour un domaine de diffusion. </p> <p>Le processus d’arbre recouvrant utilise différents états de ports et minuteurs pour empêcher de manière logique la formation de boucles en créant une topologie sans boucles. La détermination de la topologie de l’arbre recouvrant repose sur la distance par rapport au pont racine. La distance est déterminée par l’échange de trames BPDU et l’algorithme STA. Dans le même temps, les rôles des ports sont déterminés : ports désignés, ports non désignés et ports racine.</p> <p>L’utilisation du protocole STP d’origine (norme IEEE 802.1D) implique un temps de convergence pouvant atteindre 50 secondes. Ce temps de convergence élevé n’étant plus adapté aux exigences de réactivité des réseaux commutés modernes, le protocole Rapid Spanning-Tree a été mis en place (norme IEEE 802.1w). L’implémentation Cisco per-VLAN de la norme IEEE 802.1D est appelée PVST+, et l’implémentation Cisco per-VLAN du protocole RSTP (rapid spanning-tree protocol) est appelée PVST+. Le protocole RSTP réduit le temps de convergence (de l’ordre de six secondes ou moins).</p> <p>Nous avons abordé les liaisons de type partagé et point à point, ainsi que les ports d’extrémité. Nous avons également étudié les nouveaux concepts de ports alternatifs et de ports de secours utilisés avec le protocole RSTP.</p> <p>Le protocole Rapid PVST+ constitue l’implémentation STP privilégiée dans un réseau commuté s’appuyant sur des commutateurs Cisco Catalyst.</p></content-text>
</page>
<page type="FullScreen" id="tl1305060102">
<content-media type="StaticGraphic" id="cm3770022391">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305060000/tl1305060100/tl1305060102/cm3770022391.swf" mime="shockwave/flash" scale="true" type="file" width="400" height="200" external="tl1305000000/tl1305060000/tl1305060100/tl1305060102/cm3770022391text.xml"/></content-media>
<content-text></content-text>
</page>
<page type="OneColumn" id="tl1305060103">
<content-media type="ActivityPKA" id="cm5475272455">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305060000/tl1305060100/tl1305060103/cm5475272455/" mime="application/packettracer" scale="true" type="directory" width="0" height="0" external="tl1305000000/tl1305060000/tl1305060100/tl1305060103/cm5475272455/icontext.xml"/></content-media>
<content-text><p>Dans cet exercice, vous configurerez un réseau redondant avec le protocole VTP, des réseaux locaux virtuels (VLAN) et le protocole STP. En outre, vous concevrez un modèle d’adressage en fonction des besoins des utilisateurs. Les réseaux locaux virtuels (VLAN) de cet exercice sont différents de ceux que vous avez étudiés dans les chapitres précédents. Sachez que le VLAN de gestion et par défaut ne doit pas nécessairement être le VLAN 99 ; vous pouvez choisir celui qui vous convient. Par conséquent, nous utilisons le VLAN 5 dans cet exercice.</p> <p>Des instructions détaillées sont fournies dans l’exercice même, ainsi que dans le lien PDF ci-dessous.</p> <p><content-link target="E3_PTAct_5_6_1.pdf" type="internalfile">Instructions pour l’exercice (PDF)</content-link></p> <p><b>Cliquez sur l’icône Packet Tracer pour plus de détails.</b></p></content-text>
</page>
</topic>
</section>
<section type="ChapterQuiz" id="tl1305070000">
<title><content-text>Questionnaire du chapitre</content-text></title>
<topic type="" id="tl1305070100">
<title><content-text>Questionnaire du chapitre</content-text></title>
<page type="FullScreen" id="tl1305070101">
<content-media type="ChapterQuiz" id="cm3237637239">	<title><content-text></content-text></title>	<media ref="tl1305000000/tl1305070000/tl1305070100/tl1305070101/cm3237637239/" mime="" scale="true" type="directory" width="100%" height="100%" external="tl1305000000/tl1305070000/tl1305070100/tl1305070101/cm3237637239/icontext.xml"/></content-media>
<content-text><p>Questionnaire du chapitre</p></content-text>
</page>
</topic>
</section>
</chapter>
